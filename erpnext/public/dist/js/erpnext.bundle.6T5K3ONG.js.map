{
  "version": 3,
  "sources": ["../../../../../apps/erpnext/erpnext/public/js/conf.js", "../../../../../apps/erpnext/erpnext/public/js/utils.js", "../../../../../apps/erpnext/erpnext/public/js/queries.js", "../../../../../apps/erpnext/erpnext/public/js/sms_manager.js", "../../../../../apps/erpnext/erpnext/public/js/utils/party.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/stock_controller.js", "../../../../../apps/erpnext/erpnext/public/js/payment/payments.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/taxes_and_totals.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/transaction.js", "frappe-html:/workspace/development/frappe-bench/apps/erpnext/erpnext/public/js/templates/item_selector.html", "../../../../../apps/erpnext/erpnext/public/js/utils/item_selector.js", "../../../../../apps/erpnext/erpnext/public/js/help_links.js", "../../../../../apps/erpnext/erpnext/public/js/agriculture/ternary_plot.js", "frappe-html:/workspace/development/frappe-bench/apps/erpnext/erpnext/public/js/templates/item_quick_entry.html", "../../../../../apps/erpnext/erpnext/public/js/utils/item_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/utils/customer_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/utils/supplier_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/call_popup/call_popup.js", "../../../../../apps/erpnext/erpnext/public/js/utils/dimension_tree_filter.js", "../../../../../apps/erpnext/erpnext/public/js/utils/barcode_scanner.js", "../../../../../apps/erpnext/erpnext/public/js/telephony.js", "frappe-html:/workspace/development/frappe-bench/apps/erpnext/erpnext/public/js/templates/call_link.html", "../../../../../apps/erpnext/erpnext/public/js/bulk_transaction_processing.js", "../../../../../apps/erpnext/erpnext/public/js/utils/crm_activities.js", "frappe-html:/workspace/development/frappe-bench/apps/erpnext/erpnext/public/js/templates/crm_activities.html", "frappe-html:/workspace/development/frappe-bench/apps/erpnext/erpnext/public/js/templates/crm_notes.html"],
  "sourcesContent": ["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide('erpnext');\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Group\": \"Buying\",\n\t\"Territory\": \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\t\"Brand\": \"Stock\",\n\t\"Maintenance Schedule\": \"Support\",\n\t\"Maintenance Visit\": \"Support\"\n});\n\n$.extend(frappe.breadcrumbs.module_map, {\n\t'ERPNext Integrations': 'Integrations',\n\t'Geo': 'Settings',\n\t'Portal': 'Website',\n\t'Utilities': 'Settings',\n\t'E-commerce': 'Website',\n\t'Contacts': 'CRM'\n});\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\n\n$.extend(erpnext, {\n\tget_currency: function(company) {\n\t\tif(!company && cur_frm)\n\t\t\tcompany = cur_frm.doc.company;\n\t\tif(company)\n\t\t\treturn frappe.get_doc(\":Company\", company).default_currency || frappe.boot.sysdefaults.currency;\n\t\telse\n\t\t\treturn frappe.boot.sysdefaults.currency;\n\t},\n\n\tget_presentation_currency_list: () => {\n\t\tconst docs = frappe.boot.docs;\n\t\tlet currency_list = docs.filter(d => d.doctype === \":Currency\").map(d => d.name);\n\t\tcurrency_list.unshift(\"\");\n\t\treturn currency_list;\n\t},\n\n\ttoggle_naming_series: function() {\n\t\tif(cur_frm.fields_dict.naming_series) {\n\t\t\tcur_frm.toggle_display(\"naming_series\", cur_frm.doc.__islocal?true:false);\n\t\t}\n\t},\n\n\thide_company: function() {\n\t\tif(cur_frm.fields_dict.company) {\n\t\t\tvar companies = Object.keys(locals[\":Company\"] || {});\n\t\t\tif(companies.length === 1) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", companies[0]);\n\t\t\t\tcur_frm.toggle_display(\"company\", false);\n\t\t\t} else if(erpnext.last_selected_company) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", erpnext.last_selected_company);\n\t\t\t}\n\t\t}\n\t},\n\n\tis_perpetual_inventory_enabled: function(company) {\n\t\tif(company) {\n\t\t\treturn frappe.get_doc(\":Company\", company).enable_perpetual_inventory\n\t\t}\n\t},\n\n\tstale_rate_allowed: () => {\n\t\treturn cint(frappe.boot.sysdefaults.allow_stale);\n\t},\n\n\tsetup_serial_or_batch_no: function() {\n\t\tlet grid_row = cur_frm.open_grid_row();\n\t\tif (!grid_row || !grid_row.grid_form.fields_dict.serial_no ||\n\t\t\tgrid_row.grid_form.fields_dict.serial_no.get_status() !== \"Write\") return;\n\n\t\tfrappe.model.get_value('Item', {'name': grid_row.doc.item_code},\n\t\t\t['has_serial_no', 'has_batch_no'], ({has_serial_no, has_batch_no}) => {\n\t\t\t\tObject.assign(grid_row.doc, {has_serial_no, has_batch_no});\n\n\t\t\t\tif (has_serial_no) {\n\t\t\t\t\tattach_selector_button(__(\"Add Serial No\"),\n\t\t\t\t\t\tgrid_row.grid_form.fields_dict.serial_no.$wrapper, this, grid_row);\n\t\t\t\t} else if (has_batch_no) {\n\t\t\t\t\tattach_selector_button(__(\"Pick Batch No\"),\n\t\t\t\t\t\tgrid_row.grid_form.fields_dict.batch_no.$wrapper, this, grid_row);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t},\n\n\troute_to_adjustment_jv: (args) => {\n\t\tfrappe.model.with_doctype('Journal Entry', () => {\n\t\t\t// route to adjustment Journal Entry to handle Account Balance and Stock Value mismatch\n\t\t\tlet journal_entry = frappe.model.get_new_doc('Journal Entry');\n\n\t\t\targs.accounts.forEach((je_account) => {\n\t\t\t\tlet child_row = frappe.model.add_child(journal_entry, \"accounts\");\n\t\t\t\tchild_row.account = je_account.account;\n\t\t\t\tchild_row.debit_in_account_currency = je_account.debit_in_account_currency;\n\t\t\t\tchild_row.credit_in_account_currency = je_account.credit_in_account_currency;\n\t\t\t\tchild_row.party_type = \"\" ;\n\t\t\t});\n\t\t\tfrappe.set_route('Form','Journal Entry', journal_entry.name);\n\t\t});\n\t},\n\n\troute_to_pending_reposts: (args) => {\n\t\tfrappe.set_route('List', 'Repost Item Valuation', args);\n\t},\n});\n\n\n$.extend(erpnext.utils, {\n\tset_party_dashboard_indicators: function(frm) {\n\t\tif(frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n\t\t\tvar company_wise_info = frm.doc.__onload.dashboard_info;\n\t\t\tif(company_wise_info.length > 1) {\n\t\t\t\tcompany_wise_info.forEach(function(info) {\n\t\t\t\t\terpnext.utils.add_indicator_for_multicompany(frm, info);\n\t\t\t\t});\n\t\t\t} else if (company_wise_info.length === 1) {\n\t\t\t\tfrm.dashboard.add_indicator(__('Annual Billing: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].billing_this_year, company_wise_info[0].currency)]), 'blue');\n\t\t\t\tfrm.dashboard.add_indicator(__('Total Unpaid: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].total_unpaid, company_wise_info[0].currency)]),\n\t\t\t\tcompany_wise_info[0].total_unpaid ? 'orange' : 'green');\n\n\t\t\t\tif(company_wise_info[0].loyalty_points) {\n\t\t\t\t\tfrm.dashboard.add_indicator(__('Loyalty Points: {0}',\n\t\t\t\t\t\t[company_wise_info[0].loyalty_points]), 'blue');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator_for_multicompany: function(frm, info) {\n\t\tfrm.dashboard.stats_area.show();\n\t\tfrm.dashboard.stats_area_row.addClass('flex');\n\t\tfrm.dashboard.stats_area_row.css('flex-wrap', 'wrap');\n\n\t\tvar color = info.total_unpaid ? 'orange' : 'green';\n\n\t\tvar indicator = $('<div class=\"flex-column col-xs-6\">'+\n\t\t\t'<div style=\"margin-top:10px\"><h6>'+info.company+'</h6></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Annual Billing: '+format_currency(info.billing_this_year, info.currency)+'</span></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\">'+\n\t\t\t'<span class=\"indicator '+color+'\">Total Unpaid: '\n\t\t\t+format_currency(info.total_unpaid, info.currency)+'</span></div>'+\n\n\n\t\t\t'</div>').appendTo(frm.dashboard.stats_area_row);\n\n\t\tif(info.loyalty_points){\n\t\t\t$('<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Loyalty Points: '+info.loyalty_points+'</span></div>').appendTo(indicator);\n\t\t}\n\n\t\treturn indicator;\n\t},\n\n\tget_party_name: function(party_type) {\n\t\tvar dict = {'Customer': 'customer_name', 'Supplier': 'supplier_name', 'Employee': 'employee_name',\n\t\t\t'Member': 'member_name'};\n\t\treturn dict[party_type];\n\t},\n\n\tcopy_value_in_all_rows: function(doc, dt, dn, table_fieldname, fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tif(!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tget_terms: function(tc_name, doc, callback) {\n\t\tif(tc_name) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions',\n\t\t\t\targs: {\n\t\t\t\t\ttemplate_name: tc_name,\n\t\t\t\t\tdoc: doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tcallback(r)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_bank_account: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.bank_account.bank_account.make_bank_account\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tadd_dimensions: function(report_name, index) {\n\t\tlet filters = frappe.query_reports[report_name].filters;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\tcallback: function(r) {\n\t\t\t\tlet accounting_dimensions = r.message[0];\n\t\t\t\taccounting_dimensions.forEach((dimension) => {\n\t\t\t\t\tlet found = filters.some(el => el.fieldname === dimension['fieldname']);\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tfilters.splice(index, 0, {\n\t\t\t\t\t\t\t\"fieldname\": dimension[\"fieldname\"],\n\t\t\t\t\t\t\t\"label\": __(dimension[\"label\"]),\n\t\t\t\t\t\t\t\"fieldtype\": \"MultiSelectList\",\n\t\t\t\t\t\t\tget_data: function(txt) {\n\t\t\t\t\t\t\t\treturn frappe.db.get_link_options(dimension[\"document_type\"], txt);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_inventory_dimensions: function(report_name, index) {\n\t\tlet filters = frappe.query_reports[report_name].filters;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.stock.doctype.inventory_dimension.inventory_dimension.get_inventory_dimensions\",\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message && r.message.length) {\n\t\t\t\t\tr.message.forEach((dimension) => {\n\t\t\t\t\t\tlet found = filters.some(el => el.fieldname === dimension['fieldname']);\n\n\t\t\t\t\t\tif (!found) {\n\t\t\t\t\t\t\tfilters.splice(index, 0, {\n\t\t\t\t\t\t\t\t\"fieldname\": dimension[\"fieldname\"],\n\t\t\t\t\t\t\t\t\"label\": __(dimension[\"doctype\"]),\n\t\t\t\t\t\t\t\t\"fieldtype\": \"MultiSelectList\",\n\t\t\t\t\t\t\t\tget_data: function(txt) {\n\t\t\t\t\t\t\t\t\treturn frappe.db.get_link_options(dimension[\"doctype\"], txt);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_subscription: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tmake_pricing_rule: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.make_pricing_rule\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\t/**\n\t* Checks if the first row of a given child table is empty\n\t* @param child_table - Child table Doctype\n\t* @return {Boolean}\n\t**/\n\tfirst_row_is_empty: function(child_table){\n\t\tif($.isArray(child_table) && child_table.length > 0) {\n\t\t\treturn !child_table[0].item_code;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t* Removes the first row of a child table if it is empty\n\t* @param {_Frm} frm - The current form\n\t* @param {String} child_table_name - The child table field name\n\t* @return {Boolean}\n\t**/\n\tremove_empty_first_row: function(frm, child_table_name){\n\t\tconst rows = frm['doc'][child_table_name];\n\t\tif (this.first_row_is_empty(rows)){\n\t\t\tfrm['doc'][child_table_name] = rows.splice(1);\n\t\t}\n\t\treturn rows;\n\t},\n\tget_tree_options: function(option) {\n\t\t// get valid options for tree based on user permission & locals dict\n\t\tlet unscrub_option = frappe.model.unscrub(option);\n\t\tlet user_permission = frappe.defaults.get_user_permissions();\n\t\tlet options;\n\n\t\tif(user_permission && user_permission[unscrub_option]) {\n\t\t\toptions = user_permission[unscrub_option].map(perm => perm.doc);\n\t\t} else {\n\t\t\toptions = $.map(locals[`:${unscrub_option}`], function(c) { return c.name; }).sort();\n\t\t}\n\n\t\t// filter unique values, as there may be multiple user permissions for any value\n\t\treturn options.filter((value, index, self) => self.indexOf(value) === index);\n\t},\n\tget_tree_default: function(option) {\n\t\t// set default for a field based on user permission\n\t\tlet options = this.get_tree_options(option);\n\t\tif(options.includes(frappe.defaults.get_default(option))) {\n\t\t\treturn frappe.defaults.get_default(option);\n\t\t} else {\n\t\t\treturn options[0];\n\t\t}\n\t},\n\toverrides_parent_value_in_all_rows: function(doc, dt, dn, table_fieldname, fieldname, parent_fieldname) {\n\t\tif (doc[parent_fieldname]) {\n\t\t\tlet cl = doc[table_fieldname] || [];\n\t\t\tfor (let i = 0; i < cl.length; i++) {\n\t\t\t\tcl[i][fieldname] = doc[parent_fieldname];\n\t\t\t}\n\t\t\tfrappe.refresh_field(table_fieldname);\n\t\t}\n\t},\n\tcreate_new_doc: function (doctype, update_fields) {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\t\t\tfor (let [key, value] of Object.entries(update_fields)) {\n\t\t\t\tnew_doc[key] = value;\n\t\t\t}\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t});\n\t}\n\n});\n\nerpnext.utils.select_alternate_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst warehouse_field = opts.warehouse_field || 'warehouse';\n\tconst item_field = opts.item_field || 'item_code';\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Select Alternate Item\"),\n\t\tfields: [\n\t\t\t{fieldtype:'Section Break', label: __('Items')},\n\t\t\t{\n\t\t\t\tfieldname: \"alternative_items\", fieldtype: \"Table\", cannot_add_rows: true,\n\t\t\t\tin_place_edit: true, data: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype:'Data',\n\t\t\t\t\tfieldname:\"docname\",\n\t\t\t\t\thidden: 1\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"item_code\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tlabel: __('Item Code')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"alternate_item\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Alternate Item'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst item_code = this.get_value();\n\t\t\t\t\t\tconst warehouse = this.grid_row.on_grid_fields_dict.warehouse.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tget_query: (e) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items\",\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\titem_code: e.item_code\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"warehouse\",\n\t\t\t\t\toptions: 'Warehouse',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Warehouse'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst warehouse = this.get_value();\n\t\t\t\t\t\tconst item_code = this.grid_row.on_grid_fields_dict.item_code.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Float',\n\t\t\t\t\tfieldname:\"actual_qty\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Available Qty')\n\t\t\t\t}]\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst args = this.get_values()[\"alternative_items\"];\n\t\t\tconst alternative_items = args.filter(d => {\n\t\t\t\tif (d.alternate_item && d.item_code != d.alternate_item) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\talternative_items.forEach(d => {\n\t\t\t\tlet row = frappe.get_doc(opts.child_doctype, d.docname);\n\t\t\t\tlet qty = null;\n\t\t\t\tif (row.doctype === 'Work Order Item') {\n\t\t\t\t\tqty = row.required_qty;\n\t\t\t\t} else {\n\t\t\t\t\tqty = row.qty;\n\t\t\t\t}\n\t\t\t\trow[item_field] = d.alternate_item;\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'qty', qty);\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, opts.original_item_field, d.item_code);\n\t\t\t\tfrm.trigger(item_field, row.doctype, row.name);\n\t\t\t});\n\n\t\t\trefresh_field(opts.child_docname);\n\t\t\tthis.hide();\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tif (!opts.condition || opts.condition(d)) {\n\t\t\tdialog.fields_dict.alternative_items.df.data.push({\n\t\t\t\t\"docname\": d.name,\n\t\t\t\t\"item_code\": d[item_field],\n\t\t\t\t\"warehouse\": d[warehouse_field],\n\t\t\t\t\"actual_qty\": d.actual_qty\n\t\t\t});\n\t\t}\n\t})\n\n\tthis.data = dialog.fields_dict.alternative_items.df.data;\n\tdialog.fields_dict.alternative_items.grid.refresh();\n\tdialog.show();\n}\n\nerpnext.utils.update_child_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst cannot_add_row = (typeof opts.cannot_add_row === 'undefined') ? true : opts.cannot_add_row;\n\tconst child_docname = (typeof opts.cannot_add_row === 'undefined') ? \"items\" : opts.child_docname;\n\tconst child_meta = frappe.get_meta(`${frm.doc.doctype} Item`);\n\tconst get_precision = (fieldname) => child_meta.fields.find(f => f.fieldname == fieldname).precision;\n\n\tthis.data = [];\n\tconst fields = [{\n\t\tfieldtype:'Data',\n\t\tfieldname:\"docname\",\n\t\tread_only: 1,\n\t\thidden: 1,\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:\"item_code\",\n\t\toptions: 'Item',\n\t\tin_list_view: 1,\n\t\tread_only: 0,\n\t\tdisabled: 0,\n\t\tlabel: __('Item Code'),\n\t\tget_query: function() {\n\t\t\tlet filters;\n\t\t\tif (frm.doc.doctype == 'Sales Order') {\n\t\t\t\tfilters = {\"is_sales_item\": 1};\n\t\t\t} else if (frm.doc.doctype == 'Purchase Order') {\n\t\t\t\tif (frm.doc.is_subcontracted) {\n\t\t\t\t\tif (frm.doc.is_old_subcontracting_flow) {\n\t\t\t\t\t\tfilters = {\"is_sub_contracted_item\": 1};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfilters = {\"is_stock_item\": 0};\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfilters = {\"is_purchase_item\": 1};\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\n\t\t\t\tfilters: filters\n\t\t\t};\n\t\t}\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:'uom',\n\t\toptions: 'UOM',\n\t\tread_only: 0,\n\t\tlabel: __('UOM'),\n\t\treqd: 1,\n\t\tonchange: function () {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\targs: { item_code: this.doc.item_code, uom: this.value },\n\t\t\t\tcallback: r => {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif (this.doc.conversion_factor == r.message.conversion_factor) return;\n\n\t\t\t\t\t\tconst docname = this.doc.docname;\n\t\t\t\t\t\tdialog.fields_dict.trans_items.df.data.some(doc => {\n\t\t\t\t\t\t\tif (doc.docname == docname) {\n\t\t\t\t\t\t\t\tdoc.conversion_factor = r.message.conversion_factor;\n\t\t\t\t\t\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tfieldtype:'Float',\n\t\tfieldname:\"qty\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Qty'),\n\t\tprecision: get_precision(\"qty\")\n\t}, {\n\t\tfieldtype:'Currency',\n\t\tfieldname:\"rate\",\n\t\toptions: \"currency\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Rate'),\n\t\tprecision: get_precision(\"rate\")\n\t}];\n\n\tif (frm.doc.doctype == 'Sales Order' || frm.doc.doctype == 'Purchase Order' ) {\n\t\tfields.splice(2, 0, {\n\t\t\tfieldtype: 'Date',\n\t\t\tfieldname: frm.doc.doctype == 'Sales Order' ? \"delivery_date\" : \"schedule_date\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: frm.doc.doctype == 'Sales Order' ? __(\"Delivery Date\") : __(\"Reqd by date\"),\n\t\t\treqd: 1\n\t\t})\n\t\tfields.splice(3, 0, {\n\t\t\tfieldtype: 'Float',\n\t\t\tfieldname: \"conversion_factor\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: __(\"Conversion Factor\"),\n\t\t\tprecision: get_precision('conversion_factor')\n\t\t})\n\t}\n\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Update Items\"),\n\t\tfields: [\n\t\t\t{\n\t\t\t\tfieldname: \"trans_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tcannot_add_rows: cannot_add_row,\n\t\t\t\tin_place_edit: false,\n\t\t\t\treqd: 1,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: fields\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst trans_items = this.get_values()[\"trans_items\"].filter((item) => !!item.item_code);\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'erpnext.controllers.accounts_controller.update_child_qty_rate',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\t'parent_doctype': frm.doc.doctype,\n\t\t\t\t\t'trans_items': trans_items,\n\t\t\t\t\t'parent_doctype_name': frm.doc.name,\n\t\t\t\t\t'child_docname': child_docname\n\t\t\t\t},\n\t\t\t\tcallback: function() {\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.hide();\n\t\t\trefresh_field(\"items\");\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tdialog.fields_dict.trans_items.df.data.push({\n\t\t\t\"docname\": d.name,\n\t\t\t\"name\": d.name,\n\t\t\t\"item_code\": d.item_code,\n\t\t\t\"delivery_date\": d.delivery_date,\n\t\t\t\"schedule_date\": d.schedule_date,\n\t\t\t\"conversion_factor\": d.conversion_factor,\n\t\t\t\"qty\": d.qty,\n\t\t\t\"rate\": d.rate,\n\t\t\t\"uom\": d.uom\n\t\t});\n\t\tthis.data = dialog.fields_dict.trans_items.df.data;\n\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t})\n\tdialog.show();\n}\n\nerpnext.utils.map_current_doc = function(opts) {\n\tfunction _map() {\n\t\tif($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n\t\t\t// remove first item row if empty\n\t\t\tif(!cur_frm.doc.items[0].item_code) {\n\t\t\t\tcur_frm.doc.items = cur_frm.doc.items.splice(1);\n\t\t\t}\n\n\t\t\t// find the doctype of the items table\n\t\t\tvar items_doctype = frappe.meta.get_docfield(cur_frm.doctype, 'items').options;\n\n\t\t\t// find the link fieldname from items table for the given\n\t\t\t// source_doctype\n\t\t\tvar link_fieldname = null;\n\t\t\tfrappe.get_meta(items_doctype).fields.forEach(function(d) {\n\t\t\t\tif(d.options===opts.source_doctype) link_fieldname = d.fieldname; });\n\n\t\t\t// search in existing items if the source_name is already set and full qty fetched\n\t\t\tvar already_set = false;\n\t\t\tvar item_qty_map = {};\n\n\t\t\t$.each(cur_frm.doc.items, function(i, d) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tif(d[link_fieldname]==src) {\n\t\t\t\t\t\talready_set = true;\n\t\t\t\t\t\tif (item_qty_map[d.item_code])\n\t\t\t\t\t\t\titem_qty_map[d.item_code] += flt(d.qty);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\titem_qty_map[d.item_code] = flt(d.qty);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif(already_set) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tfrappe.model.with_doc(opts.source_doctype, src, function(r) {\n\t\t\t\t\t\tvar source_doc = frappe.model.get_doc(opts.source_doctype, src);\n\t\t\t\t\t\t$.each(source_doc.items || [], function(i, row) {\n\t\t\t\t\t\t\tif(row.qty > flt(item_qty_map[row.item_code])) {\n\t\t\t\t\t\t\t\talready_set = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tif(already_set) {\n\t\t\t\t\t\tfrappe.msgprint(__(\"You have already selected items from {0} {1}\",\n\t\t\t\t\t\t\t[opts.source_doctype, src]));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.call({\n\t\t\t// Sometimes we hit the limit for URL length of a GET request\n\t\t\t// as we send the full target_doc. Hence this is a POST request.\n\t\t\ttype: \"POST\",\n\t\t\tmethod: 'frappe.model.mapper.map_docs',\n\t\t\targs: {\n\t\t\t\t\"method\": opts.method,\n\t\t\t\t\"source_names\": opts.source_name,\n\t\t\t\t\"target_doc\": cur_frm.doc,\n\t\t\t\t\"args\": opts.args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tcur_frm.dirty();\n\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tlet query_args = {};\n\tif (opts.get_query_filters) {\n\t\tquery_args.filters = opts.get_query_filters;\n\t}\n\n\tif (opts.get_query_method) {\n\t\tquery_args.query = opts.get_query_method;\n\t}\n\n\tif (query_args.filters || query_args.query) {\n\t\topts.get_query = () => query_args;\n\t}\n\n\tif (opts.source_doctype) {\n\t\tconst d = new frappe.ui.form.MultiSelectDialog({\n\t\t\tdoctype: opts.source_doctype,\n\t\t\ttarget: opts.target,\n\t\t\tdate_field: opts.date_field || undefined,\n\t\t\tsetters: opts.setters,\n\t\t\tget_query: opts.get_query,\n\t\t\tadd_filters_group: 1,\n\t\t\tallow_child_item_selection: opts.allow_child_item_selection,\n\t\t\tchild_fieldname: opts.child_fieldname,\n\t\t\tchild_columns: opts.child_columns,\n\t\t\tsize: opts.size,\n\t\t\taction: function(selections, args) {\n\t\t\t\tlet values = selections;\n\t\t\t\tif (values.length === 0) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please select {0}\", [opts.source_doctype]))\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\topts.source_name = values;\n\t\t\t\tif (opts.allow_child_item_selection) {\n\t\t\t\t\t// args contains filtered child docnames\n\t\t\t\t\topts.args = args;\n\t\t\t\t}\n\t\t\t\td.dialog.hide();\n\t\t\t\t_map();\n\t\t\t},\n\t\t});\n\n\t\treturn d;\n\t}\n\n\tif (opts.source_name) {\n\t\topts.source_name = [opts.source_name];\n\t\t_map();\n\t}\n}\n\nfrappe.form.link_formatters['Item'] = function(value, doc) {\n\tif (doc && value && doc.item_name && doc.item_name !== value && doc.item_code === value) {\n\t\treturn value + ': ' + doc.item_name;\n\t} else if (!value && doc.doctype && doc.item_name) {\n\t\t// format blank value in child table\n\t\treturn doc.item_name;\n\t} else {\n\t\t// if value is blank in report view or item code and name are the same, return as is\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Employee'] = function(value, doc) {\n\tif (doc && value && doc.employee_name && doc.employee_name !== value && doc.employee === value) {\n\t\treturn value + ': ' + doc.employee_name;\n\t} else if (!value && doc.doctype && doc.employee_name) {\n\t\t// format blank value in child table\n\t\treturn doc.employee;\n\t} else {\n\t\t// if value is blank in report view or project name and name are the same, return as is\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Project'] = function(value, doc) {\n\tif (doc && value && doc.project_name && doc.project_name !== value && doc.project === value) {\n\t\treturn value + ': ' + doc.project_name;\n\t} else if (!value && doc.doctype && doc.project_name) {\n\t\t// format blank value in child table\n\t\treturn doc.project;\n\t} else {\n\t\t// if value is blank in report view or project name and name are the same, return as is\n\t\treturn value;\n\t}\n};\n\n// add description on posting time\n$(document).on('app_ready', function() {\n\tif(!frappe.datetime.is_timezone_same()) {\n\t\t$.each([\"Stock Reconciliation\", \"Stock Entry\", \"Stock Ledger Entry\",\n\t\t\t\"Delivery Note\", \"Purchase Receipt\", \"Sales Invoice\"], function(i, d) {\n\t\t\tfrappe.ui.form.on(d, \"onload\", function(frm) {\n\t\t\t\tcur_frm.set_df_property(\"posting_time\", \"description\",\n\t\t\t\t\tfrappe.sys_defaults.time_zone);\n\t\t\t});\n\t\t});\n\t}\n});\n\n// Show SLA dashboard\n$(document).on('app_ready', function() {\n\tfrappe.call({\n\t\tmethod: 'erpnext.support.doctype.service_level_agreement.service_level_agreement.get_sla_doctypes',\n\t\tcallback: function(r) {\n\t\t\tif (!r.message)\n\t\t\t\treturn;\n\n\t\t\t$.each(r.message, function(_i, d) {\n\t\t\t\tfrappe.ui.form.on(d, {\n\t\t\t\t\tonload: function(frm) {\n\t\t\t\t\t\tif (!frm.doc.service_level_agreement)\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: 'erpnext.support.doctype.service_level_agreement.service_level_agreement.get_service_level_agreement_filters',\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\t\t\t\tname: frm.doc.service_level_agreement,\n\t\t\t\t\t\t\t\tcustomer: frm.doc.customer\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\t\tif (r && r.message) {\n\t\t\t\t\t\t\t\t\tfrm.set_query('priority', function() {\n\t\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\t\t\t\t'name': ['in', r.message.priority],\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfrm.set_query('service_level_agreement', function() {\n\t\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\t\t\t\t'name': ['in', r.message.service_level_agreements],\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\n\t\t\t\t\trefresh: function(frm) {\n\t\t\t\t\t\tif (frm.doc.status !== 'Closed' && frm.doc.service_level_agreement\n\t\t\t\t\t\t\t&& ['First Response Due', 'Resolution Due'].includes(frm.doc.agreement_status)) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t'method': 'frappe.client.get',\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\tdoctype: 'Service Level Agreement',\n\t\t\t\t\t\t\t\t\tname: frm.doc.service_level_agreement\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: function(data) {\n\t\t\t\t\t\t\t\t\tlet statuses = data.message.pause_sla_on;\n\t\t\t\t\t\t\t\t\tconst hold_statuses = [];\n\t\t\t\t\t\t\t\t\t$.each(statuses, (_i, entry) => {\n\t\t\t\t\t\t\t\t\t\thold_statuses.push(entry.status);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (hold_statuses.includes(frm.doc.status)) {\n\t\t\t\t\t\t\t\t\t\tfrm.dashboard.clear_headline();\n\t\t\t\t\t\t\t\t\t\tlet message = {'indicator': 'orange', 'msg': __('SLA is on hold since {0}', [moment(frm.doc.on_hold_since).fromNow(true)])};\n\t\t\t\t\t\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t\t\t\t\t\t'<div class=\"row\">' +\n\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"col-xs-12\">' +\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<span class=\"indicator whitespace-nowrap '+ message.indicator +'\"><span>'+ message.msg +'</span></span> ' +\n\t\t\t\t\t\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tset_time_to_resolve_and_response(frm, data.message.apply_sla_for_resolution);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (frm.doc.service_level_agreement) {\n\t\t\t\t\t\t\tfrm.dashboard.clear_headline();\n\n\t\t\t\t\t\t\tlet agreement_status = (frm.doc.agreement_status == 'Fulfilled') ?\n\t\t\t\t\t\t\t\t{'indicator': 'green', 'msg': 'Service Level Agreement has been fulfilled'} :\n\t\t\t\t\t\t\t\t{'indicator': 'red', 'msg': 'Service Level Agreement Failed'};\n\n\t\t\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t\t\t'<div class=\"row\">' +\n\t\t\t\t\t\t\t\t\t'<div class=\"col-xs-12\">' +\n\t\t\t\t\t\t\t\t\t\t'<span class=\"indicator whitespace-nowrap '+ agreement_status.indicator +'\"><span class=\"hidden-xs\">'+ agreement_status.msg +'</span></span> ' +\n\t\t\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n});\n\nfunction set_time_to_resolve_and_response(frm, apply_sla_for_resolution) {\n\tfrm.dashboard.clear_headline();\n\n\tlet time_to_respond;\n\tif (!frm.doc.first_responded_on) {\n\t\ttime_to_respond = get_time_left(frm.doc.response_by, frm.doc.agreement_status);\n\t} else {\n\t\ttime_to_respond = get_status(frm.doc.response_by, frm.doc.first_responded_on);\n\t}\n\n\tlet alert = `\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-xs-12 col-sm-6\">\n\t\t\t\t<span class=\"indicator whitespace-nowrap ${time_to_respond.indicator}\">\n\t\t\t\t\t<span>Time to Respond: ${time_to_respond.diff_display}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\n\n\tif (apply_sla_for_resolution) {\n\t\tlet time_to_resolve;\n\t\tif (!frm.doc.resolution_date) {\n\t\t\ttime_to_resolve = get_time_left(frm.doc.resolution_by, frm.doc.agreement_status);\n\t\t} else {\n\t\t\ttime_to_resolve = get_status(frm.doc.resolution_by, frm.doc.resolution_date);\n\t\t}\n\n\t\talert += `\n\t\t\t<div class=\"col-xs-12 col-sm-6\">\n\t\t\t\t<span class=\"indicator whitespace-nowrap ${time_to_resolve.indicator}\">\n\t\t\t\t\t<span>Time to Resolve: ${time_to_resolve.diff_display}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\t}\n\n\talert += '</div>';\n\n\tfrm.dashboard.set_headline_alert(alert);\n}\n\nfunction get_time_left(timestamp, agreement_status) {\n\tconst diff = moment(timestamp).diff(moment());\n\tconst diff_display = diff >= 44500 ? moment.duration(diff).humanize() : 'Failed';\n\tlet indicator = (diff_display == 'Failed' && agreement_status != 'Fulfilled') ? 'red' : 'green';\n\treturn {'diff_display': diff_display, 'indicator': indicator};\n}\n\nfunction get_status(expected, actual) {\n\tconst time_left = moment(expected).diff(moment(actual));\n\tif (time_left >= 0) {\n\t\treturn {'diff_display': 'Fulfilled', 'indicator': 'green'};\n\t} else {\n\t\treturn {'diff_display': 'Failed', 'indicator': 'red'};\n\t}\n}\n\nfunction attach_selector_button(inner_text, append_loction, context, grid_row) {\n\tlet $btn_div = $(\"<div>\").css({\"margin-bottom\": \"10px\", \"margin-top\": \"10px\"})\n\t\t.appendTo(append_loction);\n\tlet $btn = $(`<button class=\"btn btn-sm btn-default\">${inner_text}</button>`)\n\t\t.appendTo($btn_div);\n\n\t$btn.on(\"click\", function() {\n\t\tcontext.show_serial_batch_selector(grid_row.frm, grid_row.doc, \"\", \"\", true);\n\t});\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"erpnext.queries\");\n$.extend(erpnext.queries, {\n\tuser: function() {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function() {\n\t\treturn { query: \"erpnext.controllers.queries.lead_query\" };\n\t},\n\n\tcustomer: function() {\n\t\treturn { query: \"erpnext.controllers.queries.customer_query\" };\n\t},\n\n\tsupplier: function() {\n\t\treturn { query: \"erpnext.controllers.queries.supplier_query\" };\n\t},\n\n\titem: function(filters) {\n\t\tvar args = { query: \"erpnext.controllers.queries.item_query\" };\n\t\tif(filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function() {\n\t\treturn { query: \"erpnext.controllers.queries.bom\" };\n\t},\n\n\ttask: function() {\n\t\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function(doc) {\n\t\tif(!doc.customer) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.contact.contact.contact_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\taddress_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { is_your_company_address: 1, link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tdispatch_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tsupplier_filter: function(doc) {\n\t\tif(!doc.supplier) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function(doc) {\n\t\tif(!doc.lead) {\n\t\t\tfrappe.throw(__(\"Please specify a {0}\",\n\t\t\t\t[__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function() {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function() {\n\t\treturn { query: \"erpnext.controllers.queries.employee_query\" }\n\t},\n\n\twarehouse: function(doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\",0]\n\n\t\t\t]\n\t\t};\n\t},\n\n\tget_filtered_dimensions: function(doc, child_fields, dimension, company) {\n\t\tlet account = '';\n\n\t\tchild_fields.forEach((field) => {\n\t\t\tif (!account) {\n\t\t\t\taccount = doc[field];\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tquery: \"erpnext.controllers.queries.get_filtered_dimensions\",\n\t\t\tfilters: {\n\t\t\t\t'dimension': dimension,\n\t\t\t\t'account': account,\n\t\t\t\t'company': company\n\t\t\t}\n\t\t};\n\t}\n});\n\nerpnext.queries.setup_queries = function(frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function(doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name,\n\t\t\t{\"fieldtype\": \"Link\", \"options\": options});\n\t\t$.each(link_fields, function(i, df) {\n\t\t\tif(parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(frappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, {\"fieldtype\": \"Table\"}),\n\t\tfunction(i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t});\n}\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nerpnext.queries.setup_warehouse_query = function(frm){\n\tfrm.set_query('warehouse', 'items', function(doc, cdt, cdn) {\n\t\tvar row  = locals[cdt][cdn];\n\t\tvar filters = erpnext.queries.warehouse(frm.doc);\n\t\tif(row.item_code){\n\t\t\t$.extend(filters, {\"query\":\"erpnext.controllers.queries.warehouse_query\"});\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters\n\t});\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function() {\n\t\tvar default_msg = {\n\t\t\t'Lead'\t\t\t\t: '',\n\t\t\t'Opportunity'\t\t\t: 'Your enquiry has been logged into the system. Ref No: ' + doc.name,\n\t\t\t'Quotation'\t\t\t: 'Quotation ' + doc.name + ' has been sent via email. Thanks!',\n\t\t\t'Sales Order'\t\t: 'Sales Order ' + doc.name + ' has been created against '\n\t\t\t\t\t\t+ (doc.quotation_no ? ('Quote No:' + doc.quotation_no) : '')\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Delivery Note'\t\t: 'Items has been delivered against delivery note: ' + doc.name\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Sales Invoice': 'Invoice ' + doc.name + ' has been sent via email '\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Material Request'\t\t\t: 'Material Request ' + doc.name + ' has been raised in the system',\n\t\t\t'Purchase Order'\t: 'Purchase Order ' + doc.name + ' has been sent via email',\n\t\t\t'Purchase Receipt'\t: 'Items has been received against purchase receipt: ' + doc.name\n\t\t}\n\n\t\tif (in_list(['Sales Order', 'Delivery Note', 'Sales Invoice'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.customer, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype === 'Quotation')\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.party_name, '', default_msg[doc.doctype]);\n\t\telse if (in_list(['Purchase Order', 'Purchase Receipt'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Supplier', doc.supplier, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Lead')\n\t\t\tthis.show('', '', '', doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Opportunity')\n\t\t\tthis.show('', '', '', doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Material Request')\n\t\t\tthis.show('', '', '', '', default_msg[doc.doctype]);\n\n\t};\n\n\tthis.get_contact_number = function(contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) { frappe.msgprint(r.exc); return; }\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.show = function(contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact){\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name)\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t}\n\tthis.show_dialog = function() {\n\t\tif(!me.dialog)\n\t\t\tme.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\t'message': me.message,\n\t\t\t'number': me.number\n\t\t})\n\t\tme.dialog.show();\n\t}\n\tthis.make_dialog = function() {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: 'Send SMS',\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{fieldname:'number', fieldtype:'Data', label:'Mobile Number', reqd:1},\n\t\t\t\t{fieldname:'message', fieldtype:'Text', label:'Message', reqd:1},\n\t\t\t\t{fieldname:'send', fieldtype:'Button', label:'Send'}\n\t\t\t]\n\t\t})\n\t\td.fields_dict.send.input.onclick = function() {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif(v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif(r.exc) {frappe.msgprint(r.exc); return; }\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.dialog = d;\n\t}\n\tthis.setup();\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.utils\");\n\nconst SALES_DOCTYPES = ['Quotation', 'Sales Order', 'Delivery Note', 'Sales Invoice'];\nconst PURCHASE_DOCTYPES = ['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'];\n\nerpnext.utils.get_party_details = function(frm, method, args, callback) {\n\tif (!method) {\n\t\tmethod = \"erpnext.accounts.party.get_party_details\";\n\t}\n\n\tif (!args) {\n\t\tif ((frm.doctype != \"Purchase Order\" && frm.doc.customer)\n\t\t\t|| (frm.doc.party_name && in_list(['Quotation', 'Opportunity'], frm.doc.doctype))) {\n\n\t\t\tlet party_type = \"Customer\";\n\t\t\tif (frm.doc.quotation_to && frm.doc.quotation_to === \"Lead\") {\n\t\t\t\tparty_type = \"Lead\";\n\t\t\t}\n\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\tparty_type: party_type,\n\t\t\t\tprice_list: frm.doc.selling_price_list\n\t\t\t};\n\t\t} else if (frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list\n\t\t\t};\n\t\t}\n\n\t\tif (!args) {\n\t\t\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\t\tparty_type: 'Customer'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\t\tparty_type: 'Supplier'\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!args || !args.party) return;\n\n\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\targs.fetch_payment_terms_template = cint(!frm.doc.ignore_default_payment_terms_template);\n\t}\n\n\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.company_address) {\n\t\t\targs.company_address = frm.doc.company_address;\n\t\t}\n\t}\n\n\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.billing_address) {\n\t\t\targs.company_address = frm.doc.billing_address;\n\t\t}\n\n\t\tif (!args.shipping_address && frm.doc.shipping_address) {\n\t\t\targs.shipping_address = frm.doc.shipping_address;\n\t\t}\n\t}\n\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\targs.posting_date, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) return;\n\t}\n\n\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) {\n\t\treturn;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function(r) {\n\t\t\tif (r.message) {\n\t\t\t\tfrm.supplier_tds = r.message.supplier_tds;\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif (callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\terpnext.utils.add_item(frm);\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.utils.add_item = function(frm) {\n\tif (frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif (prev_route[1]==='Item' && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child('items');\n\t\t\tfrm.refresh_field('items');\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, 'item_code', prev_route[2]);\n\t\t}\n\t}\n}\n\nerpnext.utils.get_address_display = function(frm, address_field, display_field, is_your_company_address) {\n\tif (frm.updating_party_details) return;\n\n\tif (!address_field) {\n\t\tif (frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if (frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif (!display_field) display_field = \"address_display\";\n\tif (frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: {\"address_dict\": frm.doc[address_field] },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} else {\n\t\tfrm.set_value(display_field, '');\n\t}\n};\n\nerpnext.utils.set_taxes_from_address = function(frm, triggered_from_field, billing_address_field, shipping_address_field) {\n\tif (frm.updating_party_details) return;\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.get_address_tax_category\",\n\t\targs: {\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": frm.doc[billing_address_field],\n\t\t\t\"shipping_address\": frm.doc[shipping_address_field]\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (!r.exc){\n\t\t\t\tif (frm.doc.tax_category != r.message) {\n\t\t\t\t\tfrm.set_value(\"tax_category\", r.message);\n\t\t\t\t} else {\n\t\t\t\t\terpnext.utils.set_taxes(frm, triggered_from_field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.set_taxes = function(frm, triggered_from_field) {\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = 'Lead';\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = 'Customer';\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = 'Supplier';\n\t\tparty = frm.doc.supplier;\n\t} else if (frm.doc.quotation_to){\n\t\tparty_type = frm.doc.quotation_to;\n\t\tparty = frm.doc.party_name;\n\t}\n\n\tif (!frm.doc.company) {\n\t\tfrappe.throw(__(\"Kindly select the company first\"));\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\t\"party\": party,\n\t\t\t\"party_type\": party_type,\n\t\t\t\"posting_date\": frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\"company\": frm.doc.company,\n\t\t\t\"customer_group\": frm.doc.customer_group,\n\t\t\t\"supplier_group\": frm.doc.supplier_group,\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": ((frm.doc.customer || frm.doc.lead) ? (frm.doc.customer_address) : (frm.doc.supplier_address)),\n\t\t\t\"shipping_address\": frm.doc.shipping_address_name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (r.message){\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message)\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.get_contact_details = function (frm) {\n\tif (frm.updating_party_details) return;\n\n\tif (frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: { contact: frm.doc.contact_person },\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) frm.set_value(r.message);\n\t\t\t},\n\t\t});\n\t} else {\n\t\tfrm.set_value({\n\t\t\tcontact_person: \"\",\n\t\t\tcontact_display: \"\",\n\t\t\tcontact_email: \"\",\n\t\t\tcontact_mobile: \"\",\n\t\t\tcontact_phone: \"\",\n\t\t\tcontact_designation: \"\",\n\t\t\tcontact_department: \"\",\n\t\t});\n\t}\n};\n\nerpnext.utils.validate_mandatory = function(frm, label, value, trigger_on) {\n\tif (!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.throw({message:__(\"Please enter {0} first\", [label]), title:__(\"Mandatory\")});\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nerpnext.utils.get_shipping_address = function(frm, callback) {\n\tif (frm.doc.company) {\n\t\tif ((frm.doc.inter_company_order_reference || frm.doc.internal_invoice_reference ||\n\t\t\tfrm.doc.internal_order_reference)) {\n\t\t\tif (callback) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t}\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.custom.address.get_shipping_address\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\taddress: frm.doc.shipping_address\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]) //Address title or name\n\t\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]) //Address to be displayed on the page\n\t\t\t\t}\n\n\t\t\t\tif (callback){\n\t\t\t\t\treturn callback();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} else {\n\t\tfrappe.msgprint(__(\"Select company first\"));\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.stock\");\n\nerpnext.stock.StockController = class StockController extends frappe.ui.form.Controller {\n\tonload() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t}\n\n\tsetup_warehouse_query() {\n\t\tvar me = this;\n\t\terpnext.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn erpnext.queries.warehouse(me.frm.doc);\n\t\t});\n\t}\n\n\tsetup_posting_date_time_check() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t}\n\n\tshow_stock_ledger() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t}\n\n\tshow_general_ledger() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by: \"Group by Voucher (Consolidated)\",\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.payments = class payments extends erpnext.stock.StockController {\n\tmake_payment() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Payment'\n\t\t});\n\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text();\n\t}\n\n\tselect_text() {\n\t\t$(this.$body).find('.form-control').click(function() {\n\t\t\t$(this).select();\n\t\t});\n\t}\n\n\tset_payment_primary_action() {\n\t\tvar me = this;\n\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function() {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t}\n\n\tmake_keyboard(){\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template('pos_payment', this.frm.doc))\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event()\n\t\tthis.clear_amount()\n\t}\n\n\tmake_multimode_payment(){\n\t\tvar me = this;\n\n\t\tif (this.frm.doc.change_amount > 0) {\n\t\t\tme.payment_val = me.doc.outstanding_amount;\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, 'Multi Mode Payment', \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t}\n\n\tshow_payment_details(){\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find('.multimode-payments').empty();\n\t\tif (this.frm.doc.payments.length) {\n\t\t\t$.each(this.frm.doc.payments, function(index, data) {\n\t\t\t\t$(frappe.render_template('payment_details', {\n\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\tamount: data.amount,\n\t\t\t\t\tidx: data.idx,\n\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\ttype: data.type\n\t\t\t\t})).appendTo(multimode_payments)\n\n\t\t\t\tif (data.type == 'Cash' && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t})\n\t\t}else{\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments)\n\t\t}\n\t}\n\n\tset_outstanding_amount(){\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': this.idx}));\n\t\tthis.highlight_selected_row();\n\t\tthis.payment_val = 0.0;\n\t\tif (this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0) {\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(this.frm.doc.outstanding_amount / this.frm.doc.conversion_rate, precision(\"outstanding_amount\"))\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount();\n\t\t} else if (flt(this.selected_mode.val()) > 0) {\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select()\n\t\tthis.bind_amount_change_event();\n\t}\n\n\tbind_keyboard_event(){\n\t\tvar me = this;\n\t\tthis.payment_val = '';\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t}\n\n\tbind_form_control_event() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-payment-row').click(function() {\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t});\n\n\t\t$(this.$body).find('.form-control').click(function() {\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t\tme.update_paid_amount(true);\n\t\t});\n\n\t\t$(this.$body).find('.write_off_amount').change(function() {\n\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t});\n\n\t\t$(this.$body).find('.change_amount').change(function() {\n\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t});\n\t}\n\n\thighlight_selected_row() {\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\", {'idx': this.idx}));\n\t\t$(this.$body).find('.pos-payment-row').removeClass('selected-payment-mode');\n\t\tselected_row.addClass('selected-payment-mode');\n\t\t$(this.$body).find('.amount').attr('disabled', true);\n\t\tthis.selected_mode.attr('disabled', false);\n\t}\n\n\tbind_numeric_keys_event() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-keyboard-key').click(function(){\n\t\t\tme.payment_val += $(this).text();\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_paid_amount();\n\t\t});\n\n\t\t$(this.$body).find('.delete-btn').click(function() {\n\t\t\tme.payment_val =  cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_paid_amount();\n\t\t})\n\n\t}\n\n\tbind_amount_change_event() {\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function() {\n\t\t\tme.payment_val =  flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_payment_amount();\n\t\t});\n\t}\n\n\tclear_amount() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.clr').click(function(e) {\n\t\t\te.stopPropagation();\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\tme.payment_val = 0.0;\n\t\t\tme.selected_mode.val(0.0);\n\t\t\tme.highlight_selected_row();\n\t\t\tme.update_payment_amount();\n\t\t});\n\t}\n\n\twrite_off_amount(write_off_amount) {\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\"));\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t}\n\n\tchange_amount(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount();\n\t\tthis.show_amounts();\n\t}\n\n\tupdate_paid_amount(update_write_off) {\n\t\tvar me = this;\n\t\tif (in_list(['change_amount', 'write_off_amount'], this.idx)) {\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif (me.idx == 'change_amount') {\n\t\t\t\tme.change_amount(value);\n\t\t\t} else {\n\t\t\t\tif(flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(me.frm.doc.outstanding_amount / me.frm.doc.conversion_rate, precision(me.idx));\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.update_payment_amount();\n\t\t}\n\t}\n\n\tupdate_payment_amount(){\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function(index, data) {\n\t\t\tif (cint(me.idx) == cint(data.idx)) {\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2);\n\t\t\t}\n\t\t})\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t}\n\n\tshow_amounts(){\n\t\tvar me = this;\n\t\t$(this.$body).find(\".write_off_amount\").val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.paid_amount').text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.change_amount').val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.outstanding_amount').text(format_currency(this.frm.doc.outstanding_amount, frappe.get_doc(\":Company\", this.frm.doc.company).default_currency));\n\t\tthis.update_invoice();\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.taxes_and_totals = class TaxesAndTotals extends erpnext.payments {\n\tsetup() {\n\t\tthis.fetch_round_off_accounts();\n\t}\n\n\tapply_pricing_rule_on_item(item) {\n\t\tlet effective_item_rate = item.price_list_rate;\n\t\tlet item_rate = item.rate;\n\t\tif (in_list([\"Sales Order\", \"Quotation\"], item.parenttype) && item.blanket_order_rate) {\n\t\t\teffective_item_rate = item.blanket_order_rate;\n\t\t}\n\t\tif (item.margin_type == \"Percentage\") {\n\t\t\titem.rate_with_margin = flt(effective_item_rate)\n\t\t\t\t+ flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n\t\t}\n\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\n\t\titem_rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif (item.discount_percentage) {\n\t\t\titem.discount_amount = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t}\n\n\t\tif (item.discount_amount) {\n\t\t\titem_rate = flt((item.rate_with_margin) - (item.discount_amount), precision('rate', item));\n\t\t\titem.discount_percentage = 100 * flt(item.discount_amount) / flt(item.rate_with_margin);\n\t\t}\n\n\t\tfrappe.model.set_value(item.doctype, item.name, \"rate\", item_rate);\n\t}\n\n\tasync calculate_taxes_and_totals(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// # Update grand total as per cash and non trade discount\n\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\tthis.frm.doc.grand_total -= this.frm.doc.discount_amount;\n\t\t\tthis.frm.doc.base_grand_total -= this.frm.doc.base_discount_amount;\n\t\t}\n\n\t\tawait this.calculate_shipping_charges();\n\n\t\t// Advance calculation applicable to Sales/Purchase Invoice\n\t\tif (\n\t\t\tin_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2\n\t\t\t&& !this.frm.doc.is_return\n\t\t) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\tif (\n\t\t\tin_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.is_pos\n\t\t\t&& this.frm.doc.is_return\n\t\t) {\n\t\t\tthis.set_total_amount_to_default_mop();\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif (in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\t// Update paid amount on return/debit note creation\n\t\tif (\n\t\t\tthis.frm.doc.doctype === \"Purchase Invoice\"\n\t\t\t&& this.frm.doc.is_return\n\t\t\t&& (this.frm.doc.grand_total > this.frm.doc.paid_amount)\n\t\t) {\n\t\t\tthis.frm.doc.paid_amount = flt(this.frm.doc.grand_total, precision(\"grand_total\"));\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tcalculate_discount_amount() {\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t}\n\n\t_calculate_taxes_and_totals() {\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t}\n\n\tvalidate_conversion_rate() {\n\t\tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t\tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t\t\tthis.frm.doc.name);\n\t\tvar company_currency = this.get_company_currency();\n\n\t\tif(!this.frm.doc.conversion_rate) {\n\t\t\tif(this.frm.doc.currency == company_currency) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t\t\t} else {\n\t\t\t\tconst subs =  [conversion_rate_label, this.frm.doc.currency, company_currency];\n\t\t\t\tconst err_message = __('{0} is mandatory. Maybe Currency Exchange record is not created for {1} to {2}', subs);\n\t\t\t\tfrappe.throw(err_message);\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_item_values() {\n\t\tvar me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\n\t\t\t\tif ((!item.qty) && me.frm.doc.is_return) {\n\t\t\t\t\titem.amount = flt(item.rate * -1, precision(\"amount\", item));\n\t\t\t\t} else if ((!item.qty) && me.frm.doc.is_debit_note) {\n\t\t\t\t\titem.amount = flt(item.rate, precision(\"amount\", item));\n\t\t\t\t} else {\n\t\t\t\t\titem.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\t}\n\n\t\t\t\titem.net_amount = item.amount;\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t});\n\t\t}\n\t}\n\n\tset_in_company_currency(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t}\n\n\tinitialize_taxes() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\ttax.item_wise_tax_detail = {};\n\t\t\t}\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t\t\tif (!this.discount_amount_applied && cur_frm) {\n\t\t\t\tcur_frm.cscript.validate_taxes_and_charges(tax.doctype, tax.name);\n\t\t\t\tme.validate_inclusive_tax(tax);\n\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t}\n\n\tfetch_round_off_accounts() {\n\t\tlet me = this;\n\t\tfrappe.flags.round_off_applicable_accounts = [];\n\n\t\tif (me.frm.doc.company) {\n\t\t\treturn frappe.call({\n\t\t\t\t\"method\": \"erpnext.controllers.taxes_and_totals.get_round_off_applicable_accounts\",\n\t\t\t\t\"args\": {\n\t\t\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\t\t\"account_list\": frappe.flags.round_off_applicable_accounts\n\t\t\t\t},\n\t\t\t\tcallback(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tfrappe.flags.round_off_applicable_accounts.push(...r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tdetermine_exclusive_rate() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\t\t\tvar total_inclusive_tax_amount_per_qty = 0;\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tvar current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n\t\t\t\ttax.tax_fraction_for_current_item = current_tax_fraction[0];\n\t\t\t\tvar inclusive_tax_amount_per_qty = current_tax_fraction[1];\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t\ttotal_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(item.qty);\n\t\t\t});\n\n\t\t\tif(!me.discount_amount_applied && item.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n\t\t\t\tvar amount = flt(item.amount) - total_inclusive_tax_amount_per_qty;\n\t\t\t\titem.net_amount = flt(amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t}\n\n\tget_current_tax_fraction(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\t\tvar inclusive_tax_amount_per_qty = 0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\t\tinclusive_tax_amount_per_qty = flt(tax_rate);\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax && tax.add_deduct_tax == \"Deduct\") {\n\t\t\tcurrent_tax_fraction *= -1;\n\t\t\tinclusive_tax_amount_per_qty *= -1;\n\t\t}\n\t\treturn [current_tax_fraction, inclusive_tax_amount_per_qty];\n\t}\n\n\t_get_tax_rate(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t}\n\n\tcalculate_net_total() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t\t});\n\t}\n\n\tcalculate_shipping_charges() {\n\t\t// Do not apply shipping rule for POS\n\t\tif (this.frm.doc.is_pos) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"shipping_rule\", this.frm.doc.name)) {\n\t\t\treturn this.shipping_rule();\n\t\t}\n\t}\n\n\tadd_taxes_from_item_tax_template(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif (item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif (typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif (!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcalculate_taxes() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\tme.round_off_totals(tax);\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\t\t\tme.round_off_base_values(tax);\n\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax, [\"total\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tset_cumulative_total(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t}\n\n\t_load_item_tax_rate(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t}\n\n\tget_current_tax_amount(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\t// To set row_id by default as previous row.\n\t\tif([\"On Previous Row Amount\", \"On Previous Row Total\"].includes(tax.charge_type)) {\n\t\t\tif (tax.idx === 1) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Cannot select charge type as 'On Previous Row Amount' or 'On Previous Row Total' for first row\"));\n\t\t\t}\n\t\t\tif (!tax.row_id) {\n\t\t\t\ttax.row_id = tax.idx - 1;\n\t\t\t}\n\t\t}\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\tcurrent_tax_amount = tax_rate * item.qty;\n\t\t}\n\n\t\tif (!tax.dont_recompute_tax) {\n\t\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\t\t}\n\n\t\treturn current_tax_amount;\n\t}\n\n\tset_item_wise_tax(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tif(typeof (tax_detail) == \"string\") {\n\t\t\ttax.item_wise_tax_detail = JSON.parse(tax.item_wise_tax_detail);\n\t\t\ttax_detail = tax.item_wise_tax_detail;\n\t\t}\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (tax_detail && tax_detail[key])\n\t\t\titem_wise_tax_amount += tax_detail[key][1];\n\n\t\ttax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t}\n\n\tround_off_totals(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.tax_amount= Math.round(tax.tax_amount);\n\t\t\ttax.tax_amount_after_discount_amount = Math.round(tax.tax_amount_after_discount_amount);\n\t\t}\n\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t}\n\n\tround_off_base_values(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.base_tax_amount= Math.round(tax.base_tax_amount);\n\t\t\ttax.base_tax_amount_after_discount_amount = Math.round(tax.base_tax_amount_after_discount_amount);\n\t\t}\n\t}\n\n\tmanipulate_grand_total_for_inclusive_tax() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif(me.discount_amount_applied && me.frm.doc.discount_amount) {\n\t\t\t\t\tdiff -= flt(me.frm.doc.discount_amount);\n\t\t\t\t}\n\n\t\t\t\tdiff = flt(diff, precision(\"rounding_adjustment\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tme.frm.doc.rounding_adjustment = diff;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_totals() {\n\t\t// Changing sequence can cause rounding_adjustmentng issue and on-screen discrepency\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t}\n\n\tset_rounded_total() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t}\n\n\t_cleanup() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\n\t\tif(this.frm.doc[\"items\"] && this.frm.doc[\"items\"].length) {\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"items\"][0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tset_discount_amount() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t}\n\n\tapply_discount_amount() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm.doc.items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t}\n\n\tget_total_for_discount_amount() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif (in_list([\"Actual\", \"On Item Quantity\"], tax.charge_type)) {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t}\n\n\tcalculate_total_advance(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tif (this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = 0;\n\t\t}\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t\tthis.calculate_write_off_amount();\n\t}\n\n\tis_internal_invoice() {\n\t\tif (['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tif (this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tcalculate_outstanding_amount(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif (this.frm.doc.is_return || (this.frm.doc.docstatus > 0) || this.is_internal_invoice()) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(base_grand_total, precision(\"base_grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t}\n\n\tset_total_amount_to_default_mop() {\n\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\tif (this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\tgrand_total - this.frm.doc.total_advance - this.frm.doc.write_off_amount,\n\t\t\t\tprecision(\"grand_total\")\n\t\t\t);\n\t\t} else {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t(\n\t\t\t\t\tflt(\n\t\t\t\t\t\tbase_grand_total,\n\t\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t\t)\n\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount\n\t\t\t\t),\n\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t);\n\t\t}\n\n\t\tthis.frm.doc.payments.find(pay => {\n\t\t\tif (pay.default) {\n\t\t\t\tpay.amount = total_amount_to_pay;\n\t\t\t}\n\t\t});\n\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tset_default_payment(total_amount_to_pay, update_paid_amount) {\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data) {\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tlet base_amount, amount;\n\n\t\t\t\t\tif (me.frm.doc.party_account_currency == me.frm.doc.currency) {\n\t\t\t\t\t\t// if customer/supplier currency is same as company currency\n\t\t\t\t\t\t// total_amount_to_pay is already in customer/supplier currency\n\t\t\t\t\t\t// so base_amount has to be calculated using total_amount_to_pay\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay, precision(\"amount\", data));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\", data));\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"base_amount\", base_amount);\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", amount);\n\t\t\t\t\tpayment_status = false;\n\n\t\t\t\t} else if(me.frm.doc.paid_amount) {\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", 0.0);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcalculate_paid_amount() {\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.set_value('paid_amount', flt(paid_amount, precision(\"paid_amount\")));\n\t\tthis.frm.set_value('base_paid_amount', flt(base_paid_amount, precision(\"base_paid_amount\")));\n\t}\n\n\tcalculate_change_amount(){\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total,\n\t\t\t\t\tprecision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total, precision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_write_off_amount() {\n\t\tif(this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.outstanding_amount, precision(\"write_off_amount\"));\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\n\t\t\tthis.calculate_outstanding_amount(false);\n\t\t}\n\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n\nerpnext.TransactionController = class TransactionController extends erpnext.taxes_and_totals {\n\tsetup() {\n\t\tsuper.setup();\n\t\tlet me = this;\n\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tvar has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n\n\t\t\tfrappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\n\n\t\t\tif(item.price_list_rate) {\n\t\t\t\tif(item.rate > item.price_list_rate && has_margin_field) {\n\t\t\t\t\t// if rate is greater than price_list_rate, set margin\n\t\t\t\t\t// or set discount\n\t\t\t\t\titem.discount_percentage = 0;\n\t\t\t\t\titem.margin_type = 'Amount';\n\t\t\t\t\titem.margin_rate_or_amount = flt(item.rate - item.price_list_rate,\n\t\t\t\t\t\tprecision(\"margin_rate_or_amount\", item));\n\t\t\t\t\titem.rate_with_margin = item.rate;\n\t\t\t\t} else {\n\t\t\t\t\titem.discount_percentage = flt((1 - item.rate / item.price_list_rate) * 100.0,\n\t\t\t\t\t\tprecision(\"discount_percentage\", item));\n\t\t\t\t\titem.discount_amount = flt(item.price_list_rate) - flt(item.rate);\n\t\t\t\t\titem.margin_type = '';\n\t\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\t\titem.rate_with_margin = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\titem.margin_type = '';\n\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\titem.rate_with_margin = 0;\n\t\t\t}\n\t\t\titem.base_rate_with_margin = item.rate_with_margin * flt(frm.doc.conversion_rate);\n\n\t\t\tcur_frm.cscript.set_gross_profit(item);\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\tcur_frm.cscript.calculate_stock_uom_rate(frm, cdt, cdn);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.set_dynamic_labels();\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\n\t\t\tif(frm.doc.additional_discount_percentage) {\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\n\t\t\t} else {\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"additional_discount_percentage\", function(frm) {\n\t\t\tif(!frm.doc.apply_discount_on) {\n\t\t\t\tfrappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrm.via_discount_percentage = true;\n\n\t\t\tif(frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\n\t\t\t\t// Reset discount amount and net / grand total\n\t\t\t\tfrm.doc.discount_amount = 0;\n\t\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tvar total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\n\t\t\tvar discount_amount = flt(total*flt(frm.doc.additional_discount_percentage) / 100,\n\t\t\t\tprecision(\"discount_amount\"));\n\n\t\t\tfrm.set_value(\"discount_amount\", discount_amount)\n\t\t\t\t.then(() => delete frm.via_discount_percentage);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"discount_amount\", function(frm) {\n\t\t\tfrm.cscript.set_dynamic_labels();\n\n\t\t\tif (!frm.via_discount_percentage) {\n\t\t\t\tfrm.doc.additional_discount_percentage = 0;\n\t\t\t}\n\n\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", {\n\t\t\titems_add: function(frm, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif (!item.warehouse && frm.doc.set_warehouse) {\n\t\t\t\t\titem.warehouse = frm.doc.set_warehouse;\n\t\t\t\t}\n\n\t\t\t\tif (!item.target_warehouse && frm.doc.set_target_warehouse) {\n\t\t\t\t\titem.target_warehouse = frm.doc.set_target_warehouse;\n\t\t\t\t}\n\n\t\t\t\tif (!item.from_warehouse && frm.doc.set_from_warehouse) {\n\t\t\t\t\titem.from_warehouse = frm.doc.set_from_warehouse;\n\t\t\t\t}\n\n\t\t\t\terpnext.accounts.dimensions.copy_dimension_from_first_row(frm, cdt, cdn, 'items');\n\t\t\t}\n\t\t});\n\n\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('batch_no')) {\n\t\t\tthis.frm.set_query(\"batch_no\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\n\t\t\t});\n\t\t}\n\n\t\tif(\n\t\t\tthis.frm.docstatus < 2\n\t\t\t&& this.frm.fields_dict[\"payment_terms_template\"]\n\t\t\t&& this.frm.fields_dict[\"payment_schedule\"]\n\t\t\t&& this.frm.doc.payment_terms_template\n\t\t\t&& !this.frm.doc.payment_schedule.length\n\t\t){\n\t\t\tthis.frm.trigger(\"payment_terms_template\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis[\"taxes_remove\"] = this.calculate_taxes_and_totals;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"items\"]) {\n\t\t\tthis[\"items_remove\"] = this.calculate_net_weight;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"recurring_print_format\"]) {\n\t\t\tthis.frm.set_query(\"recurring_print_format\", function(doc) {\n\t\t\t\treturn{\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['Print Format', 'doc_type', '=', cur_frm.doctype],\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"return_against\"]) {\n\t\t\tthis.frm.set_query(\"return_against\", function(doc) {\n\t\t\t\tvar filters = {\n\t\t\t\t\t\"docstatus\": 1,\n\t\t\t\t\t\"is_return\": 0,\n\t\t\t\t\t\"company\": doc.company\n\t\t\t\t};\n\t\t\t\tif (me.frm.fields_dict[\"customer\"] && doc.customer) filters[\"customer\"] = doc.customer;\n\t\t\t\tif (me.frm.fields_dict[\"supplier\"] && doc.supplier) filters[\"supplier\"] = doc.supplier;\n\n\t\t\t\treturn {\n\t\t\t\t\tfilters: filters\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"expense_account\")) {\n\t\t\tthis.frm.set_query(\"expense_account\", \"items\", function(doc) {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"pricing_rules\")) {\n\t\t\tthis.frm.set_indicator_formatter('pricing_rule', function(doc) {\n\t\t\t\treturn (doc.rule_applied) ? \"green\" : \"red\";\n\t\t\t});\n\t\t}\n\n\t\tlet batch_no_field = this.frm.get_docfield(\"items\", \"batch_no\");\n\t\tif (batch_no_field) {\n\t\t\tbatch_no_field.get_route_options_for_new_doc = function(row) {\n\t\t\t\treturn {\n\t\t\t\t\t\"item\": row.doc.item_code\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field('blanket_order')) {\n\t\t\tthis.frm.set_query(\"blanket_order\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\tvar item = locals[cdt][cdn];\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.get_blanket_orders\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\"blanket_order_type\": doc.doctype === \"Sales Order\" ? \"Selling\" : \"Purchasing\",\n\t\t\t\t\t\t\"item\": item.item_code\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict.taxes_and_charges) {\n\t\t\tthis.frm.set_query(\"taxes_and_charges\", function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['company', '=', me.frm.doc.company],\n\t\t\t\t\t\t['docstatus', '!=', 2]\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t}\n\tonload() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tvar currency = frappe.defaults.get_user_default(\"currency\");\n\n\t\t\tlet set_value = (fieldname, value) => {\n\t\t\t\tif(me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\n\t\t\t\t\treturn me.frm.set_value(fieldname, value);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.frm.trigger('set_default_internal_warehouse');\n\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => set_value('currency', currency),\n\t\t\t\t() => set_value('price_list_currency', currency),\n\t\t\t\t() => set_value('status', 'Draft'),\n\t\t\t\t() => set_value('is_subcontracted', 0),\n\t\t\t\t() => {\n\t\t\t\t\tif(this.frm.doc.company && !this.frm.doc.amended_from) {\n\t\t\t\t\t\tthis.frm.trigger(\"company\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\t}\n\n\tis_return() {\n\t\tif(!this.frm.doc.is_return && this.frm.doc.return_against) {\n\t\t\tthis.frm.set_value('return_against', '');\n\t\t}\n\t}\n\n\tsetup_quality_inspection() {\n\t\tif(!in_list([\"Delivery Note\", \"Sales Invoice\", \"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst me = this;\n\t\tif (!this.frm.is_new() && this.frm.doc.docstatus === 0) {\n\t\t\tthis.frm.add_custom_button(__(\"Quality Inspection(s)\"), () => {\n\t\t\t\tme.make_quality_inspection();\n\t\t\t}, __(\"Create\"));\n\t\t\tthis.frm.page.set_inner_btn_group_as_primary(__('Create'));\n\t\t}\n\n\t\tconst inspection_type = in_list([\"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t? \"Incoming\" : \"Outgoing\";\n\n\t\tlet quality_inspection_field = this.frm.get_docfield(\"items\", \"quality_inspection\");\n\t\tquality_inspection_field.get_route_options_for_new_doc = function(row) {\n\t\t\tif(me.frm.is_new()) return;\n\t\t\treturn {\n\t\t\t\t\"inspection_type\": inspection_type,\n\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\"reference_name\": me.frm.doc.name,\n\t\t\t\t\"item_code\": row.doc.item_code,\n\t\t\t\t\"description\": row.doc.description,\n\t\t\t\t\"item_serial_no\": row.doc.serial_no ? row.doc.serial_no.split(\"\\n\")[0] : null,\n\t\t\t\t\"batch_no\": row.doc.batch_no\n\t\t\t}\n\t\t}\n\n\t\tthis.frm.set_query(\"quality_inspection\", \"items\", function(doc, cdt, cdn) {\n\t\t\tlet d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\tinspection_type: inspection_type,\n\t\t\t\t\treference_name: doc.name,\n\t\t\t\t\titem_code: d.item_code\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_payment_request() {\n\t\tlet me = this;\n\t\tconst payment_request_type = (in_list(['Sales Order', 'Sales Invoice'], this.frm.doc.doctype))\n\t\t\t? \"Inward\" : \"Outward\";\n\n\t\tfrappe.call({\n\t\t\tmethod:\"erpnext.accounts.doctype.payment_request.payment_request.make_payment_request\",\n\t\t\targs: {\n\t\t\t\tdt: me.frm.doc.doctype,\n\t\t\t\tdn: me.frm.doc.name,\n\t\t\t\trecipient_id: me.frm.doc.contact_email,\n\t\t\t\tpayment_request_type: payment_request_type,\n\t\t\t\tparty_type: payment_request_type == 'Outward' ? \"Supplier\" : \"Customer\",\n\t\t\t\tparty: payment_request_type == 'Outward' ? me.frm.doc.supplier : me.frm.doc.customer\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc){\n\t\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", r.message.doctype, r.message.name);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tonload_post_render() {\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\n\t\t\t&& !(this.frm.doc.__onload ? this.frm.doc.__onload.load_after_mapping : false)) {\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\n\t\t\t&& !this.frm.doc.is_pos) {\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\n\t\t}\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"item_code\")) {\n\t\t\tthis.setup_item_selector();\n\t\t\tthis.frm.get_field(\"items\").grid.set_multiple_add(\"item_code\", \"qty\");\n\t\t}\n\t}\n\n\trefresh() {\n\t\terpnext.toggle_naming_series();\n\t\terpnext.hide_company();\n\t\tthis.set_dynamic_labels();\n\t\tthis.setup_sms();\n\t\tthis.setup_quality_inspection();\n\t\tthis.validate_has_items();\n\t}\n\n\tscan_barcode() {\n\t\tconst barcode_scanner = new erpnext.utils.BarcodeScanner({frm:this.frm});\n\t\tbarcode_scanner.process_scan();\n\t}\n\n\tvalidate_has_items () {\n\t\tlet table = this.frm.doc.items;\n\t\tthis.frm.has_items = (table && table.length\n\t\t\t&& table[0].qty && table[0].item_code);\n\t}\n\n\tapply_default_taxes() {\n\t\tvar me = this;\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\tme.frm.doc.name);\n\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (taxes_and_charges_field) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges || \"\",\n\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t},\n\t\t\t\tdebounce: 2000,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// set taxes table\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => me.set_dynamic_labels(),\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_sms() {\n\t\tvar me = this;\n\t\tlet blacklist = ['Purchase Invoice', 'BOM'];\n\t\tif(this.frm.doc.docstatus===1 && !in_list([\"Lost\", \"Stopped\", \"Closed\"], this.frm.doc.status)\n\t\t\t&& !blacklist.includes(this.frm.doctype)) {\n\t\t\tthis.frm.page.add_menu_item(__('Send SMS'), function() { me.send_sms(); });\n\t\t}\n\t}\n\n\tsend_sms() {\n\t\tvar sms_man = new erpnext.SMSManager(this.frm.doc);\n\t}\n\n\titem_code(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tvar update_stock = 0, show_batch_dialog = 0;\n\n\t\titem.weight_per_unit = 0;\n\t\titem.weight_uom = '';\n\t\titem.conversion_factor = 0;\n\n\t\tif(['Sales Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tupdate_stock = cint(me.frm.doc.update_stock);\n\t\t\tshow_batch_dialog = update_stock;\n\n\t\t} else if((this.frm.doc.doctype === 'Purchase Receipt' && me.frm.doc.is_return) ||\n\t\t\tthis.frm.doc.doctype === 'Delivery Note') {\n\t\t\tshow_batch_dialog = 1;\n\t\t}\n\t\titem.barcode = null;\n\n\n\t\tif(item.item_code || item.serial_no) {\n\t\t\tif(!this.validate_company_and_party()) {\n\t\t\t\tthis.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\n\t\t\t} else {\n\t\t\t\titem.pricing_rules = ''\n\t\t\t\treturn this.frm.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\n\t\t\t\t\tchild: item,\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\tbarcode: item.barcode,\n\t\t\t\t\t\t\tserial_no: item.serial_no,\n\t\t\t\t\t\t\tbatch_no: item.batch_no,\n\t\t\t\t\t\t\tset_warehouse: me.frm.doc.set_warehouse,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcustomer: me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\t\t\t\tquotation_to: me.frm.doc.quotation_to,\n\t\t\t\t\t\t\tsupplier: me.frm.doc.supplier,\n\t\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\t\tupdate_stock: update_stock,\n\t\t\t\t\t\t\tconversion_rate: me.frm.doc.conversion_rate,\n\t\t\t\t\t\t\tprice_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\t\t\t\tprice_list_currency: me.frm.doc.price_list_currency,\n\t\t\t\t\t\t\tplc_conversion_rate: me.frm.doc.plc_conversion_rate,\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\torder_type: me.frm.doc.order_type,\n\t\t\t\t\t\t\tis_pos: cint(me.frm.doc.is_pos),\n\t\t\t\t\t\t\tis_return: cint(me.frm.doc.is_return),\n\t\t\t\t\t\t\tis_subcontracted: me.frm.doc.is_subcontracted,\n\t\t\t\t\t\t\tignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tproject: item.project || me.frm.doc.project,\n\t\t\t\t\t\t\tqty: item.qty || 1,\n\t\t\t\t\t\t\tnet_rate: item.rate,\n\t\t\t\t\t\t\tstock_qty: item.stock_qty,\n\t\t\t\t\t\t\tconversion_factor: item.conversion_factor,\n\t\t\t\t\t\t\tweight_per_unit: item.weight_per_unit,\n\t\t\t\t\t\t\tuom: item.uom,\n\t\t\t\t\t\t\tweight_uom: item.weight_uom,\n\t\t\t\t\t\t\tmanufacturer: item.manufacturer,\n\t\t\t\t\t\t\tstock_uom: item.stock_uom,\n\t\t\t\t\t\t\tpos_profile: cint(me.frm.doc.is_pos) ? me.frm.doc.pos_profile : '',\n\t\t\t\t\t\t\tcost_center: item.cost_center,\n\t\t\t\t\t\t\ttax_category: me.frm.doc.tax_category,\n\t\t\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\t\t\tchild_docname: item.name,\n\t\t\t\t\t\t\tis_old_subcontracting_flow: me.frm.doc.is_old_subcontracting_flow,\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(d.item_tax_rate);\n\t\t\t\t\t\t\t\t\tif (d.free_item_data) {\n\t\t\t\t\t\t\t\t\t\tme.apply_product_discount(d);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t// for internal customer instead of pricing rule directly apply valuation rate on item\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\n\t\t\t\t\t\t\t\t\t\tme.get_incoming_rate(item, me.frm.posting_date, me.frm.posting_time,\n\t\t\t\t\t\t\t\t\t\t\tme.frm.doc.doctype, me.frm.doc.company);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\n\t\t\t\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.toggle_conversion_factor(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog)\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\n\t\t\t\t\t\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (r.message &&\n\t\t\t\t\t\t\t\t\t\t\t\t(r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t// check if batch serial selector is disabled or not\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog && !frappe.flags.hide_serial_batch_dialog)\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_single_value('Stock Settings', 'disable_serial_no_and_batch_selector')\n\t\t\t\t\t\t\t\t\t\t\t.then((value) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog) {\n\t\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\t\t\t\t\t\tif(!d[k]) d[k] = v;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tif (d.has_batch_no && d.has_serial_no) {\n\t\t\t\t\t\t\t\t\t\t\td.batch_no = undefined;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\terpnext.show_serial_batch_selector(me.frm, d, (item) => {\n\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('qty', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t\tif (!me.frm.doc.set_warehouse)\n\t\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('warehouse', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t\tme.apply_price_list(item, true);\n\t\t\t\t\t\t\t\t\t\t}, undefined, !frappe.flags.hide_serial_batch_dialog);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.conversion_factor(doc, cdt, cdn, true),\n\t\t\t\t\t\t\t\t() => me.remove_pricing_rule(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (item.apply_rule_on_other_items) {\n\t\t\t\t\t\t\t\t\t\tlet key = item.name;\n\t\t\t\t\t\t\t\t\t\tme.apply_rule_on_other_items({key: item});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\t\t\t\t\t\tme.update_item_grid_labels(company_currency);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprice_list_rate(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tfrappe.model.round_floats_in(item, [\"price_list_rate\", \"discount_percentage\"]);\n\n\t\t// check if child doctype is Sales Order Item/Quotation Item and calculate the rate\n\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\", \"POS Invoice Item\", \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), cdt)\n\t\t\tthis.apply_pricing_rule_on_item(item);\n\t\telse\n\t\t\titem.rate = flt(item.price_list_rate * (1 - item.discount_percentage / 100.0),\n\t\t\t\tprecision(\"rate\", item));\n\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tmargin_rate_or_amount(doc, cdt, cdn) {\n\t\t// calculated the revised total margin and rate on margin rate changes\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tthis.apply_pricing_rule_on_item(item);\n\t\tthis.calculate_taxes_and_totals();\n\t\tcur_frm.refresh_fields();\n\t}\n\n\tmargin_type(doc, cdt, cdn) {\n\t\t// calculate the revised total margin and rate on margin type changes\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tif (!item.margin_type) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"margin_rate_or_amount\", 0);\n\t\t} else {\n\t\t\tthis.apply_pricing_rule_on_item(item, doc, cdt, cdn);\n\t\t\tthis.calculate_taxes_and_totals();\n\t\t\tcur_frm.refresh_fields();\n\t\t}\n\t}\n\n\tget_incoming_rate(item, posting_date, posting_time, voucher_type, company) {\n\n\t\tlet item_args = {\n\t\t\t'item_code': item.item_code,\n\t\t\t'warehouse': in_list('Purchase Receipt', 'Purchase Invoice') ? item.from_warehouse : item.warehouse,\n\t\t\t'posting_date': posting_date,\n\t\t\t'posting_time': posting_time,\n\t\t\t'qty': item.qty * item.conversion_factor,\n\t\t\t'serial_no': item.serial_no,\n\t\t\t'batch_no': item.batch_no,\n\t\t\t'voucher_type': voucher_type,\n\t\t\t'company': company,\n\t\t\t'allow_zero_valuation_rate': item.allow_zero_valuation_rate\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod: 'erpnext.stock.utils.get_incoming_rate',\n\t\t\targs: {\n\t\t\t\targs: item_args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.model.set_value(item.doctype, item.name, 'rate', r.message * item.conversion_factor);\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_taxes_from_item_tax_template(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif(item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif(typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif(!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tserial_no(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif (item && item.doctype === 'Purchase Receipt Item Supplied') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (item && item.serial_no) {\n\t\t\tif (!item.item_code) {\n\t\t\t\tthis.frm.trigger(\"item_code\", cdt, cdn);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Replace all occurences of comma with line feed\n\t\t\t\titem.serial_no = item.serial_no.replace(/,/g, '\\n');\n\t\t\t\titem.conversion_factor = item.conversion_factor || 1;\n\t\t\t\trefresh_field(\"serial_no\", item.name, item.parentfield);\n\t\t\t\tif (!doc.is_return && cint(frappe.user_defaults.set_qty_in_transactions_based_on_serial_no_input)) {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tme.update_qty(cdt, cdn);\n\t\t\t\t\t}, 10000);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tupdate_qty(cdt, cdn) {\n\t\tvar valid_serial_nos = [];\n\t\tvar serialnos = [];\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tserialnos = item.serial_no.split(\"\\n\");\n\t\tfor (var i = 0; i < serialnos.length; i++) {\n\t\t\tif (serialnos[i] != \"\") {\n\t\t\t\tvalid_serial_nos.push(serialnos[i]);\n\t\t\t}\n\t\t}\n\t\tfrappe.model.set_value(item.doctype, item.name,\n\t\t\t\"qty\", valid_serial_nos.length / item.conversion_factor);\n\t\tfrappe.model.set_value(item.doctype, item.name, \"stock_qty\", valid_serial_nos.length);\n\t}\n\n\tvalidate() {\n\t\tthis.calculate_taxes_and_totals(false);\n\t}\n\n\tupdate_stock() {\n\t\tthis.frm.trigger('set_default_internal_warehouse');\n\t}\n\n\tset_default_internal_warehouse() {\n\t\tlet me = this;\n\t\tif ((this.frm.doc.doctype === 'Sales Invoice' && me.frm.doc.update_stock)\n\t\t\t|| this.frm.doc.doctype == 'Delivery Note') {\n\t\t\tif (this.frm.doc.is_internal_customer && this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\n\t\t\t\t\tme.frm.set_value('set_target_warehouse', value.default_in_transit_warehouse);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif ((this.frm.doc.doctype === 'Purchase Invoice' && me.frm.doc.update_stock)\n\t\t\t|| this.frm.doc.doctype == 'Purchase Receipt') {\n\t\t\tif (this.frm.doc.is_internal_supplier && this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\n\t\t\t\t\tme.frm.set_value('set_from_warehouse', value.default_in_transit_warehouse);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tcompany() {\n\t\tvar me = this;\n\t\tvar set_pricing = function() {\n\t\t\tif(me.frm.doc.company && me.frm.fields_dict.currency) {\n\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\n\n\t\t\t\tif (!me.frm.doc.currency) {\n\t\t\t\t\tme.frm.set_value(\"currency\", company_currency);\n\t\t\t\t}\n\n\t\t\t\tif (me.frm.doc.currency == company_currency) {\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t\t}\n\t\t\t\tif (me.frm.doc.price_list_currency == company_currency) {\n\t\t\t\t\tme.frm.set_value('plc_conversion_rate', 1.0);\n\t\t\t\t}\n\t\t\t\tif (company_doc.default_letter_head) {\n\t\t\t\t\tif(me.frm.fields_dict.letter_head) {\n\t\t\t\t\t\tme.frm.set_value(\"letter_head\", company_doc.default_letter_head);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet selling_doctypes_for_tc = [\"Sales Invoice\", \"Quotation\", \"Sales Order\", \"Delivery Note\"];\n\t\t\t\tif (company_doc.default_selling_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tselling_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_selling_terms);\n\t\t\t\t}\n\t\t\t\tlet buying_doctypes_for_tc = [\"Request for Quotation\", \"Supplier Quotation\", \"Purchase Order\",\n\t\t\t\t\t\"Material Request\", \"Purchase Receipt\"];\n\t\t\t\t// Purchase Invoice is excluded as per issue #3345\n\t\t\t\tif (company_doc.default_buying_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tbuying_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_buying_terms);\n\t\t\t\t}\n\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => me.frm.script_manager.trigger(\"currency\"),\n\t\t\t\t\t() => me.update_item_tax_map(),\n\t\t\t\t\t() => me.apply_default_taxes(),\n\t\t\t\t\t() => me.apply_pricing_rule()\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\tvar set_party_account = function(set_pricing) {\n\t\t\tif (in_list([\"Sales Invoice\", \"Purchase Invoice\"], me.frm.doc.doctype)) {\n\t\t\t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\n\t\t\t\t\tvar party_type = \"Customer\";\n\t\t\t\t\tvar party_account_field = 'debit_to';\n\t\t\t\t} else {\n\t\t\t\t\tvar party_type = \"Supplier\";\n\t\t\t\t\tvar party_account_field = 'credit_to';\n\t\t\t\t}\n\n\t\t\t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\n\t\t\t\tif(party && me.frm.doc.company) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\tparty_type: party_type,\n\t\t\t\t\t\t\tparty: party\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\n\t\t\t\t\t\t\t\tset_pricing();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tset_pricing();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tset_pricing();\n\t\t\t}\n\n\t\t}\n\n\t\tif (frappe.meta.get_docfield(this.frm.doctype, \"shipping_address\") &&\n\t\t\tin_list(['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'], this.frm.doctype)) {\n\t\t\terpnext.utils.get_shipping_address(this.frm, function() {\n\t\t\t\tset_party_account(set_pricing);\n\t\t\t});\n\n\t\t} else {\n\t\t\tset_party_account(set_pricing);\n\t\t}\n\n\t\tif(this.frm.doc.company) {\n\t\t\terpnext.last_selected_company = this.frm.doc.company;\n\t\t}\n\t}\n\n\ttransaction_date() {\n\t\tif (this.frm.doc.transaction_date) {\n\t\t\tthis.frm.transaction_date = this.frm.doc.transaction_date;\n\t\t\tfrappe.ui.form.trigger(this.frm.doc.doctype, \"currency\");\n\t\t}\n\t}\n\n\tposting_date() {\n\t\tvar me = this;\n\t\tif (this.frm.doc.posting_date) {\n\t\t\tthis.frm.posting_date = this.frm.doc.posting_date;\n\n\t\t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\n\t\t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: \"erpnext.accounts.party.get_due_date\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\n\t\t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\n\t\t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\n\t\t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\n\t\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\tme.frm.doc.due_date = r.message;\n\t\t\t\t\t\t\trefresh_field(\"due_date\");\n\t\t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t\t\t\t\tme.recalculate_terms();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t}\n\t\t}\n\t}\n\n\tdue_date() {\n\t\t// due_date is to be changed, payment terms template and/or payment schedule must\n\t\t// be removed as due_date is automatically changed based on payment terms\n\t\tif (this.frm.doc.due_date && !this.frm.updating_party_details && !this.frm.doc.is_pos) {\n\t\t\tif (this.frm.doc.payment_terms_template ||\n\t\t\t\t(this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length)) {\n\t\t\t\tvar message1 = \"\";\n\t\t\t\tvar message2 = \"\";\n\t\t\t\tvar final_message = __(\"Please clear the\") + \" \";\n\n\t\t\t\tif (this.frm.doc.payment_terms_template) {\n\t\t\t\t\tmessage1 = __(\"selected Payment Terms Template\");\n\t\t\t\t\tfinal_message = final_message + message1;\n\t\t\t\t}\n\n\t\t\t\tif ((this.frm.doc.payment_schedule || []).length) {\n\t\t\t\t\tmessage2 = __(\"Payment Schedule Table\");\n\t\t\t\t\tif (message1.length !== 0) message2 = \" and \" + message2;\n\t\t\t\t\tfinal_message = final_message + message2;\n\t\t\t\t}\n\t\t\t\tfrappe.msgprint(final_message);\n\t\t\t}\n\t\t}\n\t}\n\n\tbill_date() {\n\t\tthis.posting_date();\n\t}\n\n\trecalculate_terms() {\n\t\tconst doc = this.frm.doc;\n\t\tif (doc.payment_terms_template) {\n\t\t\tthis.payment_terms_template();\n\t\t} else if (doc.payment_schedule) {\n\t\t\tconst me = this;\n\t\t\tdoc.payment_schedule.forEach(\n\t\t\t\tfunction(term) {\n\t\t\t\t\tif (term.payment_term) {\n\t\t\t\t\t\tme.payment_term(doc, term.doctype, term.name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tterm.doctype, term.name, 'due_date',\n\t\t\t\t\t\t\tdoc.posting_date || doc.transaction_date\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tget_company_currency() {\n\t\treturn erpnext.get_currency(this.frm.doc.company);\n\t}\n\n\tcontact_person() {\n\t\terpnext.utils.get_contact_details(this.frm);\n\t}\n\n\tcurrency() {\n\t\t// The transaction date be either transaction_date (from orders) or posting_date (from invoices)\n\t\tlet transaction_date = this.frm.doc.transaction_date || this.frm.doc.posting_date;\n\n\t\tlet me = this;\n\t\tthis.set_dynamic_labels();\n\t\tlet company_currency = this.get_company_currency();\n\t\t// Added `ignore_price_list` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.currency && this.frm.doc.currency !== company_currency\n\t\t\t\t&& !(this.frm.doc.__onload && this.frm.doc.__onload.ignore_price_list)) {\n\n\t\t\tthis.get_exchange_rate(transaction_date, this.frm.doc.currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tif(exchange_rate != me.frm.doc.conversion_rate) {\n\t\t\t\t\t\tme.set_margin_amount_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.set_actual_charges_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.frm.set_value(\"conversion_rate\", exchange_rate);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t} else {\n\t\t\t// company currency and doc currency is same\n\t\t\t// this will prevent unnecessary conversion rate triggers\n\t\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t} else {\n\t\t\t\tthis.conversion_rate();\n\t\t\t}\n\t\t}\n\t}\n\n\tconversion_rate() {\n\t\tconst me = this.frm;\n\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t}\n\t\tif(this.frm.doc.currency === this.frm.doc.price_list_currency &&\n\t\t\tthis.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", this.frm.doc.conversion_rate);\n\t\t}\n\n\t\tif(flt(this.frm.doc.conversion_rate)>0.0) {\n\t\t\tif(this.frm.doc.__onload && this.frm.doc.__onload.ignore_price_list) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t} else if (!this.in_apply_price_list){\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t}\n\t\t// Make read only if Accounts Settings doesn't allow stale rates\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"read_only\", erpnext.stale_rate_allowed() ? 0 : 1);\n\t}\n\n\tshipping_rule() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.shipping_rule) {\n\t\t\treturn this.frm.call({\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tmethod: \"apply_shipping_rule\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme._calculate_taxes_and_totals();\n\t\t\t\t}\n\t\t\t}).fail(() => this.frm.set_value('shipping_rule', ''));\n\t\t}\n\t}\n\n\tset_margin_amount_based_on_currency(exchange_rate) {\n\t\tif (in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"Purchase Invoice\", \"Purchase Order\", \"Purchase Receipt\"]), this.frm.doc.doctype) {\n\t\t\tvar me = this;\n\t\t\t$.each(this.frm.doc.items || [], function(i, d) {\n\t\t\t\tif(d.margin_type == \"Amount\") {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"margin_rate_or_amount\",\n\t\t\t\t\t\tflt(d.margin_rate_or_amount) / flt(exchange_rate));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tset_actual_charges_based_on_currency(exchange_rate) {\n\t\tvar me = this;\n\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\tif(d.charge_type == \"Actual\") {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"tax_amount\",\n\t\t\t\t\tflt(d.base_tax_amount) / flt(exchange_rate));\n\t\t\t}\n\t\t});\n\t}\n\n\tget_exchange_rate(transaction_date, from_currency, to_currency, callback) {\n\t\tvar args;\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_selling\";\n\t\t}\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_buying\";\n\t\t}\n\n\t\tif (!transaction_date || !from_currency || !to_currency) return;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\targs: {\n\t\t\t\ttransaction_date: transaction_date,\n\t\t\t\tfrom_currency: from_currency,\n\t\t\t\tto_currency: to_currency,\n\t\t\t\targs: args\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tfreeze_message: __(\"Fetching exchange rates ...\"),\n\t\t\tcallback: function(r) {\n\t\t\t\tcallback(flt(r.message));\n\t\t\t}\n\t\t});\n\t}\n\n\tprice_list_currency() {\n\t\tvar me=this;\n\t\tthis.set_dynamic_labels();\n\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_price_list` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.price_list_currency !== company_currency  &&\n\t\t\t\t!(this.frm.doc.__onload && this.frm.doc.__onload.ignore_price_list)) {\n\t\t\tthis.get_exchange_rate(this.frm.doc.posting_date, this.frm.doc.price_list_currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.plc_conversion_rate();\n\t\t}\n\t}\n\n\tplc_conversion_rate() {\n\t\tif(this.frm.doc.price_list_currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", 1.0);\n\t\t} else if(this.frm.doc.price_list_currency === this.frm.doc.currency\n\t\t\t&& this.frm.doc.plc_conversion_rate && cint(this.frm.doc.plc_conversion_rate) != 1 &&\n\t\t\tcint(this.frm.doc.plc_conversion_rate) != cint(this.frm.doc.conversion_rate)) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", this.frm.doc.plc_conversion_rate);\n\t\t}\n\n\t\tif(!this.in_apply_price_list) {\n\t\t\tthis.apply_price_list(null, true);\n\t\t}\n\t}\n\n\tuom(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\titem.pricing_rules = ''\n\t\tif(item.item_code && item.uom) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\tuom: item.uom\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'conversion_factor', r.message.conversion_factor);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.calculate_stock_uom_rate(doc, cdt, cdn);\n\t}\n\n\tconversion_factor(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\tif(frappe.meta.get_docfield(cdt, \"stock_qty\", cdn)) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"conversion_factor\"]);\n\t\t\titem.stock_qty = flt(item.qty * item.conversion_factor, precision(\"stock_qty\", item));\n\t\t\trefresh_field(\"stock_qty\", item.name, item.parentfield);\n\t\t\tthis.toggle_conversion_factor(item);\n\n\t\t\tif(doc.doctype != \"Material Request\") {\n\t\t\t\titem.total_weight = flt(item.stock_qty * item.weight_per_unit);\n\t\t\t\trefresh_field(\"total_weight\", item.name, item.parentfield);\n\t\t\t\tthis.calculate_net_weight();\n\t\t\t}\n\n\t\t\t// for handling customization not to fetch price list rate\n\t\t\tif(frappe.flags.dont_fetch_price_list_rate) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (!dont_fetch_price_list_rate &&\n\t\t\t\tfrappe.meta.has_field(doc.doctype, \"price_list_currency\")) {\n\t\t\t\tthis.apply_price_list(item, true);\n\t\t\t}\n\t\t\tthis.calculate_stock_uom_rate(doc, cdt, cdn);\n\t\t}\n\t}\n\n\tis_a_mapped_document(item) {\n\t\tconst mapped_item_field_map = {\n\t\t\t\"Delivery Note Item\": [\"si_detail\", \"so_detail\", \"dn_detail\"],\n\t\t\t\"Sales Invoice Item\": [\"dn_detail\", \"so_detail\", \"sales_invoice_item\"],\n\t\t\t\"Purchase Receipt Item\": [\"purchase_order_item\", \"purchase_invoice_item\", \"purchase_receipt_item\"],\n\t\t\t\"Purchase Invoice Item\": [\"purchase_order_item\", \"pr_detail\", \"po_detail\"],\n\t\t};\n\t\tconst mappped_fields = mapped_item_field_map[item.doctype] || [];\n\n\t\treturn mappped_fields\n\t\t\t.map((field) => item[field])\n\t\t\t.filter(Boolean).length > 0;\n\t}\n\n\tbatch_no(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tif (!this.is_a_mapped_document(item)) {\n\t\t\tthis.apply_price_list(item, true);\n\t\t}\n\t}\n\n\ttoggle_conversion_factor(item) {\n\t\t// toggle read only property for conversion factor field if the uom and stock uom are same\n\t\tif(this.frm.get_field('items').grid.fields_map.conversion_factor) {\n\t\t\tthis.frm.fields_dict.items.grid.toggle_enable(\"conversion_factor\",\n\t\t\t\t((item.uom != item.stock_uom) && !frappe.meta.get_docfield(cur_frm.fields_dict.items.grid.doctype, \"conversion_factor\").read_only)? true: false);\n\t\t}\n\n\t}\n\n\tqty(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\t// item.pricing_rules = ''\n\t\tfrappe.run_serially([\n\t\t\t() => this.remove_pricing_rule(item),\n\t\t\t() => this.conversion_factor(doc, cdt, cdn, true),\n\t\t\t() => this.calculate_stock_uom_rate(doc, cdt, cdn),\n\t\t\t() => this.apply_pricing_rule(item, true)\n\t\t]);\n\t}\n\n\tcalculate_stock_uom_rate(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\titem.stock_uom_rate = flt(item.rate)/flt(item.conversion_factor);\n\t\trefresh_field(\"stock_uom_rate\", item.name, item.parentfield);\n\t}\n\tservice_stop_date(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_stop_date) {\n\t\t\tlet start_date = Date.parse(child.service_start_date);\n\t\t\tlet end_date = Date.parse(child.service_end_date);\n\t\t\tlet stop_date = Date.parse(child.service_stop_date);\n\n\t\t\tif(stop_date < start_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be before Service Start Date\"));\n\t\t\t} else if (stop_date > end_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be after Service End Date\"));\n\t\t\t}\n\t\t}\n\t}\n\n\tservice_start_date(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_start_date) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"erpnext.stock.get_item_details.calculate_service_end_date\",\n\t\t\t\targs: {\"args\": child},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_end_date\", r.message.service_end_date);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tcalculate_net_weight(){\n\t\t/* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\n\t\tvar me = this;\n\t\tthis.frm.doc.total_net_weight= 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total_net_weight += flt(item.total_weight);\n\t\t});\n\t\trefresh_field(\"total_net_weight\");\n\t\tthis.shipping_rule();\n\t}\n\n\tset_dynamic_labels() {\n\t\t// What TODO? should we make price list system non-mandatory?\n\t\tthis.frm.toggle_reqd(\"plc_conversion_rate\",\n\t\t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\n\n\t\tvar company_currency = this.get_company_currency();\n\t\tthis.change_form_labels(company_currency);\n\t\tthis.change_grid_labels(company_currency);\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tchange_form_labels(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_total\", \"base_net_total\", \"base_total_taxes_and_charges\",\n\t\t\t\"base_discount_amount\", \"base_grand_total\", \"base_rounded_total\", \"base_in_words\",\n\t\t\t\"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\", \"total_amount_to_pay\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_change_amount\", \"base_operating_cost\",\n\t\t\t\"base_raw_material_cost\", \"base_total_cost\", \"base_scrap_material_cost\",\n\t\t\t\"base_rounding_adjustment\"], company_currency);\n\n\t\tthis.frm.set_currency_labels([\"total\", \"net_total\", \"total_taxes_and_charges\", \"discount_amount\",\n\t\t\t\"grand_total\", \"taxes_and_charges_added\", \"taxes_and_charges_deducted\",\"tax_withholding_net_total\",\n\t\t\t\"rounded_total\", \"in_words\", \"paid_amount\", \"write_off_amount\", \"operating_cost\",\n\t\t\t\"scrap_material_cost\", \"rounding_adjustment\", \"raw_material_cost\",\n\t\t\t\"total_cost\"], this.frm.doc.currency);\n\n\t\tthis.frm.set_currency_labels([\"outstanding_amount\", \"total_advance\"],\n\t\t\tthis.frm.doc.party_account_currency);\n\n\t\tcur_frm.set_df_property(\"conversion_rate\", \"description\", \"1 \" + this.frm.doc.currency\n\t\t\t+ \" = [?] \" + company_currency);\n\n\t\tif(this.frm.doc.price_list_currency && this.frm.doc.price_list_currency!=company_currency) {\n\t\t\tcur_frm.set_df_property(\"plc_conversion_rate\", \"description\", \"1 \"\n\t\t\t\t+ this.frm.doc.price_list_currency + \" = [?] \" + company_currency);\n\t\t}\n\n\t\t// toggle fields\n\t\tthis.frm.toggle_display([\"conversion_rate\", \"base_total\", \"base_net_total\", \"base_tax_withholding_net_total\",\n\t\t\t\"base_total_taxes_and_charges\", \"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\",\n\t\t\t\"base_grand_total\", \"base_rounded_total\", \"base_in_words\", \"base_discount_amount\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_operating_cost\", \"base_raw_material_cost\",\n\t\t\t\"base_total_cost\", \"base_scrap_material_cost\", \"base_rounding_adjustment\"],\n\t\tthis.frm.doc.currency != company_currency);\n\n\t\tthis.frm.toggle_display([\"plc_conversion_rate\", \"price_list_currency\"],\n\t\t\tthis.frm.doc.price_list_currency != company_currency);\n\n\t\tvar show = cint(cur_frm.doc.discount_amount) ||\n\t\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"net_total\"))\n\t\t\tcur_frm.toggle_display(\"net_total\", show);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"base_net_total\"))\n\t\t\tcur_frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\n\n\t}\n\n\tchange_grid_labels(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.update_item_grid_labels(company_currency);\n\n\t\tthis.toggle_item_grid_columns(company_currency);\n\n\t\tif (this.frm.doc.operations && this.frm.doc.operations.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"operating_cost\", \"hour_rate\"], this.frm.doc.currency, \"operations\");\n\t\t\tthis.frm.set_currency_labels([\"base_operating_cost\", \"base_hour_rate\"], company_currency, \"operations\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"operations\"].grid;\n\t\t\t$.each([\"base_operating_cost\", \"base_hour_rate\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.doc.scrap_items && this.frm.doc.scrap_items.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"rate\", \"amount\"], this.frm.doc.currency, \"scrap_items\");\n\t\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_amount\"], company_currency, \"scrap_items\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"scrap_items\"].grid;\n\t\t\t$.each([\"base_rate\", \"base_amount\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"tax_amount\", \"total\", \"tax_amount_after_discount\"], this.frm.doc.currency, \"taxes\");\n\n\t\t\tthis.frm.set_currency_labels([\"base_tax_amount\", \"base_total\", \"base_tax_amount_after_discount\"], company_currency, \"taxes\");\n\t\t}\n\n\t\tif (this.frm.doc.advances && this.frm.doc.advances.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"advance_amount\", \"allocated_amount\"],\n\t\t\t\tthis.frm.doc.party_account_currency, \"advances\");\n\t\t}\n\n\t\tthis.update_payment_schedule_grid_labels(company_currency);\n\t}\n\n\tupdate_item_grid_labels(company_currency) {\n\t\tthis.frm.set_currency_labels([\n\t\t\t\"base_rate\", \"base_net_rate\", \"base_price_list_rate\",\n\t\t\t\"base_amount\", \"base_net_amount\", \"base_rate_with_margin\"\n\t\t], company_currency, \"items\");\n\n\t\tthis.frm.set_currency_labels([\n\t\t\t\"rate\", \"net_rate\", \"price_list_rate\", \"amount\",\n\t\t\t\"net_amount\", \"stock_uom_rate\", \"rate_with_margin\"\n\t\t], this.frm.doc.currency, \"items\");\n\t}\n\n\tupdate_payment_schedule_grid_labels(company_currency) {\n\t\tconst me = this;\n\t\tif (this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"],\n\t\t\t\tcompany_currency, \"payment_schedule\");\n\t\t\tthis.frm.set_currency_labels([\"payment_amount\", \"outstanding\", \"paid_amount\"],\n\t\t\t\tthis.frm.doc.currency, \"payment_schedule\");\n\n\t\t\tvar schedule_grid = this.frm.fields_dict[\"payment_schedule\"].grid;\n\t\t\t$.each([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"], function(i, fname) {\n\t\t\t\tif (frappe.meta.get_docfield(schedule_grid.doctype, fname))\n\t\t\t\t\tschedule_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\t}\n\n\ttoggle_item_grid_columns(company_currency) {\n\t\tconst me = this;\n\t\t// toggle columns\n\t\tvar item_grid = this.frm.fields_dict[\"items\"].grid;\n\t\t$.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\", \"base_rate_with_margin\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t});\n\n\t\tvar show = (cint(cur_frm.doc.discount_amount)) ||\n\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\t$.each([\"net_rate\", \"net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, show);\n\t\t});\n\n\t\t$.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\n\t\t});\n\t}\n\n\trecalculate() {\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\trecalculate_values() {\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tcalculate_charges() {\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tignore_pricing_rule() {\n\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\tvar me = this;\n\t\t\tvar item_list = [];\n\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tif (d.item_code) {\n\t\t\t\t\tif (d.is_free_item) {\n\t\t\t\t\t\t// Simply remove free items\n\t\t\t\t\t\tme.frm.get_field(\"items\").grid.grid_rows[i].remove();\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem_list.push({\n\t\t\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\t\t\"price_list_rate\": d.price_list_rate\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n\t\t\t\targs: { item_list: item_list },\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tr.message.forEach(row_item => {\n\t\t\t\t\t\t\tme.remove_pricing_rule(row_item);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.apply_pricing_rule();\n\t\t}\n\t}\n\n\tapply_pricing_rule(item, calculate_taxes_and_totals) {\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!(args.items && args.items.length)) {\n\t\t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\t// Target doc created from a mapped doc\n\t\tif (this.frm.doc.__onload && this.frm.doc.__onload.ignore_price_list) {\n\t\t\t// Calculate totals even though pricing rule is not applied.\n\t\t\t// `apply_pricing_rule` is triggered due to change in data which most likely contributes to Total.\n\t\t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\n\t\t\targs: {\targs: args, doc: me.frm.doc },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\tif(item) me.set_gross_profit(item);\n\t\t\t\t\tif (me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t_get_args(item) {\n\t\tvar me = this;\n\t\treturn {\n\t\t\t\"items\": this._get_item_list(item),\n\t\t\t\"customer\": me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\"quotation_to\": me.frm.doc.quotation_to,\n\t\t\t\"customer_group\": me.frm.doc.customer_group,\n\t\t\t\"territory\": me.frm.doc.territory,\n\t\t\t\"supplier\": me.frm.doc.supplier,\n\t\t\t\"supplier_group\": me.frm.doc.supplier_group,\n\t\t\t\"currency\": me.frm.doc.currency,\n\t\t\t\"conversion_rate\": me.frm.doc.conversion_rate,\n\t\t\t\"price_list\": me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\"price_list_currency\": me.frm.doc.price_list_currency,\n\t\t\t\"plc_conversion_rate\": me.frm.doc.plc_conversion_rate,\n\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\"transaction_date\": me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\"campaign\": me.frm.doc.campaign,\n\t\t\t\"sales_partner\": me.frm.doc.sales_partner,\n\t\t\t\"ignore_pricing_rule\": me.frm.doc.ignore_pricing_rule,\n\t\t\t\"doctype\": me.frm.doc.doctype,\n\t\t\t\"name\": me.frm.doc.name,\n\t\t\t\"is_return\": cint(me.frm.doc.is_return),\n\t\t\t\"update_stock\": in_list(['Sales Invoice', 'Purchase Invoice'], me.frm.doc.doctype) ? cint(me.frm.doc.update_stock) : 0,\n\t\t\t\"conversion_factor\": me.frm.doc.conversion_factor,\n\t\t\t\"pos_profile\": me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\n\t\t\t\"coupon_code\": me.frm.doc.coupon_code\n\t\t};\n\t}\n\n\t_get_item_list(item) {\n\t\tvar item_list = [];\n\t\tvar append_item = function(d) {\n\t\t\tif (d.item_code) {\n\t\t\t\titem_list.push({\n\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\"child_docname\": d.name,\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\"item_group\": d.item_group,\n\t\t\t\t\t\"brand\": d.brand,\n\t\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\t\"stock_qty\": d.stock_qty,\n\t\t\t\t\t\"uom\": d.uom,\n\t\t\t\t\t\"stock_uom\": d.stock_uom,\n\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\"warehouse\": d.warehouse,\n\t\t\t\t\t\"serial_no\": d.serial_no,\n\t\t\t\t\t\"batch_no\": d.batch_no,\n\t\t\t\t\t\"price_list_rate\": d.price_list_rate,\n\t\t\t\t\t\"conversion_factor\": d.conversion_factor || 1.0\n\t\t\t\t});\n\n\t\t\t\t// if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\n\t\t\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\",  \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), d.doctype) {\n\t\t\t\t\titem_list[0][\"margin_type\"] = d.margin_type;\n\t\t\t\t\titem_list[0][\"margin_rate_or_amount\"] = d.margin_rate_or_amount;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (item) {\n\t\t\tappend_item(item);\n\t\t} else {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tappend_item(d);\n\t\t\t});\n\t\t}\n\t\treturn item_list;\n\t}\n\n\t_set_values_for_item_list(children) {\n\t\tconst items_rule_dict = {};\n\n\t\tfor (const child of children) {\n\t\t\tconst existing_pricing_rule = frappe.model.get_value(child.doctype, child.name, \"pricing_rules\");\n\n\t\t\tfor (const [key, value] of Object.entries(child)) {\n\t\t\t\tif (![\"doctype\", \"name\"].includes(key)) {\n\t\t\t\t\tif (key === \"price_list_rate\") {\n\t\t\t\t\t\tfrappe.model.set_value(child.doctype, child.name, \"rate\", value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === \"pricing_rules\") {\n\t\t\t\t\t\tfrappe.model.set_value(child.doctype, child.name, key, value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key !== \"free_item_data\") {\n\t\t\t\t\t\tif (child.apply_rule_on_other_items && JSON.parse(child.apply_rule_on_other_items).length) {\n\t\t\t\t\t\t\tif (!in_list(JSON.parse(child.apply_rule_on_other_items), child.item_code)) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfrappe.model.set_value(child.doctype, child.name, key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(\n\t\t\t\tfrappe.get_doc(child.doctype, child.name),\n\t\t\t\t[\"price_list_rate\", \"discount_percentage\"],\n\t\t\t);\n\n\t\t\t// if pricing rule set as blank from an existing value, apply price_list\n\t\t\tif (!this.frm.doc.ignore_pricing_rule && existing_pricing_rule && !child.pricing_rules) {\n\t\t\t\tthis.apply_price_list(frappe.get_doc(child.doctype, child.name));\n\t\t\t} else if (!child.pricing_rules) {\n\t\t\t\tthis.remove_pricing_rule(frappe.get_doc(child.doctype, child.name));\n\t\t\t}\n\n\t\t\tif (child.free_item_data && child.free_item_data.length > 0) {\n\t\t\t\tthis.apply_product_discount(child);\n\t\t\t}\n\n\t\t\tif (child.apply_rule_on_other_items && JSON.parse(child.apply_rule_on_other_items).length) {\n\t\t\t\titems_rule_dict[child.name] = child;\n\t\t\t}\n\t\t}\n\n\t\tthis.apply_rule_on_other_items(items_rule_dict);\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tapply_rule_on_other_items(args) {\n\t\tconst me = this;\n\t\tconst fields = [\"discount_percentage\", \"pricing_rules\", \"discount_amount\", \"rate\"];\n\n\t\tfor(var k in args) {\n\t\t\tlet data = args[k];\n\n\t\t\tif (data && data.apply_rule_on_other_items && JSON.parse(data.apply_rule_on_other_items)) {\n\t\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\t\tif (in_list(JSON.parse(data.apply_rule_on_other_items), d[data.apply_rule_on])) {\n\t\t\t\t\t\tfor(var k in data) {\n\t\t\t\t\t\t\tif (in_list(fields, k) && data[k] && (data.price_or_product_discount === 'Price' || k === 'pricing_rules')) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, data[k]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tapply_product_discount(args) {\n\t\tconst items = this.frm.doc.items.filter(d => (d.is_free_item)) || [];\n\n\t\tconst exist_items = items.map(row => (row.item_code, row.pricing_rules));\n\n\t\targs.free_item_data.forEach(pr_row => {\n\t\t\tlet row_to_modify = {};\n\t\t\tif (!items || !in_list(exist_items, (pr_row.item_code, pr_row.pricing_rules))) {\n\n\t\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc,\n\t\t\t\t\tthis.frm.doc.doctype + ' Item', 'items');\n\n\t\t\t} else if(items) {\n\t\t\t\trow_to_modify = items.filter(d => (d.item_code === pr_row.item_code\n\t\t\t\t\t&& d.pricing_rules === pr_row.pricing_rules))[0];\n\t\t\t}\n\n\t\t\tfor (let key in pr_row) {\n\t\t\t\trow_to_modify[key] = pr_row[key];\n\t\t\t}\n\t\t\tthis.frm.script_manager.copy_from_first_row(\"items\", row_to_modify, [\"expense_account\", \"income_account\"]);\n\t\t});\n\n\t\t// free_item_data is a temporary variable\n\t\targs.free_item_data = '';\n\t\trefresh_field('items');\n\t}\n\n\tapply_price_list(item, reset_plc_conversion) {\n\t\t// We need to reset plc_conversion_rate sometimes because the call to\n\t\t// `erpnext.stock.get_item_details.apply_price_list` is sensitive to its value\n\t\tif (!reset_plc_conversion) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", \"\");\n\t\t}\n\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!((args.items && args.items.length) || args.price_list)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (me.in_apply_price_list == true) return;\n\n\t\tme.in_apply_price_list = true;\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.stock.get_item_details.apply_price_list\",\n\t\t\targs: {\targs: args },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => me.frm.set_value(\"price_list_currency\", r.message.parent.price_list_currency),\n\t\t\t\t\t\t() => me.frm.set_value(\"plc_conversion_rate\", r.message.parent.plc_conversion_rate),\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif(args.items.length) {\n\t\t\t\t\t\t\t\tme._set_values_for_item_list(r.message.children);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => { me.in_apply_price_list = false; }\n\t\t\t\t\t]);\n\n\t\t\t\t} else {\n\t\t\t\t\tme.in_apply_price_list = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}).always(() => {\n\t\t\tme.in_apply_price_list = false;\n\t\t});\n\t}\n\n\tremove_pricing_rule(item) {\n\t\tlet me = this;\n\t\tconst fields = [\"discount_percentage\",\n\t\t\t\"discount_amount\", \"margin_rate_or_amount\", \"rate_with_margin\"];\n\n\t\tif(item.remove_free_item) {\n\t\t\tvar items = [];\n\n\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\tif(d.item_code != item.remove_free_item || !d.is_free_item) {\n\t\t\t\t\titems.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.frm.doc.items = items;\n\t\t\trefresh_field('items');\n\t\t} else if(item.applied_on_items && item.apply_on) {\n\t\t\tconst applied_on_items = item.applied_on_items.split(',');\n\t\t\tme.frm.doc.items.forEach(row => {\n\t\t\t\tif(applied_on_items.includes(row[item.apply_on])) {\n\t\t\t\t\tfields.forEach(f => {\n\t\t\t\t\t\trow[f] = 0;\n\t\t\t\t\t});\n\n\t\t\t\t\t[\"pricing_rules\", \"margin_type\"].forEach(field => {\n\t\t\t\t\t\tif (row[field]) {\n\t\t\t\t\t\t\trow[field] = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.trigger_price_list_rate();\n\t\t}\n\t}\n\n\ttrigger_price_list_rate() {\n\t\tvar me  = this;\n\n\t\tthis.frm.doc.items.forEach(child_row => {\n\t\t\tme.frm.script_manager.trigger(\"price_list_rate\",\n\t\t\t\tchild_row.doctype, child_row.name);\n\t\t})\n\t}\n\n\tvalidate_company_and_party() {\n\t\tvar me = this;\n\t\tvar valid = true;\n\n\t\t$.each([\"company\", \"customer\"], function(i, fieldname) {\n\t\t\tif(frappe.meta.has_field(me.frm.doc.doctype, fieldname) && me.frm.doc.doctype != \"Purchase Order\") {\n\t\t\t\tif (!me.frm.doc[fieldname]) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please specify\") + \": \" +\n\t\t\t\t\t\tfrappe.meta.get_label(me.frm.doc.doctype, fieldname, me.frm.doc.name) +\n\t\t\t\t\t\t\". \" + __(\"It is needed to fetch Item Details.\"));\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn valid;\n\t}\n\n\tget_terms() {\n\t\tvar me = this;\n\n\t\terpnext.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function(r) {\n\t\t\tif(!r.exc) {\n\t\t\t\tme.frm.set_value(\"terms\", r.message);\n\t\t\t}\n\t\t});\n\t}\n\n\ttaxes_and_charges() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.taxes_and_charges) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\t\t\t\tthis.frm.doc.name).options,\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(me.frm.doc.shipping_rule && me.frm.doc.taxes) {\n\t\t\t\t\t\t\tfor (let tax of r.message) {\n\t\t\t\t\t\t\t\tme.frm.add_child(\"taxes\", tax);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trefresh_field(\"taxes\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\n\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\ttax_category() {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tfrappe.run_serially([\n\t\t\t() => this.update_item_tax_map(),\n\t\t\t() => erpnext.utils.set_taxes(this.frm, \"tax_category\"),\n\t\t]);\n\t}\n\n\tupdate_item_tax_map() {\n\t\tlet me = this;\n\t\tlet item_codes = [];\n\t\tlet item_rates = {};\n\t\tlet item_tax_templates = {};\n\n\t\t$.each(this.frm.doc.items || [], function(i, item) {\n\t\t\tif (item.item_code) {\n\t\t\t\t// Use combination of name and item code in case same item is added multiple times\n\t\t\t\titem_codes.push([item.item_code, item.name]);\n\t\t\t\titem_rates[item.name] = item.net_rate;\n\t\t\t\titem_tax_templates[item.name] = item.item_tax_template;\n\t\t\t}\n\t\t});\n\n\t\tif (item_codes.length) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_info\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\ttax_category: cstr(me.frm.doc.tax_category),\n\t\t\t\t\titem_codes: item_codes,\n\t\t\t\t\titem_rates: item_rates,\n\t\t\t\t\titem_tax_templates: item_tax_templates\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t$.each(me.frm.doc.items || [], function(i, item) {\n\t\t\t\t\t\t\tif (item.name && r.message.hasOwnProperty(item.name) && r.message[item.name].item_tax_template) {\n\t\t\t\t\t\t\t\titem.item_tax_template = r.message[item.name].item_tax_template;\n\t\t\t\t\t\t\t\titem.item_tax_rate = r.message[item.name].item_tax_rate;\n\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\titem_tax_template(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(item.item_tax_template) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_map\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\tas_json: true\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\titem.item_tax_rate = r.message;\n\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titem.item_tax_rate = \"{}\";\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t}\n\n\n\tis_recurring() {\n\t\t// set default values for recurring documents\n\t\tif(this.frm.doc.is_recurring && this.frm.doc.__islocal) {\n\t\t\tfrappe.msgprint(__(\"Please set recurring after saving\"));\n\t\t\tthis.frm.set_value('is_recurring', 0);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.frm.doc.is_recurring) {\n\t\t\tif(!this.frm.doc.recurring_id) {\n\t\t\t\tthis.frm.set_value('recurring_id', this.frm.doc.name);\n\t\t\t}\n\n\t\t\tvar owner_email = this.frm.doc.owner==\"Administrator\"\n\t\t\t\t? frappe.user_info(\"Administrator\").email\n\t\t\t\t: this.frm.doc.owner;\n\n\t\t\tthis.frm.doc.notification_email_address = $.map([cstr(owner_email),\n\t\t\t\tcstr(this.frm.doc.contact_email)], function(v) { return v || null; }).join(\", \");\n\t\t\tthis.frm.doc.repeat_on_day_of_month = frappe.datetime.str_to_obj(this.frm.doc.posting_date).getDate();\n\t\t}\n\n\t\trefresh_many([\"notification_email_address\", \"repeat_on_day_of_month\"]);\n\t}\n\n\tfrom_date() {\n\t\t// set to_date\n\t\tif(this.frm.doc.from_date) {\n\t\t\tvar recurring_type_map = {'Monthly': 1, 'Quarterly': 3, 'Half-yearly': 6,\n\t\t\t\t'Yearly': 12};\n\n\t\t\tvar months = recurring_type_map[this.frm.doc.recurring_type];\n\t\t\tif(months) {\n\t\t\t\tvar to_date = frappe.datetime.add_months(this.frm.doc.from_date,\n\t\t\t\t\tmonths);\n\t\t\t\tthis.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\n\t\t\t\trefresh_field('to_date');\n\t\t\t}\n\t\t}\n\t}\n\n\tset_gross_profit(item) {\n\t\tif ([\"Sales Order\", \"Quotation\"].includes(this.frm.doc.doctype) && item.valuation_rate) {\n\t\t\tvar rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\n\t\t\titem.gross_profit = flt(((rate - item.valuation_rate) * item.stock_qty), precision(\"amount\", item));\n\t\t}\n\t}\n\n\tsetup_item_selector() {\n\t\t// TODO: remove item selector\n\n\t\treturn;\n\t\t// if(!this.item_selector) {\n\t\t// \tthis.item_selector = new erpnext.ItemSelector({frm: this.frm});\n\t\t// }\n\t}\n\n\tget_advances() {\n\t\tif(!this.frm.is_return) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"set_advances\",\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\trefresh_field(\"advances\");\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tmake_payment_entry() {\n\t\treturn frappe.call({\n\t\t\tmethod: cur_frm.cscript.get_method_for_payment(),\n\t\t\targs: {\n\t\t\t\t\"dt\": cur_frm.doc.doctype,\n\t\t\t\t\"dn\": cur_frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t\t// cur_frm.refresh_fields()\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_quality_inspection() {\n\t\tlet data = [];\n\t\tconst fields = [\n\t\t\t{\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tfieldname: \"items\",\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tin_place_edit: true,\n\t\t\t\tdata: data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"docname\",\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_code\",\n\t\t\t\t\t\tlabel: __(\"Item Code\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_name\",\n\t\t\t\t\t\tlabel: __(\"Item Name\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"qty\",\n\t\t\t\t\t\tlabel: __(\"Accepted Quantity\"),\n\t\t\t\t\t\tin_list_view: true,\n\t\t\t\t\t\tread_only: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"sample_size\",\n\t\t\t\t\t\tlabel: __(\"Sample Size\"),\n\t\t\t\t\t\treqd: true,\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"description\",\n\t\t\t\t\t\tlabel: __(\"Description\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\t\t\tlabel: __(\"Serial No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t];\n\n\t\tconst me = this;\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Select Items for Quality Inspection\"),\n\t\t\tfields: fields,\n\t\t\tprimary_action: function () {\n\t\t\t\tconst data = dialog.get_values();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.controllers.stock_controller.make_quality_inspections\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\tdocname: me.frm.doc.name,\n\t\t\t\t\t\titems: data.items\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message.length > 0) {\n\t\t\t\t\t\t\tif (r.message.length === 1) {\n\t\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Quality Inspection\", r.message[0]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\t\t\t\t\t\"reference_name\": me.frm.doc.name\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tfrappe.set_route(\"List\", \"Quality Inspection\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Create\")\n\t\t});\n\n\t\tthis.frm.doc.items.forEach(item => {\n\t\t\tif (!item.quality_inspection) {\n\t\t\t\tlet dialog_items = dialog.fields_dict.items;\n\t\t\t\tdialog_items.df.data.push({\n\t\t\t\t\t\"docname\": item.name,\n\t\t\t\t\t\"item_code\": item.item_code,\n\t\t\t\t\t\"item_name\": item.item_name,\n\t\t\t\t\t\"qty\": item.qty,\n\t\t\t\t\t\"description\": item.description,\n\t\t\t\t\t\"serial_no\": item.serial_no,\n\t\t\t\t\t\"batch_no\": item.batch_no,\n\t\t\t\t\t\"sample_size\": item.sample_quantity\n\t\t\t\t});\n\t\t\t\tdialog_items.grid.refresh();\n\t\t\t}\n\t\t});\n\n\t\tdata = dialog.fields_dict.items.df.data;\n\t\tif (!data.length) {\n\t\t\tfrappe.msgprint(__(\"All items in this document already have a linked Quality Inspection.\"));\n\t\t} else {\n\t\t\tdialog.show();\n\t\t}\n\t}\n\n\tget_method_for_payment() {\n\t\tvar method = \"erpnext.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\n\t\tif(cur_frm.doc.__onload && cur_frm.doc.__onload.make_payment_via_journal_entry){\n\t\t\tif(in_list(['Sales Invoice', 'Purchase Invoice'],  cur_frm.doc.doctype)){\n\t\t\t\tmethod = \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\n\t\t\t}else {\n\t\t\t\tmethod= \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\n\t\t\t}\n\t\t}\n\n\t\treturn method\n\t}\n\n\tset_query_for_batch(doc, cdt, cdn) {\n\t\t// Show item's batches in the dropdown of batch no\n\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(!item.item_code) {\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\n\t\t} else if (doc.doctype == \"Purchase Receipt\" ||\n\t\t\t(doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\n\t\t\treturn {\n\t\t\t\tfilters: {'item': item.item_code}\n\t\t\t}\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'posting_date': me.frm.doc.posting_date || frappe.datetime.nowdate(),\n\t\t\t}\n\n\t\t\tif (doc.is_return) {\n\t\t\t\tfilters[\"is_return\"] = 1;\n\t\t\t}\n\n\t\t\tif (item.warehouse) filters[\"warehouse\"] = item.warehouse;\n\n\t\t\treturn {\n\t\t\t\tquery : \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t}\n\n\tset_query_for_item_tax_template(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(!item.item_code) {\n\t\t\treturn doc.company ? {filters: {company: doc.company}} : {};\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'valid_from': [\"<=\", doc.transaction_date || doc.bill_date || doc.posting_date],\n\t\t\t\t'item_group': item.item_group,\n\t\t\t}\n\n\t\t\tif (doc.tax_category)\n\t\t\t\tfilters['tax_category'] = doc.tax_category;\n\t\t\tif (doc.company)\n\t\t\t\tfilters['company'] = doc.company;\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.controllers.queries.get_tax_template\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t}\n\n\tpayment_terms_template() {\n\t\tvar me = this;\n\t\tconst doc = this.frm.doc;\n\t\tif(doc.payment_terms_template && doc.doctype !== 'Delivery Note') {\n\t\t\tvar posting_date = doc.posting_date || doc.transaction_date;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_terms\",\n\t\t\t\targs: {\n\t\t\t\t\tterms_template: doc.payment_terms_template,\n\t\t\t\t\tposting_date: posting_date,\n\t\t\t\t\tgrand_total: doc.rounded_total || doc.grand_total,\n\t\t\t\t\tbase_grand_total: doc.base_rounded_total || doc.base_grand_total,\n\t\t\t\t\tbill_date: doc.bill_date\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"payment_schedule\", r.message);\n\t\t\t\t\t\tconst company_currency = me.get_company_currency();\n\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tpayment_term(doc, cdt, cdn) {\n\t\tconst me = this;\n\t\tvar row = locals[cdt][cdn];\n\t\tif(row.payment_term) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_term_details\",\n\t\t\t\targs: {\n\t\t\t\t\tterm: row.payment_term,\n\t\t\t\t\tbill_date: this.frm.doc.bill_date,\n\t\t\t\t\tposting_date: this.frm.doc.posting_date || this.frm.doc.transaction_date,\n\t\t\t\t\tgrand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total,\n\t\t\t\t\tbase_grand_total: this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, d, r.message[d]);\n\t\t\t\t\t\t\tconst company_currency = me.get_company_currency();\n\t\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tagainst_blanket_order(doc, cdt, cdn) {\n\t\tvar item = locals[cdt][cdn];\n\t\tif(!item.against_blanket_order) {\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order\", null);\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order_rate\", 0.00);\n\t\t}\n\t}\n\n\tblanket_order(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = locals[cdt][cdn];\n\t\tif (item.blanket_order && (item.parenttype==\"Sales Order\" || item.parenttype==\"Purchase Order\")) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_blanket_order_details\",\n\t\t\t\targs: {\n\t\t\t\t\targs:{\n\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\tcustomer: doc.customer,\n\t\t\t\t\t\tsupplier: doc.supplier,\n\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\ttransaction_date: doc.transaction_date,\n\t\t\t\t\t\tblanket_order: item.blanket_order\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.message) {\n\t\t\t\t\t\tfrappe.throw(__(\"Invalid Blanket Order for the selected Customer and Item\"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => frappe.model.set_value(cdt, cdn, \"blanket_order_rate\", r.message.blanket_order_rate),\n\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn)\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tset_reserve_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.supplied_items, \"reserve_warehouse\", this.frm.doc.set_reserve_warehouse);\n\t}\n\n\tset_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"warehouse\", this.frm.doc.set_warehouse);\n\t}\n\n\tset_target_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"target_warehouse\", this.frm.doc.set_target_warehouse);\n\t}\n\n\tset_from_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"from_warehouse\", this.frm.doc.set_from_warehouse);\n\t}\n\n\tautofill_warehouse(child_table, warehouse_field, warehouse) {\n\t\tif (warehouse && child_table && child_table.length) {\n\t\t\tlet doctype = child_table[0].doctype;\n\t\t\t$.each(child_table || [], function(i, item) {\n\t\t\t\tfrappe.model.set_value(doctype, item.name, warehouse_field, warehouse);\n\t\t\t});\n\t\t}\n\t}\n\n\tcoupon_code() {\n\t\tif (this.frm.doc.coupon_code || this.frm._last_coupon_code) {\n\t\t\t// reset pricing rules if coupon code is set or is unset\n\t\t\tconst _ignore_pricing_rule = this.frm.doc.ignore_pricing_rule;\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => this.frm.doc.ignore_pricing_rule=1,\n\t\t\t\t() => this.frm.trigger('ignore_pricing_rule'),\n\t\t\t\t() => this.frm.doc.ignore_pricing_rule=_ignore_pricing_rule,\n\t\t\t\t() => this.frm.trigger('apply_pricing_rule'),\n\t\t\t\t() => this.frm._last_coupon_code = this.frm.doc.coupon_code\n\t\t\t]);\n\t\t}\n\t}\n};\n\nerpnext.show_serial_batch_selector = function (frm, d, callback, on_close, show_dialog) {\n\tlet warehouse, receiving_stock, existing_stock;\n\tif (frm.doc.is_return) {\n\t\tif ([\"Purchase Receipt\", \"Purchase Invoice\"].includes(frm.doc.doctype)) {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = d.warehouse;\n\t\t} else if ([\"Delivery Note\", \"Sales Invoice\"].includes(frm.doc.doctype)) {\n\t\t\treceiving_stock = true;\n\t\t}\n\t} else {\n\t\tif (frm.doc.doctype == \"Stock Entry\") {\n\t\t\tif (frm.doc.purpose == \"Material Receipt\") {\n\t\t\t\treceiving_stock = true;\n\t\t\t} else {\n\t\t\t\texisting_stock = true;\n\t\t\t\twarehouse = d.s_warehouse;\n\t\t\t}\n\t\t} else {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = d.warehouse;\n\t\t}\n\t}\n\n\tif (!warehouse) {\n\t\tif (receiving_stock) {\n\t\t\twarehouse = [\"like\", \"\"];\n\t\t} else if (existing_stock) {\n\t\t\twarehouse = [\"!=\", \"\"];\n\t\t}\n\t}\n\n\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", function() {\n\t\tnew erpnext.SerialNoBatchSelector({\n\t\t\tfrm: frm,\n\t\t\titem: d,\n\t\t\twarehouse_details: {\n\t\t\t\ttype: \"Warehouse\",\n\t\t\t\tname: warehouse\n\t\t\t},\n\t\t\tcallback: callback,\n\t\t\ton_close: on_close\n\t\t}, show_dialog);\n\t});\n}\n\nerpnext.apply_putaway_rule = (frm, purpose=null) => {\n\tif (!frm.doc.company) {\n\t\tfrappe.throw({message: __(\"Please select a Company first.\"), title: __(\"Mandatory\")});\n\t}\n\tif (!frm.doc.items.length) return;\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.stock.doctype.putaway_rule.putaway_rule.apply_putaway_rule\",\n\t\targs: {\n\t\t\tdoctype: frm.doctype,\n\t\t\titems: frm.doc.items,\n\t\t\tcompany: frm.doc.company,\n\t\t\tsync: true,\n\t\t\tpurpose: purpose\n\t\t},\n\t\tcallback: (result) => {\n\t\t\tif (!result.exc && result.message) {\n\t\t\t\tfrm.clear_table(\"items\");\n\n\t\t\t\tlet items =  result.message;\n\t\t\t\titems.forEach((row) => {\n\t\t\t\t\tdelete row[\"name\"]; // dont overwrite name from server side\n\t\t\t\t\tlet child = frm.add_child(\"items\");\n\t\t\t\t\tObject.assign(child, row);\n\t\t\t\t\tfrm.script_manager.trigger(\"qty\", child.doctype, child.name);\n\t\t\t\t});\n\t\t\t\tfrm.get_field(\"items\").grid.refresh();\n\t\t\t}\n\t\t}\n\t});\n};\n", "\n\tfrappe.templates['item_selector'] = `<div class=\"app-listing item-list image-view-container item-selector\">\n{% for (var i=0; i < data.length; i++) { var item = data[i]; %}\n\t{% if (i % 4 === 0) { %}<div class=\"image-view-row\">{% } %}\n\t<div class=\"image-view-item\" data-name=\"{{ item.name }}\">\n\t\t<div class=\"image-view-header doclist-row\">\n\t\t\t<div class=\"list-value\">\n\t\t\t\t<a class=\"grey list-id\" data-name=\"{{item.name}}\"\n\t\t\t\t\ttitle=\"{{ item.item_name || item.name}}\">\n\t\t\t\t\t{{item.item_name || item.name}}</a>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"image-view-body\">\n\t\t\t<a  data-item-code=\"{{ item.name }}\"\n\t\t\t\ttitle=\"{{ item.item_name || item.name }}\"\n\t\t\t>\n\t\t\t\t<div class=\"image-field\"\n\t\t\t\t\tstyle=\"\n\t\t\t\t\t{% if (!item.image) { %}\n\t\t\t\t\t\tbackground-color: #fafbfc;\n\t\t\t\t\t{% } %}\n\t\t\t\t\tborder: 0px;\"\n\t\t\t\t>\n\t\t\t\t\t{% if (!item.image) { %}\n\t\t\t\t\t<span class=\"placeholder-text\">\n\t\t\t\t\t\t{%= frappe.get_abbr(item.item_name || item.name) %}\n\t\t\t\t\t</span>\n\t\t\t\t\t{% } %}\n\t\t\t\t\t{% if (item.image) { %}\n\t\t\t\t\t<img src=\"{{ item.image }}\" alt=\"{{item.item_name || item.name}}\">\n\t\t\t\t\t{% } %}\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t{% if ((i % 4 === 3) || (i===data.length - 1)) { %}</div>{% } %}\n{% endfor %}\n</div>\n`;\n", "erpnext.ItemSelector = class ItemSelector {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = 'item_code';\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = erpnext.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tvar me = this;\n\t\tif(!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__('Add Items'), function() {\n\t\t\t\tif(!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function() { me.dialog.input.focus(); }, 1000);\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_dialog() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add Items')\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html('<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>');\n\n\t\tthis.dialog.input = body.find('.form-control');\n\t\tthis.dialog.results = body.find('.results');\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on('click', '.image-view-item', function() {\n\t\t\tme.add_item($(this).attr('data-name'));\n\t\t});\n\n\t\tthis.dialog.input.on('keyup', function() {\n\t\t\tif(me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function() {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t}\n\n\tadd_item(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif(d[this.item_field]===item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', d.qty + 1);\n\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: 'green'});\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif(!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => { d = this.grid.add_new_row(); },\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', 1);\n\t\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: 'green'});\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t}\n\n\trender_items() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {}\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function(r) {\n\t\t\t$.each(r.values, function(i, d) {\n\t\t\t\tif(!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template('item_selector', {'data':r.values}));\n\t\t});\n\t}\n};\n", "frappe.provide(\"frappe.help.help_links\");\n\nconst docsUrl = \"https://erpnext.com/docs/\";\n\nfrappe.help.help_links[\"Form/Rename Tool\"] = [\n\t{\n\t\tlabel: \"Bulk Rename\",\n\t\turl: docsUrl + \"user/manual/en/using-erpnext/articles/bulk-rename\",\n\t},\n];\n\n//Setup\n\nfrappe.help.help_links[\"List/User\"] = [\n\t{\n\t\tlabel: \"New User\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/adding-users\",\n\t},\n\t{\n\t\tlabel: \"Rename User\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/rename-user\",\n\t},\n];\n\nfrappe.help.help_links[\"permission-manager\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/role-based-permissions\",\n\t},\n\t{\n\t\tlabel: \"Managing Perm Level in Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/managing-perm-level\",\n\t},\n\t{\n\t\tlabel: \"User Permissions\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/user-permissions\",\n\t},\n\t{\n\t\tlabel: \"Sharing\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/setting-up/users-and-permissions/sharing\",\n\t},\n\t{\n\t\tlabel: \"Password\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/change-password\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/System Settings\"] = [\n\t{\n\t\tlabel: \"System Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/system-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/data/data-import\",\n\t},\n\t{\n\t\tlabel: \"Overwriting Data from Data Import Tool\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/data/data-import\",\n\t},\n\t{\n\t\tlabel: \"Overwriting Data from Data Import Tool\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool\",\n\t},\n];\n\nfrappe.help.help_links[\"module_setup\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/role-based-permissions\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Naming Series\"] = [\n\t{\n\t\tlabel: \"Naming Series\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/naming-series\",\n\t},\n\t{\n\t\tlabel: \"Setting the Current Value for Naming Series\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/naming-series-current-value\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Global Defaults\"] = [\n\t{\n\t\tlabel: \"Global Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/global-defaults\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Letter Head\"] = [\n\t{\n\t\tlabel: \"Letter Head\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/letter-head\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Address Template\"] = [\n\t{\n\t\tlabel: \"Address Template\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/address-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Terms and Conditions\"] = [\n\t{\n\t\tlabel: \"Terms and Conditions\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/terms-and-conditions\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Cheque Print Template\"] = [\n\t{\n\t\tlabel: \"Cheque Print Template\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/cheque-print-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Email Account\"] = [\n\t{\n\t\tlabel: \"Email Account\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-account\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Auto Email Report\"] = [\n\t{\n\t\tlabel: \"Auto Email Reports\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/auto-email-reports\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Settings\"] = [\n\t{\n\t\tlabel: \"Print Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"print-format-builder\"] = [\n\t{\n\t\tlabel: \"Print Format Builder\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-format-builder\",\n\t},\n];\n\n//setup-integrations\n\nfrappe.help.help_links[\"Form/PayPal Settings\"] = [\n\t{\n\t\tlabel: \"PayPal Settings\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/erpnext_integration/paypal-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Razorpay Settings\"] = [\n\t{\n\t\tlabel: \"Razorpay Settings\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/erpnext_integration/razorpay-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Dropbox Settings\"] = [\n\t{\n\t\tlabel: \"Dropbox Settings\",\n\t\turl: docsUrl + \"user/manual/en/erpnext_integration/dropbox-backup\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/LDAP Settings\"] = [\n\t{\n\t\tlabel: \"LDAP Settings\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/erpnext_integration/ldap-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stripe Settings\"] = [\n\t{\n\t\tlabel: \"Stripe Settings\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/erpnext_integration/stripe-integration\",\n\t},\n];\n\n//Sales\n\nfrappe.help.help_links[\"Form/Quotation\"] = [\n\t{ label: \"Quotation\", url: docsUrl + \"user/manual/en/selling/quotation\" },\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/CRM/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/accounts/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/CRM/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/accounts/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Drop Shipping\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/drop-shipping\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Close Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/close-sales-order\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Product Bundle\"] = [\n\t{\n\t\tlabel: \"Product Bundle\",\n\t\turl: docsUrl + \"user/manual/en/selling/product-bundle\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Selling Settings\"] = [\n\t{\n\t\tlabel: \"Selling Settings\",\n\t\turl: docsUrl + \"user/manual/en/selling/selling-settings\",\n\t},\n];\n\n//Buying\n\nfrappe.help.help_links[\"List/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/buying/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/buying/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Request for Quotation\"] = [\n\t{\n\t\tlabel: \"Request for Quotation\",\n\t\turl: docsUrl + \"user/manual/en/buying/request-for-quotation\",\n\t},\n\t{\n\t\tlabel: \"RFQ Video\",\n\t\turl: docsUrl + \"user/videos/learn/request-for-quotation.html\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Supplier Quotation\"] = [\n\t{\n\t\tlabel: \"Supplier Quotation\",\n\t\turl: docsUrl + \"user/manual/en/buying/supplier-quotation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Buying Settings\"] = [\n\t{\n\t\tlabel: \"Buying Settings\",\n\t\turl: docsUrl + \"user/manual/en/buying/setup/buying-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/buying/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/buying/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Item UoM\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/buying/articles/purchasing-in-different-unit\",\n\t},\n\t{\n\t\tlabel: \"Supplier Item Code\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/buying/articles/maintaining-suppliers-part-no-in-item\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Price List\"] = [\n\t{\n\t\tlabel: \"Price List\",\n\t\turl: docsUrl + \"user/manual/en/stock/price-lists\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Authorization Rule\"] = [\n\t{\n\t\tlabel: \"Authorization Rule\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/authorization-rule\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/SMS Settings\"] = [\n\t{\n\t\tlabel: \"SMS Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/sms-setting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Stock Reconciliation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/stock-reconciliation\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Territory\"] = [\n\t{\n\t\tlabel: \"Territory\",\n\t\turl: docsUrl + \"user/manual/en/selling/territory\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Workflow\"] = [\n\t{ label: \"Workflow\", url: docsUrl + \"user/manual/en/setting-up/workflows\" },\n];\n\nfrappe.help.help_links[\"List/Company\"] = [\n\t{\n\t\tlabel: \"Company\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/company-setup\",\n\t},\n\t{\n\t\tlabel: \"Delete All Related Transactions for a Company\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/delete-a-company-and-all-related-transactions\",\n\t},\n];\n\n//Accounts\n\nfrappe.help.help_links[\"Tree/Account\"] = [\n\t{\n\t\tlabel: \"Chart of Accounts\",\n\t\turl: docsUrl + \"user/manual/en/accounts/chart-of-accounts\",\n\t},\n\t{\n\t\tlabel: \"Managing Tree Mastes\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/managing-tree-structure-masters\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balances\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"point-of-sale\"] = [\n\t{\n\t\tlabel: \"Point of Sale Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/point-of-sales\",\n\t},\n];\n\nfrappe.help.help_links[\"List/POS Profile\"] = [\n\t{\n\t\tlabel: \"Point of Sale Profile\",\n\t\turl: docsUrl + \"user/manual/en/accounts/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/POS Profile\"] = [\n\t{\n\t\tlabel: \"POS Profile\",\n\t\turl: docsUrl + \"user/manual/en/accounts/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Invoice\"] = [\n\t{\n\t\tlabel: \"Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/purchase-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Journal Entry\"] = [\n\t{\n\t\tlabel: \"Journal Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/journal-entry\",\n\t},\n\t{\n\t\tlabel: \"Advance Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/advance-payment-entry\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balance\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Entry\"] = [\n\t{\n\t\tlabel: \"Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/payment-entry\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Request\"] = [\n\t{\n\t\tlabel: \"Payment Request\",\n\t\turl: docsUrl + \"user/manual/en/accounts/payment-request\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset\"] = [\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset Category\"] = [\n\t{\n\t\tlabel: \"Asset Category\",\n\t\turl: docsUrl + \"user/manual/en/asset/asset-category\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Cost Center\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/accounts/budgeting\" },\n];\n\n//Stock\n\nfrappe.help.help_links[\"List/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/stock/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/accounts/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/articles/item-valuation-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/stock/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/accounts/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/item/item-valuation-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Receipt\"] = [\n\t{\n\t\tlabel: \"Purchase Receipt\",\n\t\turl: docsUrl + \"user/manual/en/stock/purchase-receipt\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Installation Note\"] = [\n\t{\n\t\tlabel: \"Installation Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/installation-note\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Budget\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/accounts/budgeting\" },\n];\n\nfrappe.help.help_links[\"List/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/articles/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/articles/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock/stock-entry\" },\n\t{\n\t\tlabel: \"Stock Entry Types\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/stock-entry-purpose\",\n\t},\n\t{\n\t\tlabel: \"Repack Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/repack-entry\",\n\t},\n\t{\n\t\tlabel: \"Opening Stock\",\n\t\turl: docsUrl + \"user/manual/en/stock/opening-stock\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock/stock-entry\" },\n];\n\nfrappe.help.help_links[\"Tree/Warehouse\"] = [\n\t{ label: \"Warehouse\", url: docsUrl + \"user/manual/en/stock/warehouse\" },\n];\n\nfrappe.help.help_links[\"List/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/stock/serial-no\" },\n];\n\nfrappe.help.help_links[\"Form/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/stock/serial-no\" },\n];\n\nfrappe.help.help_links[\"List/Batch\"] = [\n\t{ label: \"Batch\", url: docsUrl + \"user/manual/en/stock/batch\" },\n];\n\nfrappe.help.help_links[\"Form/Batch\"] = [\n\t{ label: \"Batch\", url: docsUrl + \"user/manual/en/stock/batch\" },\n];\n\nfrappe.help.help_links[\"Form/Packing Slip\"] = [\n\t{\n\t\tlabel: \"Packing Slip\",\n\t\turl: docsUrl + \"user/manual/en/stock/packing-slip\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Quality Inspection\"] = [\n\t{\n\t\tlabel: \"Quality Inspection\",\n\t\turl: docsUrl + \"user/manual/en/stock/quality-inspection\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Landed Cost Voucher\"] = [\n\t{\n\t\tlabel: \"Landed Cost Voucher\",\n\t\turl: docsUrl + \"user/manual/en/stock/landed-cost-voucher\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Item Group\"] = [\n\t{\n\t\tlabel: \"Item Group\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-group\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item Attribute\"] = [\n\t{\n\t\tlabel: \"Item Attribute\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-attribute\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/UOM\"] = [\n\t{\n\t\tlabel: \"Fractions in UOM\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/managing-fractions-in-uom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Opening Stock Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock/stock-reconciliation\",\n\t},\n];\n\n//CRM\n\nfrappe.help.help_links[\"Form/Lead\"] = [\n\t{ label: \"Lead\", url: docsUrl + \"user/manual/en/CRM/lead\" },\n];\n\nfrappe.help.help_links[\"Form/Opportunity\"] = [\n\t{ label: \"Opportunity\", url: docsUrl + \"user/manual/en/CRM/opportunity\" },\n];\n\nfrappe.help.help_links[\"Form/Address\"] = [\n\t{ label: \"Address\", url: docsUrl + \"user/manual/en/CRM/address\" },\n];\n\nfrappe.help.help_links[\"Form/Contact\"] = [\n\t{ label: \"Contact\", url: docsUrl + \"user/manual/en/CRM/contact\" },\n];\n\nfrappe.help.help_links[\"Form/Newsletter\"] = [\n\t{ label: \"Newsletter\", url: docsUrl + \"user/manual/en/CRM/newsletter\" },\n];\n\nfrappe.help.help_links[\"Form/Campaign\"] = [\n\t{ label: \"Campaign\", url: docsUrl + \"user/manual/en/CRM/campaign\" },\n];\n\nfrappe.help.help_links[\"Tree/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/CRM/sales-person\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person Target\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/sales-person-target-allocation\",\n\t},\n\t{\n\t\tlabel: \"Sales Person in Transactions\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n];\n\n//Manufacturing\n\nfrappe.help.help_links[\"Form/BOM\"] = [\n\t{\n\t\tlabel: \"Bill of Material\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/bill-of-materials\",\n\t},\n\t{\n\t\tlabel: \"Nested BOM Structure\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/manufacturing/articles/managing-multi-level-bom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Work Order\"] = [\n\t{\n\t\tlabel: \"Work Order\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/work-order\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Workstation\"] = [\n\t{\n\t\tlabel: \"Workstation\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/workstation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Operation\"] = [\n\t{\n\t\tlabel: \"Operation\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/operation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/BOM Update Tool\"] = [\n\t{\n\t\tlabel: \"BOM Update Tool\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/bom-update-tool\",\n\t},\n];\n\n//Customize\n\nfrappe.help.help_links[\"Form/Customize Form\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n\t{\n\t\tlabel: \"Customize Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/customize-form\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n];\n", "frappe.provide('agriculture');\n\nagriculture.TernaryPlot = class TernaryPlot {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\n\t\tfrappe.require('assets/frappe/js/lib/snap.svg-min.js', () => {\n\t\t\tthis.make_svg();\n\t\t\tthis.init_snap();\n\t\t\tthis.init_config();\n\t\t\tthis.make_plot();\n\t\t\tthis.make_plot_marking();\n\t\t\tthis.make_legend();\n\t\t\tthis.mark_blip();\n\t\t});\n\t}\n\n\tmake_svg() {\n\t\tthis.$svg = $('<svg height=\"350\" width=\"400\">');\n\t\t$(this.parent).append(this.$svg);\n\t}\n\n\tinit_snap() {\n\t\tthis.paper = new Snap(this.$svg.get(0));\n\t}\n\n\tinit_config() {\n\t\tthis.config = {\n\t\t\ttriangle_side: 300,\n\t\t\tspacing: 50,\n\t\t\tstrokeWidth: 1,\n\t\t\tstroke: frappe.ui.color.get('black')\n\t\t};\n\t\tthis.config.scaling_factor = this.config.triangle_side / 100;\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tthis.coords = {\n\t\t\tsand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('peach')\n\t\t\t},\n\t\t\tloamy_sand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + 10 * p * Snap.cos(60), s + (100 - 10) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 85) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 70) * p, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink')\n\t\t\t},\n\t\t\tsandy_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 75) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'light')\n\t\t\t},\n\t\t\tloam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60) - 22.5 * p, s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('brown')\n\t\t\t},\n\t\t\tsilt_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'dark')\n\t\t\t},\n\t\t\tsilt: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green')\n\t\t\t},\n\t\t\tsilty_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan', 'dark')\n\t\t\t},\n\t\t\tsilty_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan')\n\t\t\t},\n\t\t\tclay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'light')\n\t\t\t},\n\t\t\tsandy_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'dark')\n\t\t\t},\n\t\t\tsandy_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('red')\n\t\t\t},\n\t\t\tclay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('yellow')\n\t\t\t},\n\t\t};\n\t}\n\n\tget_coords(soil_type) {\n\t\treturn this.coords[soil_type].points;\n\t}\n\n\tget_color(soil_type) {\n\t\treturn this.coords[soil_type].color;\n\t}\n\n\tmake_plot() {\n\t\tfor (let soil_type in this.coords) {\n\t\t\tthis.paper.polygon(this.get_coords(soil_type)).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: this.config.stroke,\n\t\t\t\tstrokeWidth: this.config.strokeWidth\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_plot_marking() {\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tlet clay = this.paper.text(t * Snap.cos(60) / 2, s + t * Snap.cos(30) / 2, __(\"Clay\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tclay.transform(\"r300\");\n\n\t\tlet silt = this.paper.text(t, s + t * Snap.cos(30) / 2, __(\"Silt\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsilt.transform(\"r60\");\n\n\t\tlet sand = this.paper.text(35 + t * Snap.cos(60), 90 + t * Snap.cos(30), __(\"Sand\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsand.transform(\"r0\");\n\t}\n\n\tmake_legend() {\n\t\t// let side = len(this.coords)/2;\n\t\tlet index = 1;\n\t\tlet offset = 0;\n\t\tlet exec_once = true;\n\t\tfor (let soil_type in this.coords) {\n\t\t\tif (index > 6 && exec_once){\n\t\t\t\toffset = 300;\n\t\t\t\tindex = 1;\n\t\t\t\texec_once = false;\n\t\t\t}\n\t\t\tlet rect = this.paper.rect(0+offset, 0+index*20, 100, 19, 5, 5).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: frappe.ui.color.get('black')\n\t\t\t});\n\t\t\tlet text = this.paper.text(5+offset, 16+index*20, soil_type).attr({\n\t\t\t\tfill: frappe.ui.color.get('black'),\n\t\t\t\t'font-size': 12\n\t\t\t});\n\t\t\tindex++;\n\t\t}\n\t}\n\n\tmark_blip({clay, sand, silt} = this) {\n\t\tif (clay + sand + silt != 0){\n\t\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\t\tlet x_blip = s + clay * p * Snap.cos(60) + silt * p;\n\t\t\tlet y_blip = s + silt * p * Snap.cos(30) + sand * p * Snap.sin(60);\n\t\t\tthis.blip = this.paper.circle(x_blip, y_blip, 4).attr({\n\t\t\t\tfill: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstroke: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstrokeWidth: 2\n\t\t\t});\n\t\t}\n\t}\n\n\tremove_blip() {\n\t\tif (typeof this.blip !== 'undefined')\n\t\t\tthis.blip.remove();\n\t}\n};\n", "\n\tfrappe.templates['item_quick_entry'] = `<div class=\"h6 uppercase\" style=\"margin-top: 30px;\">{{ __(\"Variant Attributes\") }}</div>\n<div class=\"attributes hide-control\">\n</div>\n`;\n", "frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.ItemQuickEntryForm = class ItemQuickEntryForm extends frappe.ui.form.QuickEntryForm {\n\tconstructor(doctype, after_insert) {\n\t\tsuper(doctype, after_insert);\n\t}\n\n\trender_dialog() {\n\t\tthis.mandatory = this.get_variant_fields().concat(this.mandatory);\n\t\tthis.mandatory = this.mandatory.concat(this.get_attributes_fields());\n\t\tthis.check_naming_series_based_on();\n\t\tsuper.render_dialog();\n\t\tthis.init_post_render_dialog_operations();\n\t\tthis.preset_fields_for_template();\n\t\tthis.dialog.$wrapper.find('.edit-full').text(__('Edit in full page for more options like assets, serial nos, batches etc.'))\n\t}\n\n\tcheck_naming_series_based_on() {\n\t\tif (frappe.defaults.get_default(\"item_naming_by\") === \"Naming Series\") {\n\t\t\tthis.mandatory = this.mandatory.filter(d => d.fieldname !== \"item_code\");\n\t\t}\n\t}\n\n\tinit_post_render_dialog_operations() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.append(frappe.render_template(\"item_quick_entry\"));\n\t\tthis.init_for_create_variant_trigger();\n\t\tthis.init_for_item_template_trigger();\n\t\t// explicitly hide manufacturing fields as hidden not working.\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.get_field(\"item_template\").df.hidden = 1;\n\t\tthis.dialog.get_field(\"item_template\").refresh();\n\t}\n\n\tregister_primary_action() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif (me.dialog.working) return;\n\n\t\t\tvar data = me.dialog.get_values();\n\t\t\tvar variant_values = {};\n\n\t\t\tif (me.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\t\tvariant_values = me.get_variant_doc();\n\t\t\t\tif (!Object.keys(variant_values).length) {\n\t\t\t\t\tdata = null;\n\t\t\t\t}\n\t\t\t\tvariant_values.stock_uom = me.template_doc.stock_uom;\n\t\t\t\tvariant_values.item_group = me.template_doc.item_group;\n\t\t\t}\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tvar values = me.update_doc();\n\t\t\t\t//patch for manufacturer type variants as extend is overwriting it.\n\t\t\t\tif (variant_values['variant_based_on'] == \"Manufacturer\") {\n\t\t\t\t\tvalues['variant_based_on'] = \"Manufacturer\";\n\t\t\t\t}\n\t\t\t\t$.extend(variant_values, values);\n\t\t\t\tme.insert(variant_values);\n\t\t\t}\n\t\t});\n\t}\n\n\tinsert(variant_values) {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: variant_values\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t}\n\n\topen_doc() {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (this.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\tvar template = this.dialog.fields_dict.item_template.input.value;\n\t\t\tif (template)\n\t\t\t\tfrappe.set_route(\"Form\", this.doctype, template);\n\t\t} else {\n\t\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t\t}\n\t}\n\n\tget_variant_fields() {\n\t\tvar variant_fields = [{\n\t\t\tfieldname: \"create_variant\",\n\t\t\tfieldtype: \"Check\",\n\t\t\tlabel: __(\"Create Variant\")\n\t\t},\n\t\t{\n\t\t\tfieldname: 'item_template',\n\t\t\tlabel: __('Item Template'),\n\t\t\treqd: 0,\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: \"Item\",\n\t\t\tget_query: function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"has_variants\": 1\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}];\n\n\t\treturn variant_fields;\n\t}\n\n\tget_manufacturing_fields() {\n\t\tthis.manufacturer_fields = [{\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Manufacturer',\n\t\t\tlabel: 'Manufacturer',\n\t\t\tfieldname: \"manufacturer\",\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}, {\n\t\t\tfieldtype: 'Data',\n\t\t\tlabel: 'Manufacturer Part Number',\n\t\t\tfieldname: 'manufacturer_part_no',\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}];\n\t\treturn this.manufacturer_fields;\n\t}\n\n\tget_attributes_fields() {\n\t\tvar attribute_fields = [{\n\t\t\tfieldname: 'attribute_html',\n\t\t\tfieldtype: 'HTML'\n\t\t}]\n\n\t\tattribute_fields = attribute_fields.concat(this.get_manufacturing_fields());\n\t\treturn attribute_fields;\n\t}\n\n\tinit_for_create_variant_trigger() {\n\t\tvar me = this;\n\n\t\tthis.dialog.fields_dict.create_variant.$input.on(\"click\", function() {\n\t\t\tme.preset_fields_for_template();\n\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t});\n\t}\n\n\tpreset_fields_for_template() {\n\t\tvar for_variant = this.dialog.get_value('create_variant');\n\n\t\t// setup template field, seen and mandatory if variant\n\t\tlet template_field = this.dialog.get_field(\"item_template\");\n\t\ttemplate_field.df.reqd = for_variant;\n\t\ttemplate_field.set_value('');\n\t\ttemplate_field.df.hidden = !for_variant;\n\t\ttemplate_field.refresh();\n\n\t\t// hide properties for variant\n\t\t['item_code', 'item_name', 'item_group', 'stock_uom'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.hidden = for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t\tthis.dialog.get_field('attribute_html').toggle(false);\n\n\t\t// non mandatory for variants\n\t\t['item_code', 'stock_uom', 'item_group'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.reqd = !for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t}\n\n\tinit_for_item_template_trigger() {\n\t\tvar me = this;\n\n\t\tme.dialog.fields_dict[\"item_template\"].df.onchange = () => {\n\t\t\tvar template = me.dialog.fields_dict.item_template.input.value;\n\t\t\tme.template_doc = null;\n\t\t\tif (template) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\t\tname: template\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tme.template_doc = r.message;\n\t\t\t\t\t\tme.is_manufacturer = false;\n\n\t\t\t\t\t\tif (me.template_doc.variant_based_on === \"Manufacturer\") {\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(true, [], true);\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(false, me.template_doc.attributes, false);\n\t\t\t\t\t\t\tme.render_attributes(me.template_doc.attributes);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.dialog.get_field('attribute_html').toggle(false);\n\t\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t\t}\n\t\t}\n\t}\n\n\tinit_post_template_trigger_operations(is_manufacturer, attributes, attributes_flag) {\n\t\tthis.attributes = attributes;\n\t\tthis.attribute_values = {};\n\t\tthis.attributes_count = attributes.length;\n\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.is_manufacturer = is_manufacturer;\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").toggleClass(\"hide-control\", attributes_flag);\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes-header\").toggleClass(\"hide-control\", attributes_flag);\n\t}\n\n\ttoggle_manufacturer_fields() {\n\t\tvar me = this;\n\t\t$.each(this.manufacturer_fields, function(i, dialog_field) {\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.hidden = !me.is_manufacturer;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.reqd = dialog_field.fieldname == 'manufacturer' ? me.is_manufacturer : false;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).refresh();\n\t\t});\n\t}\n\n\tinitiate_render_attributes() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.render_attributes(this.attributes);\n\t}\n\n\trender_attributes(attributes) {\n\t\tvar me = this;\n\n\t\tthis.dialog.get_field('attribute_html').toggle(true);\n\n\t\t$.each(attributes, function(index, row) {\n\t\t\tvar desc = \"\";\n\t\t\tvar fieldtype = \"Data\";\n\t\t\tif (row.numeric_values) {\n\t\t\t\tfieldtype = \"Float\";\n\t\t\t\tdesc = \"Min Value: \" + row.from_range + \" , Max Value: \" + row.to_range + \", in Increments of: \" + row.increment;\n\t\t\t}\n\n\t\t\tme.init_make_control(fieldtype, row);\n\t\t\tme[row.attribute].set_value(me.attribute_values[row.attribute] || \"\");\n\t\t\tme[row.attribute].$wrapper.toggleClass(\"has-error\", me.attribute_values[row.attribute] ? false : true);\n\n\t\t\t// Set Label explicitly as make_control is not displaying label\n\t\t\t$(me[row.attribute].label_area).text(__(row.attribute));\n\n\t\t\tif (desc) {\n\t\t\t\t$(repl(`<p class=\"help-box small text-muted hidden-xs\">%(desc)s</p>`, {\n\t\t\t\t\t\"desc\": desc\n\t\t\t\t})).insertAfter(me[row.attribute].input_area);\n\t\t\t}\n\n\t\t\tif (!row.numeric_values) {\n\t\t\t\tme.init_awesomplete_for_attribute(row);\n\t\t\t} else {\n\t\t\t\tme[row.attribute].$input.on(\"change\", function() {\n\t\t\t\t\tme.attribute_values[row.attribute] = $(this).val();\n\t\t\t\t\t$(this).closest(\".frappe-control\").toggleClass(\"has-error\", $(this).val() ? false : true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_make_control(fieldtype, row) {\n\t\tthis[row.attribute] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\t\"fieldtype\": fieldtype,\n\t\t\t\t\"label\": row.attribute,\n\t\t\t\t\"fieldname\": row.attribute,\n\t\t\t\t\"options\": row.options || \"\"\n\t\t\t},\n\t\t\tparent: $(this.dialog.fields_dict.attribute_html.wrapper).find(\".attributes\"),\n\t\t\tonly_input: false\n\t\t});\n\t\tthis[row.attribute].make_input();\n\t}\n\n\tinit_awesomplete_for_attribute(row) {\n\t\tvar me = this;\n\n\t\tthis[row.attribute].input.awesomplete = new Awesomplete(this[row.attribute].input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: [],\n\t\t});\n\n\t\tthis[row.attribute].$input.on('input', function(e) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Item Attribute Value\",\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t[\"parent\", \"=\", $(e.target).attr(\"data-fieldname\")],\n\t\t\t\t\t\t[\"attribute_value\", \"like\", e.target.value + \"%\"]\n\t\t\t\t\t],\n\t\t\t\t\tfields: [\"attribute_value\"],\n\t\t\t\t\tparent: \"Item Attribute\"\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\te.target.awesomplete.list = r.message.map(function(d) {\n\t\t\t\t\t\t\treturn d.attribute_value;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}).on('focus', function(e) {\n\t\t\t$(e.target).val('').trigger('input');\n\t\t}).on(\"awesomplete-close\", function (e) {\n\t\t\tme.attribute_values[$(e.target).attr(\"data-fieldname\")] = e.target.value;\n\t\t\t$(e.target).closest(\".frappe-control\").toggleClass(\"has-error\", e.target.value ? false : true);\n\t\t});\n\t}\n\n\tget_variant_doc() {\n\t\tvar me = this;\n\t\tvar variant_doc = {};\n\t\tvar attribute = this.validate_mandatory_attributes();\n\n\t\tif (Object.keys(attribute).length) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.item_variant.create_variant_doc_for_quick_entry\",\n\t\t\t\targs: {\n\t\t\t\t\t\"template\": me.dialog.fields_dict.item_template.$input.val(),\n\t\t\t\t\targs: attribute\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (Object.prototype.toString.call(r.message) == \"[object Object]\") {\n\t\t\t\t\t\tvariant_doc = r.message;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar msgprint_dialog = frappe.msgprint(__(\"Item Variant {0} already exists with same attributes\", [repl('<a class=\"strong variant-click\" data-item-code=\"%(item)s\" \\\n\t\t\t\t\t\t\t\t>%(item)s</a>', {\n\t\t\t\t\t\t\t\titem: r.message\n\t\t\t\t\t\t\t})]));\n\n\t\t\t\t\t\tmsgprint_dialog.$wrapper.find(\".variant-click\").on(\"click\", function() {\n\t\t\t\t\t\t\tmsgprint_dialog.hide();\n\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\t\tfrappe._from_link.set_value($(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.set_route('Form', \"Item\", $(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\treturn variant_doc;\n\t}\n\n\tvalidate_mandatory_attributes() {\n\t\tvar me = this;\n\t\tvar attribute = {};\n\t\tvar mandatory = [];\n\n\t\t$.each(this.attributes, function(index, attr) {\n\t\t\tvar value = me.attribute_values[attr.attribute] || \"\";\n\t\t\tif (value) {\n\t\t\t\tattribute[attr.attribute] = attr.numeric_values ? flt(value) : value;\n\t\t\t} else {\n\t\t\t\tmandatory.push(attr.attribute);\n\t\t\t}\n\t\t})\n\n\t\tif (this.is_manufacturer) {\n\t\t\t$.each(this.manufacturer_fields, function(index, field) {\n\t\t\t\tattribute[field.fieldname] = me.dialog.fields_dict[field.fieldname].input.value;\n\t\t\t});\n\t\t}\n\t\treturn attribute;\n\t}\n};\n", "frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.CustomerQuickEntryForm = class CustomerQuickEntryForm extends frappe.ui.form.QuickEntryForm {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tsuper(doctype, after_insert, init_callback, doc, force);\n\t\tthis.skip_redirect_on_error = true;\n\t}\n\n\trender_dialog() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tsuper.render_dialog();\n\t}\n\n\tget_variant_fields() {\n\t\tvar variant_fields = [{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Email Id\"),\n\t\t\tfieldname: \"email_id\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\tfieldname: \"mobile_no\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\tfieldname: \"address_line1\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\tfieldname: \"address_line2\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\tfieldname: \"pincode\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"City\"),\n\t\t\tfieldname: \"city\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"State\"),\n\t\t\tfieldname: \"state\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Country\"),\n\t\t\tfieldname: \"country\",\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Country\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\tfieldname: \"customer_pos_id\",\n\t\t\tfieldtype: \"Data\",\n\t\t\thidden: 1\n\t\t}];\n\n\t\treturn variant_fields;\n\t}\n}\n", "frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.SupplierQuickEntryForm = class SupplierQuickEntryForm extends frappe.ui.form.QuickEntryForm {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tsuper(doctype, after_insert, init_callback, doc, force);\n\t\tthis.skip_redirect_on_error = true;\n\t}\n\n\trender_dialog() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tsuper.render_dialog();\n\t}\n\n\tget_variant_fields() {\n\t\tvar variant_fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\t\tcollapsible: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Email Id\"),\n\t\t\t\tfieldname: \"email_id\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\t\tfieldname: \"mobile_no\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\t\tcollapsible: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\t\tfieldname: \"address_line1\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\t\tfieldname: \"address_line2\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\t\tfieldname: \"pincode\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"City\"),\n\t\t\t\tfieldname: \"city\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"State\"),\n\t\t\t\tfieldname: \"state\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Country\"),\n\t\t\t\tfieldname: \"country\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Country\"\n\t\t\t}\n\t\t];\n\n\t\treturn variant_fields;\n\t}\n};\n", "class CallPopup {\n\tconstructor(call_log) {\n\t\tthis.caller_number = call_log.from;\n\t\tthis.call_log = call_log;\n\t\tthis.setup_listener();\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tfrappe.utils.play_sound('incoming-call');\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\t'static': true,\n\t\t\t'minimizable': true\n\t\t});\n\t\tthis.dialog.get_close_btn().show();\n\t\tthis.setup_dialog();\n\t\tthis.set_call_status();\n\t\tfrappe.utils.bind_actions_with_object(this.dialog.$body, this);\n\t\tthis.dialog.$wrapper.addClass('call-popup');\n\t\tthis.dialog.get_close_btn().unbind('click').click(this.close_modal.bind(this));\n\t\tthis.dialog.show();\n\t}\n\n\tsetup_dialog() {\n\t\tthis.setup_call_details();\n\t\tthis.dialog.$body.empty().append(this.caller_info);\n\t}\n\n\tset_indicator(color, blink=false) {\n\t\tlet classes = `indicator ${color} ${blink ? 'blink': ''}`;\n\t\tthis.dialog.header.find('.indicator').attr('class', classes);\n\t}\n\n\tset_call_status(call_status) {\n\t\tlet title = '';\n\t\tcall_status = call_status || this.call_log.status;\n\t\tif (['Ringing'].includes(call_status) || !call_status) {\n\t\t\ttitle = __('Incoming call from {0}', [this.get_caller_name() || this.caller_number]);\n\t\t\tthis.set_indicator('blue', true);\n\t\t} else if (call_status === 'In Progress') {\n\t\t\ttitle = __('Call Connected');\n\t\t\tthis.set_indicator('green');\n\t\t} else if (['No Answer', 'Missed'].includes(call_status)) {\n\t\t\tthis.set_indicator('yellow');\n\t\t\ttitle = __('Call Missed');\n\t\t} else if (['Completed', 'Busy', 'Failed'].includes(call_status)) {\n\t\t\tthis.set_indicator('red');\n\t\t\ttitle = __('Call Ended');\n\t\t} else {\n\t\t\tthis.set_indicator('blue');\n\t\t\ttitle = call_status;\n\t\t}\n\t\tthis.dialog.set_title(title);\n\t}\n\n\tupdate_call_log(call_log, missed) {\n\t\tthis.call_log = call_log;\n\t\tthis.set_call_status(missed ? 'Missed': null);\n\t}\n\n\tclose_modal() {\n\t\tthis.dialog.hide();\n\t\tdelete erpnext.call_popup;\n\t}\n\n\tcall_ended(call_log, missed) {\n\t\tfrappe.utils.play_sound('call-disconnect');\n\t\tthis.update_call_log(call_log, missed);\n\t\tsetTimeout(() => {\n\t\t\tif (!this.dialog.get_value('call_summary')) {\n\t\t\t\tthis.close_modal();\n\t\t\t}\n\t\t}, 60000);\n\t\tthis.clear_listeners();\n\t}\n\n\tget_caller_name() {\n\t\tconst contact_link = this.get_contact_link();\n\t\treturn contact_link.link_title || contact_link.link_name;\n\t}\n\n\tget_contact_link() {\n\t\tlet log = this.call_log;\n\t\tlet contact_link = log.links.find(d => d.link_doctype === 'Contact');\n\t\treturn contact_link || {};\n\t}\n\n\tsetup_listener() {\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_ended`, call_log => {\n\t\t\tthis.call_ended(call_log);\n\t\t});\n\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_missed`, call_log => {\n\t\t\tthis.call_ended(call_log, true);\n\t\t});\n\t}\n\n\tclear_listeners() {\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_ended`);\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_missed`);\n\t}\n\n\tsetup_call_details() {\n\t\tthis.caller_info = $(`<div></div>`);\n\t\tthis.call_details = new frappe.ui.FieldGroup({\n\t\t\tfields: [{\n\t\t\t\t'fieldname': 'name',\n\t\t\t\t'label': 'Name',\n\t\t\t\t'default': this.get_caller_name() || __('Unknown Caller'),\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Open Contact'),\n\t\t\t\t'click': () => frappe.set_route('Form', 'Contact', this.get_contact_link().link_name),\n\t\t\t\t'depends_on': () => this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Contact'),\n\t\t\t\t'click': this.create_new_contact.bind(this),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Customer'),\n\t\t\t\t'click': this.create_new_customer.bind(this),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Lead'),\n\t\t\t\t'click': () => frappe.new_doc('Lead', { 'mobile_no': this.caller_number }),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Column Break',\n\t\t\t}, {\n\t\t\t\t'fieldname': 'number',\n\t\t\t\t'label': 'Phone Number',\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'default': this.caller_number,\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t\t'hide_border': 1,\n\t\t\t}, {\n\t\t\t\t'fieldname': 'call_type',\n\t\t\t\t'label': 'Call Type',\n\t\t\t\t'fieldtype': 'Link',\n\t\t\t\t'options': 'Telephony Call Type',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t\t'hide_border': 1,\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Call Summary'),\n\t\t\t\t'fieldname': 'call_summary',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Save'),\n\t\t\t\t'click': () => {\n\t\t\t\t\tconst call_summary = this.call_details.get_value('call_summary');\n\t\t\t\t\tconst call_type = this.call_details.get_value('call_type');\n\t\t\t\t\tif (!call_summary) return;\n\t\t\t\t\tfrappe.xcall('erpnext.telephony.doctype.call_log.call_log.add_call_summary_and_call_type', {\n\t\t\t\t\t\t'call_log': this.call_log.name,\n\t\t\t\t\t\t'summary': call_summary,\n\t\t\t\t\t\t'call_type': call_type,\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.close_modal();\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: `\n\t\t\t\t\t\t\t\t${__('Call Summary Saved')}\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclass=\"text-small text-muted\"\n\t\t\t\t\t\t\t\t\thref=\"/app/call-log/${this.call_log.name}\">\n\t\t\t\t\t\t\t\t\t${__('View call log')}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}],\n\t\t\tbody: this.caller_info\n\t\t});\n\t\tthis.call_details.make();\n\t}\n\n\tis_known_caller() {\n\t\treturn Boolean(this.get_caller_name());\n\t}\n\n\tcreate_new_customer() {\n\t\t// to avoid quick entry form\n\t\tconst new_customer = frappe.model.get_new_doc('Customer');\n\t\tnew_customer.mobile_no = this.caller_number;\n\t\tfrappe.set_route('Form', new_customer.doctype, new_customer.name);\n\t}\n\n\tcreate_new_contact() {\n\t\t// TODO: fix new_doc, it should accept child table values\n\t\tconst new_contact = frappe.model.get_new_doc('Contact');\n\t\tconst phone_no = frappe.model.add_child(new_contact, 'Contact Phone', 'phone_nos');\n\t\tphone_no.phone = this.caller_number;\n\t\tphone_no.is_primary_mobile_no = 1;\n\t\tfrappe.set_route('Form', new_contact.doctype, new_contact.name);\n\t}\n}\n\n$(document).on('app_ready', function () {\n\tfrappe.realtime.on('show_call_popup', call_log => {\n\t\tlet call_popup = erpnext.call_popup;\n\t\tif (call_popup && call_log.name === call_popup.call_log.name) {\n\t\t\tcall_popup.update_call_log(call_log);\n\t\t\tcall_popup.dialog.show();\n\t\t} else {\n\t\t\terpnext.call_popup = new CallPopup(call_log);\n\t\t}\n\t});\n});\n\nwindow.CallPopup = CallPopup;\n", "frappe.provide('erpnext.accounts');\n\nerpnext.accounts.dimensions = {\n\tsetup_dimension_filters(frm, doctype) {\n\t\tthis.accounting_dimensions = [];\n\t\tthis.default_dimensions = {};\n\t\tthis.fetch_custom_dimensions(frm, doctype);\n\t},\n\n\tfetch_custom_dimensions(frm, doctype) {\n\t\tlet me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\targs: {\n\t\t\t\t'with_cost_center_and_project': true\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.accounting_dimensions = r.message[0];\n\t\t\t\tme.default_dimensions = r.message[1];\n\t\t\t\tme.setup_filters(frm, doctype);\n\t\t\t}\n\t\t});\n\t},\n\n\tsetup_filters(frm, doctype) {\n\t\tif (this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tfrappe.model.with_doctype(dimension['document_type'], () => {\n\t\t\t\t\tlet parent_fields = [];\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\t\tif (df.fieldtype === 'Link' && df.options === 'Account') {\n\t\t\t\t\t\t\tparent_fields.push(df.fieldname);\n\t\t\t\t\t\t} else if (df.fieldtype === 'Table') {\n\t\t\t\t\t\t\tthis.setup_child_filters(frm, df.options, df.fieldname, dimension['fieldname']);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension['fieldname'])) {\n\t\t\t\t\t\t\tthis.setup_account_filters(frm, dimension['fieldname'], parent_fields);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_child_filters(frm, doctype, parentfield, dimension) {\n\t\tlet fields = [];\n\n\t\tif (frappe.meta.has_field(doctype, dimension)) {\n\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\tif (df.fieldtype === 'Link' && df.options === 'Account') {\n\t\t\t\t\t\tfields.push(df.fieldname);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrm.set_query(dimension, parentfield, function(doc, cdt, cdn) {\n\t\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\t\treturn erpnext.queries.get_filtered_dimensions(row, fields, dimension, doc.company);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_account_filters(frm, dimension, fields) {\n\t\tfrm.set_query(dimension, function(doc) {\n\t\t\treturn erpnext.queries.get_filtered_dimensions(doc, fields, dimension, doc.company);\n\t\t});\n\t},\n\n\tupdate_dimension(frm, doctype) {\n\t\tif (this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tif (frm.is_new()) {\n\t\t\t\t\tif (frm.doc.company && Object.keys(this.default_dimensions || {}).length > 0\n\t\t\t\t\t\t&& this.default_dimensions[frm.doc.company]) {\n\n\t\t\t\t\t\tlet default_dimension = this.default_dimensions[frm.doc.company][dimension['fieldname']];\n\n\t\t\t\t\t\tif (default_dimension) {\n\t\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension['fieldname'])) {\n\t\t\t\t\t\t\t\tfrm.set_value(dimension['fieldname'], default_dimension);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$.each(frm.doc.items || frm.doc.accounts || [], function(i, row) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, dimension['fieldname'], default_dimension);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcopy_dimension_from_first_row(frm, cdt, cdn, fieldname) {\n\t\tif (frappe.meta.has_field(frm.doctype, fieldname) && this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tlet row = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrm.script_manager.copy_from_first_row(fieldname, row, [dimension['fieldname']]);\n\t\t\t});\n\t\t}\n\t}\n};\n", "erpnext.utils.BarcodeScanner = class BarcodeScanner {\n\tconstructor(opts) {\n\t\tthis.frm = opts.frm;\n\n\t\t// field from which to capture input of scanned data\n\t\tthis.scan_field_name = opts.scan_field_name || \"scan_barcode\";\n\t\tthis.scan_barcode_field = this.frm.fields_dict[this.scan_field_name];\n\n\t\tthis.barcode_field = opts.barcode_field || \"barcode\";\n\t\tthis.serial_no_field = opts.serial_no_field || \"serial_no\";\n\t\tthis.batch_no_field = opts.batch_no_field || \"batch_no\";\n\t\tthis.uom_field = opts.uom_field || \"uom\";\n\t\tthis.qty_field = opts.qty_field || \"qty\";\n\t\t// field name on row which defines max quantity to be scanned e.g. picklist\n\t\tthis.max_qty_field = opts.max_qty_field;\n\t\t// scanner won't add a new row if this flag is set.\n\t\tthis.dont_allow_new_row = opts.dont_allow_new_row;\n\t\t// scanner will ask user to type the quantity instead of incrementing by 1\n\t\tthis.prompt_qty = opts.prompt_qty;\n\n\t\tthis.items_table_name = opts.items_table_name || \"items\";\n\t\tthis.items_table = this.frm.doc[this.items_table_name];\n\n\t\t// optional sound name to play when scan either fails or passes.\n\t\t// see https://frappeframework.com/docs/v14/user/en/python-api/hooks#sounds\n\t\tthis.success_sound = opts.play_success_sound;\n\t\tthis.fail_sound = opts.play_fail_sound;\n\n\t\t// any API that takes `search_value` as input and returns dictionary as follows\n\t\t// {\n\t\t//     item_code: \"HORSESHOE\", // present if any item was found\n\t\t//     bar_code: \"123456\", // present if barcode was scanned\n\t\t//     batch_no: \"LOT12\", // present if batch was scanned\n\t\t//     serial_no: \"987XYZ\", // present if serial no was scanned\n\t\t//     uom: \"Kg\", // present if barcode UOM is different from default\n\t\t// }\n\t\tthis.scan_api = opts.scan_api || \"erpnext.stock.utils.scan_barcode\";\n\t}\n\n\tprocess_scan() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet me = this;\n\n\t\t\tconst input = this.scan_barcode_field.value;\n\t\t\tthis.scan_barcode_field.set_value(\"\");\n\t\t\tif (!input) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.scan_api_call(input, (r) => {\n\t\t\t\tconst data = r && r.message;\n\t\t\t\tif (!data || Object.keys(data).length === 0) {\n\t\t\t\t\tthis.show_alert(__(\"Cannot find Item with this Barcode\"), \"red\");\n\t\t\t\t\tthis.clean_up();\n\t\t\t\t\tthis.play_fail_sound();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.update_table(data).then(row => {\n\t\t\t\t\tthis.play_success_sound();\n\t\t\t\t\tresolve(row);\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.play_fail_sound();\n\t\t\t\t\treject();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tscan_api_call(input, callback) {\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: this.scan_api,\n\t\t\t\targs: {\n\t\t\t\t\tsearch_value: input,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tcallback(r);\n\t\t\t});\n\t}\n\n\tupdate_table(data) {\n\t\treturn new Promise(resolve => {\n\t\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\n\t\t\tconst {item_code, barcode, batch_no, serial_no, uom} = data;\n\n\t\t\tlet row = this.get_row_to_modify_on_scan(item_code, batch_no, uom, barcode);\n\n\t\t\tthis.is_new_row = false;\n\t\t\tif (!row) {\n\t\t\t\tif (this.dont_allow_new_row) {\n\t\t\t\t\tthis.show_alert(__(\"Maximum quantity scanned for item {0}.\", [item_code]), \"red\");\n\t\t\t\t\tthis.clean_up();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.is_new_row = true;\n\n\t\t\t\t// add new row if new item/batch is scanned\n\t\t\t\trow = frappe.model.add_child(this.frm.doc, cur_grid.doctype, this.items_table_name);\n\t\t\t\t// trigger any row add triggers defined on child table.\n\t\t\t\tthis.frm.script_manager.trigger(`${this.items_table_name}_add`, row.doctype, row.name);\n\t\t\t\tthis.frm.has_items = false;\n\t\t\t}\n\n\t\t\tif (this.is_duplicate_serial_no(row, serial_no)) {\n\t\t\t\tthis.clean_up();\n\t\t\t\treject();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.set_selector_trigger_flag(data),\n\t\t\t\t() => this.set_item(row, item_code, barcode, batch_no, serial_no).then(qty => {\n\t\t\t\t\tthis.show_scan_message(row.idx, row.item_code, qty);\n\t\t\t\t}),\n\t\t\t\t() => this.set_barcode_uom(row, uom),\n\t\t\t\t() => this.set_serial_no(row, serial_no),\n\t\t\t\t() => this.set_batch_no(row, batch_no),\n\t\t\t\t() => this.set_barcode(row, barcode),\n\t\t\t\t() => this.clean_up(),\n\t\t\t\t() => this.revert_selector_flag(),\n\t\t\t\t() => resolve(row)\n\t\t\t]);\n\t\t});\n\t}\n\n\t// batch and serial selector is reduandant when all info can be added by scan\n\t// this flag on item row is used by transaction.js to avoid triggering selector\n\tset_selector_trigger_flag(data) {\n\t\tconst {batch_no, serial_no, has_batch_no, has_serial_no} = data;\n\n\t\tconst require_selecting_batch = has_batch_no && !batch_no;\n\t\tconst require_selecting_serial = has_serial_no && !serial_no;\n\n\t\tif (!(require_selecting_batch || require_selecting_serial)) {\n\t\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\t}\n\t}\n\n\trevert_selector_flag() {\n\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t}\n\n\tset_item(row, item_code, barcode, batch_no, serial_no) {\n\t\treturn new Promise(resolve => {\n\t\t\tconst increment = async (value = 1) => {\n\t\t\t\tconst item_data = {item_code: item_code};\n\t\t\t\titem_data[this.qty_field] = Number((row[this.qty_field] || 0)) + Number(value);\n\t\t\t\tawait frappe.model.set_value(row.doctype, row.name, item_data);\n\t\t\t\treturn value;\n\t\t\t};\n\n\t\t\tif (this.prompt_qty) {\n\t\t\t\tfrappe.prompt(__(\"Please enter quantity for item {0}\", [item_code]), ({value}) => {\n\t\t\t\t\tincrement(value).then((value) => resolve(value));\n\t\t\t\t});\n\t\t\t} else if (this.frm.has_items) {\n\t\t\t\tthis.prepare_item_for_scan(row, item_code, barcode, batch_no, serial_no);\n\t\t\t} else {\n\t\t\t\tincrement().then((value) => resolve(value));\n\t\t\t}\n\t\t});\n\t}\n\n\tprepare_item_for_scan(row, item_code, barcode, batch_no, serial_no) {\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Scan barcode for item {0}\", [item_code]),\n\t\t\tfields: me.get_fields_for_dialog(row, item_code, barcode, batch_no, serial_no),\n\t\t})\n\n\t\tthis.dialog.set_primary_action(__(\"Update\"), () => {\n\t\t\tconst item_data = {item_code: item_code};\n\t\t\titem_data[this.qty_field] = this.dialog.get_value(\"scanned_qty\");\n\t\t\titem_data[\"has_item_scanned\"] = 1;\n\n\t\t\tthis.remaining_qty = flt(this.dialog.get_value(\"qty\")) - flt(this.dialog.get_value(\"scanned_qty\"));\n\t\t\tfrappe.model.set_value(row.doctype, row.name, item_data);\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.set_batch_no(row, this.dialog.get_value(\"batch_no\")),\n\t\t\t\t() => this.set_barcode(row, this.dialog.get_value(\"barcode\")),\n\t\t\t\t() => this.set_serial_no(row, this.dialog.get_value(\"serial_no\")),\n\t\t\t\t() => this.add_child_for_remaining_qty(row),\n\t\t\t\t() => this.clean_up()\n\t\t\t]);\n\n\t\t\tthis.dialog.hide();\n\t\t});\n\n\t\tthis.dialog.show();\n\n\t\tthis.$scan_btn = this.dialog.$wrapper.find(\".link-btn\");\n\t\tthis.$scan_btn.css(\"display\", \"inline\");\n\t}\n\n\tget_fields_for_dialog(row, item_code, barcode, batch_no, serial_no) {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tfieldname: \"barcode_scanner\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tlabel: __(\"Scan Barcode\"),\n\t\t\t\tonchange: (e) => {\n\t\t\t\t\tif (!e) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.target.value) {\n\t\t\t\t\t\tthis.scan_api_call(e.target.value, (r) => {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tthis.update_dialog_values(item_code, r);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tfieldname: \"qty\",\n\t\t\t\tlabel: __(\"Quantity to Scan\"),\n\t\t\t\tdefault: row[this.qty_field] || 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\tfieldname: \"column_break_1\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tread_only: 1,\n\t\t\t\tfieldname: \"scanned_qty\",\n\t\t\t\tlabel: __(\"Scanned Quantity\"),\n\t\t\t\tdefault: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t}\n\t\t]\n\n\t\tif (batch_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\toptions: \"Batch No\",\n\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\tdefault: batch_no,\n\t\t\t\tread_only: 1,\n\t\t\t\thidden: 1\n\t\t\t});\n\t\t}\n\n\t\tif (serial_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\tlabel: __(\"Serial Nos\"),\n\t\t\t\tdefault: serial_no,\n\t\t\t\tread_only: 1,\n\t\t\t});\n\t\t}\n\n\t\tif (barcode) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tfieldname: \"barcode\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tlabel: __(\"Barcode\"),\n\t\t\t\tdefault: barcode,\n\t\t\t\tread_only: 1,\n\t\t\t\thidden: 1\n\t\t\t});\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tupdate_dialog_values(scanned_item, r) {\n\t\tconst {item_code, barcode, batch_no, serial_no} = r.message;\n\n\t\tthis.dialog.set_value(\"barcode_scanner\", \"\");\n\t\tif (item_code === scanned_item &&\n\t\t\t(this.dialog.get_value(\"barcode\") === barcode || batch_no || serial_no)) {\n\n\t\t\tif (batch_no) {\n\t\t\t\tthis.dialog.set_value(\"batch_no\", batch_no);\n\t\t\t}\n\n\t\t\tif (serial_no) {\n\n\t\t\t\tthis.validate_duplicate_serial_no(serial_no);\n\t\t\t\tlet serial_nos = this.dialog.get_value(\"serial_no\") + \"\\n\" + serial_no;\n\t\t\t\tthis.dialog.set_value(\"serial_no\", serial_nos);\n\t\t\t}\n\n\t\t\tlet qty = flt(this.dialog.get_value(\"scanned_qty\")) + 1.0;\n\t\t\tthis.dialog.set_value(\"scanned_qty\", qty);\n\t\t}\n\t}\n\n\tvalidate_duplicate_serial_no(serial_no) {\n\t\tlet serial_nos = this.dialog.get_value(\"serial_no\") ?\n\t\t\tthis.dialog.get_value(\"serial_no\").split(\"\\n\") : [];\n\n\t\tif (in_list(serial_nos, serial_no)) {\n\t\t\tfrappe.throw(__(\"Serial No {0} already scanned\", [serial_no]));\n\t\t}\n\t}\n\n\tadd_child_for_remaining_qty(prev_row) {\n\t\tif (this.remaining_qty && this.remaining_qty >0) {\n\t\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\t\t\tlet row = frappe.model.add_child(this.frm.doc, cur_grid.doctype, this.items_table_name);\n\n\t\t\tlet ignore_fields = [\"name\", \"idx\", \"batch_no\", \"barcode\",\n\t\t\t\t\"received_qty\", \"serial_no\", \"has_item_scanned\"];\n\n\t\t\tfor (let key in prev_row) {\n\t\t\t\tif (in_list(ignore_fields, key)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\trow[key] = prev_row[key];\n\t\t\t}\n\n\t\t\trow[this.qty_field] = this.remaining_qty;\n\t\t\tif (this.qty_field == \"qty\" && frappe.meta.has_field(row.doctype, \"stock_qty\")) {\n\t\t\t\trow[\"stock_qty\"] = this.remaining_qty * row.conversion_factor;\n\t\t\t}\n\n\t\t\tthis.frm.script_manager.trigger(\"item_code\", row.doctype, row.name);\n\t\t}\n\t}\n\n\tasync set_serial_no(row, serial_no) {\n\t\tif (serial_no && frappe.meta.has_field(row.doctype, this.serial_no_field)) {\n\t\t\tconst existing_serial_nos = row[this.serial_no_field];\n\t\t\tlet new_serial_nos = \"\";\n\n\t\t\tif (!!existing_serial_nos) {\n\t\t\t\tnew_serial_nos = existing_serial_nos + \"\\n\" + serial_no;\n\t\t\t} else {\n\t\t\t\tnew_serial_nos = serial_no;\n\t\t\t}\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.serial_no_field, new_serial_nos);\n\t\t}\n\t}\n\n\tasync set_barcode_uom(row, uom) {\n\t\tif (uom && frappe.meta.has_field(row.doctype, this.uom_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.uom_field, uom);\n\t\t}\n\t}\n\n\tasync set_batch_no(row, batch_no) {\n\t\tif (batch_no && frappe.meta.has_field(row.doctype, this.batch_no_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.batch_no_field, batch_no);\n\t\t}\n\t}\n\n\tasync set_barcode(row, barcode) {\n\t\tif (barcode && frappe.meta.has_field(row.doctype, this.barcode_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.barcode_field, barcode);\n\t\t}\n\t}\n\n\tshow_scan_message(idx, exist = null, qty = 1) {\n\t\t// show new row or qty increase toast\n\t\tif (exist) {\n\t\t\tthis.show_alert(__(\"Row #{0}: Qty increased by {1}\", [idx, qty]), \"green\");\n\t\t} else {\n\t\t\tthis.show_alert(__(\"Row #{0}: Item added\", [idx]), \"green\")\n\t\t}\n\t}\n\n\tis_duplicate_serial_no(row, serial_no) {\n\t\tconst is_duplicate = row[this.serial_no_field]?.includes(serial_no);\n\n\t\tif (is_duplicate) {\n\t\t\tthis.show_alert(__(\"Serial No {0} is already added\", [serial_no]), \"orange\");\n\t\t}\n\t\treturn is_duplicate;\n\t}\n\n\tget_row_to_modify_on_scan(item_code, batch_no, uom, barcode) {\n\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\n\t\t// Check if batch is scanned and table has batch no field\n\t\tlet is_batch_no_scan = batch_no && frappe.meta.has_field(cur_grid.doctype, this.batch_no_field);\n\t\tlet check_max_qty = this.max_qty_field && frappe.meta.has_field(cur_grid.doctype, this.max_qty_field);\n\n\t\tconst matching_row = (row) => {\n\t\t\tconst item_match = row.item_code == item_code;\n\t\t\tconst batch_match = (!row[this.batch_no_field] || row[this.batch_no_field] == batch_no);\n\t\t\tconst uom_match = !uom || row[this.uom_field] == uom;\n\t\t\tconst qty_in_limit = flt(row[this.qty_field]) < flt(row[this.max_qty_field]);\n\t\t\tconst item_scanned = row.has_item_scanned;\n\n\t\t\treturn item_match\n\t\t\t\t&& uom_match\n\t\t\t\t&& !item_scanned\n\t\t\t\t&& (!is_batch_no_scan || batch_match)\n\t\t\t\t&& (!check_max_qty || qty_in_limit)\n\t\t}\n\n\t\treturn this.items_table.find(matching_row) || this.get_existing_blank_row();\n\t}\n\n\tget_existing_blank_row() {\n\t\treturn this.items_table.find((d) => !d.item_code);\n\t}\n\n\tplay_success_sound() {\n\t\tthis.success_sound && frappe.utils.play_sound(this.success_sound);\n\t}\n\n\tplay_fail_sound() {\n\t\tthis.fail_sound && frappe.utils.play_sound(this.fail_sound);\n\t}\n\n\tclean_up() {\n\t\tthis.scan_barcode_field.set_value(\"\");\n\t\trefresh_field(this.items_table_name);\n\t}\n\tshow_alert(msg, indicator, duration=3) {\n\t\tfrappe.show_alert({message: msg, indicator: indicator}, duration);\n\t}\n};\n", "frappe.ui.form.ControlData = class ControlData extends frappe.ui.form.ControlData  {\n\tmake_input() {\n\t\tsuper.make_input();\n\t\tif (this.df.options == 'Phone') {\n\t\t\tthis.setup_phone();\n\t\t}\n\t\tif (this.frm && this.frm.fields_dict) {\n\t\t\tObject.values(this.frm.fields_dict).forEach(function(field) {\n\t\t\t\tif (field.df.read_only === 1 && field.df.options === 'Phone'\n\t\t\t\t\t&& field.disp_area.style[0] != 'display' && !field.has_icon) {\n\t\t\t\t\tfield.setup_phone();\n\t\t\t\t\tfield.has_icon = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tsetup_phone() {\n\t\tif (frappe.phone_call.handler) {\n\t\t\tlet control = this.df.read_only ? '.control-value' : '.control-input';\n\t\t\tthis.$wrapper.find(control)\n\t\t\t\t.append(`\n\t\t\t\t\t<span class=\"phone-btn\">\n\t\t\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__('Make a call')}\">\n\t\t\t\t\t\t\t${frappe.utils.icon('call')}\n\t\t\t\t\t</span>\n\t\t\t\t`)\n\t\t\t\t.find('.phone-btn')\n\t\t\t\t.click(() => {\n\t\t\t\t\tfrappe.phone_call.handler(this.get_value(), this.frm);\n\t\t\t\t});\n\t\t}\n\t}\n};\n", "\n\tfrappe.templates['call_link'] = `<div class=\"call-detail-wrapper\">\n\t<div class=\"head flex justify-between\">\n\t\t<div>\n\t\t\t<span class=\"bold\"> {{ type }} Call</span>\n\t\t\t{% if (duration) %}\n\t\t\t<span class=\"text-muted\"> \u2022 {{ frappe.format(duration, { fieldtype: \"Duration\" }) }}</span>\n\t\t\t{% endif %}\n\t\t\t<span class=\"text-muted\"> \u2022 {{ comment_when(creation) }}</span>\n\t\t</div>\n\t\t<span>\n\t\t\t<a class=\"action-btn\" href=\"/app/call-log/{{ name }}\" title=\"{{ __(\"Open Call Log\") }}\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-link-url\" class=\"like-icon\"></use>\n\t\t\t\t</svg>\n\t\t\t</a>\n\t\t</span>\n\t</div>\n\n\n\t<div class=\"body pt-3\">\n\t\t{% if (type === \"Incoming\") { %}\n\t\t\t<span> Incoming call from {{ from }}, received by {{ to }}</span>\n\t\t{% } else { %}\n\t\t\t<span> Outgoing Call made by {{ from }} to {{ to }}</span>\n\t\t{% } %}\n\t\t<div class=\"summary pt-3\">\n\t\t{% if (summary) { %}\n\t\t\t<i>{{ summary }}</i>\n\t\t{% } else { %}\n\t\t\t<i class=\"text-muted\">{{ __(\"No Summary\") }}</i>\n\t\t{% } %}\n\t\t</div>\n\t\t{% if (recording_url) { %}\n\t\t<div class=\"margin-top\">\n\t\t\t\t<audio\n\t\t\t\t\tcontrols\n\t\t\t\t\tsrc=\"{{ recording_url }}\">\n\t\t\t\t</audio>\n\t\t</div>\n\t\t{% } %}\n\t</div>\n</div>\n`;\n", "frappe.provide(\"erpnext.bulk_transaction_processing\");\n\n$.extend(erpnext.bulk_transaction_processing, {\n\tcreate: function(listview, from_doctype, to_doctype) {\n\t\tlet checked_items = listview.get_checked_items();\n\t\tconst doc_name = [];\n\t\tchecked_items.forEach((Item)=> {\n\t\t\tif (Item.docstatus == 0) {\n\t\t\t\tdoc_name.push(Item.name);\n\t\t\t}\n\t\t});\n\n\t\tlet count_of_rows = checked_items.length;\n\t\tfrappe.confirm(__(\"Create {0} {1} ?\", [count_of_rows, to_doctype]), ()=>{\n\t\t\tif (doc_name.length == 0) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.utilities.bulk_transaction.transaction_processing\",\n\t\t\t\t\targs: {data: checked_items, from_doctype: from_doctype, to_doctype: to_doctype}\n\t\t\t\t}).then(()=> {\n\n\t\t\t\t});\n\t\t\t\tif (count_of_rows > 10) {\n\t\t\t\t\tfrappe.show_alert(\"Starting a background job to create {0} {1}\", [count_of_rows, to_doctype]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfrappe.msgprint(__(\"Selected document must be in submitted state\"));\n\t\t\t}\n\t\t});\n\t}\n});", "erpnext.utils.CRMActivities = class CRMActivities {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\trefresh() {\n\t\tvar me = this;\n\t\t$(this.open_activities_wrapper).empty();\n\t\tlet cur_form_footer = this.form_wrapper.find('.form-footer');\n\n\t\t// all activities\n\t\tif (!$(this.all_activities_wrapper).find('.form-footer').length) {\n\t\t\tthis.all_activities_wrapper.empty();\n\t\t\t$(cur_form_footer).appendTo(this.all_activities_wrapper);\n\n\t\t\t// remove frappe-control class to avoid absolute position for action-btn\n\t\t\t$(this.all_activities_wrapper).removeClass('frappe-control');\n\t\t\t// hide new event button\n\t\t\t$('.timeline-actions').find('.btn-default').hide();\n\t\t\t// hide new comment box\n\t\t\t$(\".comment-box\").hide();\n\t\t\t// show only communications by default\n\t\t\t$($('.timeline-content').find('.nav-link')[0]).tab('show');\n\t\t}\n\n\t\t// open activities\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.crm.utils.get_open_activities\",\n\t\t\targs: {\n\t\t\t\tref_doctype: this.frm.doc.doctype,\n\t\t\t\tref_docname: this.frm.doc.name\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tvar activities_html = frappe.render_template('crm_activities', {\n\t\t\t\t\t\ttasks: r.message.tasks,\n\t\t\t\t\t\tevents: r.message.events\n\t\t\t\t\t});\n\n\t\t\t\t\t$(activities_html).appendTo(me.open_activities_wrapper);\n\n\t\t\t\t\t$(\".open-tasks\").find(\".completion-checkbox\").on(\"click\", function() {\n\t\t\t\t\t\tme.update_status(this, \"ToDo\");\n\t\t\t\t\t});\n\n\t\t\t\t\t$(\".open-events\").find(\".completion-checkbox\").on(\"click\", function() {\n\t\t\t\t\t\tme.update_status(this, \"Event\");\n\t\t\t\t\t});\n\n\t\t\t\t\tme.create_task();\n\t\t\t\t\tme.create_event();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tcreate_task () {\n\t\tlet me = this;\n\t\tlet _create_task = () => {\n\t\t\tconst args = {\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\tfrm: me.frm,\n\t\t\t\ttitle: __(\"New Task\")\n\t\t\t};\n\t\t\tlet composer = new frappe.views.InteractionComposer(args);\n\t\t\tcomposer.dialog.get_field('interaction_type').set_value(\"ToDo\");\n\t\t\t// hide column having interaction type field\n\t\t\t$(composer.dialog.get_field('interaction_type').wrapper).closest('.form-column').hide();\n\t\t\t// hide summary field\n\t\t\t$(composer.dialog.get_field('summary').wrapper).closest('.form-section').hide();\n\t\t};\n\t\t$(\".new-task-btn\").click(_create_task);\n\t}\n\n\tcreate_event () {\n\t\tlet me = this;\n\t\tlet _create_event = () => {\n\t\t\tconst args = {\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\tfrm: me.frm,\n\t\t\t\ttitle: __(\"New Event\")\n\t\t\t};\n\t\t\tlet composer = new frappe.views.InteractionComposer(args);\n\t\t\tcomposer.dialog.get_field('interaction_type').set_value(\"Event\");\n\t\t\t$(composer.dialog.get_field('interaction_type').wrapper).hide();\n\t\t};\n\t\t$(\".new-event-btn\").click(_create_event);\n\t}\n\n\tasync update_status (input_field, doctype) {\n\t\tlet completed = $(input_field).prop(\"checked\") ? 1 : 0;\n\t\tlet docname = $(input_field).attr(\"name\");\n\t\tif (completed) {\n\t\t\tawait frappe.db.set_value(doctype, docname, \"status\", \"Closed\");\n\t\t\tthis.refresh();\n\t\t}\n\t}\n};\n\nerpnext.utils.CRMNotes = class CRMNotes {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\trefresh() {\n\t\tvar me = this;\n\t\tthis.notes_wrapper.find('.notes-section').remove();\n\n\t\tlet notes = this.frm.doc.notes || [];\n\t\tnotes.sort(\n\t\t\tfunction(a, b) {\n\t\t\t\treturn new Date(b.added_on) - new Date(a.added_on);\n\t\t\t}\n\t\t);\n\n\t\tlet notes_html = frappe.render_template(\n\t\t\t'crm_notes',\n\t\t\t{\n\t\t\t\tnotes: notes\n\t\t\t}\n\t\t);\n\t\t$(notes_html).appendTo(this.notes_wrapper);\n\n\t\tthis.add_note();\n\n\t\t$(\".notes-section\").find(\".edit-note-btn\").on(\"click\", function() {\n\t\t\tme.edit_note(this);\n\t\t});\n\n\t\t$(\".notes-section\").find(\".delete-note-btn\").on(\"click\", function() {\n\t\t\tme.delete_note(this);\n\t\t});\n\t}\n\n\n\tadd_note () {\n\t\tlet me = this;\n\t\tlet _add_note = () => {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Add a Note'),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"label\": \"Note\",\n\t\t\t\t\t\t\"fieldname\": \"note\",\n\t\t\t\t\t\t\"fieldtype\": \"Text Editor\",\n\t\t\t\t\t\t\"reqd\": 1,\n\t\t\t\t\t\t\"enable_mentions\": true,\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tprimary_action: function() {\n\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"add_note\",\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tnote: data.note\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __('Add')\n\t\t\t});\n\t\t\td.show();\n\t\t};\n\t\t$(\".new-note-btn\").click(_add_note);\n\t}\n\n\tedit_note (edit_btn) {\n\t\tvar me = this;\n\t\tlet row = $(edit_btn).closest('.comment-content');\n\t\tlet row_id = row.attr(\"name\");\n\t\tlet row_content = $(row).find(\".content\").html();\n\t\tif (row_content) {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Edit Note'),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"label\": \"Note\",\n\t\t\t\t\t\t\"fieldname\": \"note\",\n\t\t\t\t\t\t\"fieldtype\": \"Text Editor\",\n\t\t\t\t\t\t\"default\": row_content\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tprimary_action: function() {\n\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"edit_note\",\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tnote: data.note,\n\t\t\t\t\t\t\trow_id: row_id\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __('Done')\n\t\t\t});\n\t\t\td.show();\n\t\t}\n\t}\n\n\tdelete_note (delete_btn) {\n\t\tvar me = this;\n\t\tlet row_id = $(delete_btn).closest('.comment-content').attr(\"name\");\n\t\tfrappe.call({\n\t\t\tmethod: \"delete_note\",\n\t\t\tdoc: me.frm.doc,\n\t\t\targs: {\n\t\t\t\trow_id: row_id\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\tme.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n", "\n\tfrappe.templates['crm_activities'] = `<div class=\"open-activities\">\n\t<div class=\"new-btn pb-3\">\n\t\t<span>\n\t\t\t<button class=\"btn btn-sm small new-task-btn mr-1\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-small-message\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Task\") }}\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-sm small new-event-btn\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-calendar\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Event\") }}\n\t\t\t</button>\n\t\t</span>\n\t</div>\n\t<div class=\"section-body\">\n\t\t<div class=\"open-tasks pr-1\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span class=\"ml-2\">{{ __(\"Open Tasks\") }}</span>\n\t\t\t</div>\n\t\t\t{% if (tasks.length) { %}\n\t\t\t\t{% for(var i=0, l=tasks.length; i<l; i++) { %}\n\t\t\t\t\t<div class=\"single-activity\">\n\t\t\t\t\t\t<div class=\"flex justify-between mb-2\">\n\t\t\t\t\t\t\t<div class=\"row label-area font-md ml-1\">\n\t\t\t\t\t\t\t\t<span class=\"mr-2\">\n\t\t\t\t\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t\t\t\t\t<use href=\"#icon-small-message\"></use>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<a href=\"/app/todo/{{ tasks[i].name }}\" title=\"{{ __('Open Task') }}\">\n\t\t\t\t\t\t\t\t\t{%= tasks[i].description %}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"checkbox\">\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"completion-checkbox\"\n\t\t\t\t\t\t\t\t\tname=\"{{tasks[i].name}}\" title=\"{{ __('Mark As Closed') }}\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% if(tasks[i].date) { %}\n\t\t\t\t\t\t\t<div class=\"text-muted ml-1\">\n\t\t\t\t\t\t\t\t{%= frappe.datetime.global_date_format(tasks[i].date) %}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t{% if(tasks[i].allocated_to) { %}\n\t\t\t\t\t\t\t<div class=\"text-muted  ml-1\">\n\t\t\t\t\t\t\t\t{{ __(\"Allocated To:\") }}\n\t\t\t\t\t\t\t\t{%= tasks[i].allocated_to %}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t</div>\n\t\t\t    {% } %}\n            {% } else { %}\n                <div class=\"single-activity no-activity text-muted\">\n                    {{ __(\"No open task\") }}\n                </div>\n\t\t    {% } %}\n\t\t</div>\n\t\t<div class=\"open-events pl-1\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span class=\"ml-2\">{{ __(\"Open Events\") }}</span>\n\t\t\t</div>\n\t\t\t{% if (events.length) { %}\n                {% let icon_set = {\"Sent/Received Email\": \"mail\", \"Call\": \"call\", \"Meeting\": \"share-people\"}; %}\n                {% for(var i=0, l=events.length; i<l; i++) { %}\n                    <div class=\"single-activity\">\n                        <div class=\"flex justify-between mb-2\">\n                            <div class=\"row label-area font-md ml-1 title\">\n                                <span class=\"mr-2\">\n                                    <svg class=\"icon icon-sm\">\n                                        <use href=\"#icon-{{ icon_set[events[i].event_category] || 'calendar' }}\"></use>\n                                    </svg>\n                                </span>\n                                <a href=\"/app/event/{{ events[i].name }}\" title=\"{{ __('Open Event') }}\">\n                                    {%= events[i].subject %}\n                                </a>\n                            </div>\n                            <div class=\"checkbox\">\n                                <input type=\"checkbox\" class=\"completion-checkbox\"\n                                    name=\"{{ events[i].name }}\" title=\"{{ __('Mark As Closed') }}\">\n                            </div>\n                        </div>\n                        <div class=\"text-muted ml-1\">\n                            {%= frappe.datetime.global_date_format(events[i].starts_on) %}\n\n                            {% if (events[i].ends_on) { %}\n                                {% if (frappe.datetime.obj_to_user(events[i].starts_on) != frappe.datetime.obj_to_user(events[i].ends_on)) %}\n                                    -\n                                    {%= frappe.datetime.global_date_format(frappe.datetime.obj_to_user(events[i].ends_on)) %}\n                                    {%= frappe.datetime.get_time(events[i].ends_on) %}\n                                {% } else if (events[i].ends_on) { %}\n                                    -\n                                    {%= frappe.datetime.get_time(events[i].ends_on) %}\n                                {% } %}\n                            {% } %}\n\n                        </div>\n                    </div>\n                {% } %}\n            {% } else { %}\n            <div class=\"single-activity no-activity text-muted\">\n                {{ __(\"No open event\") }}\n            </div>\n\t\t    {% } %}\n\t\t</div>\n\t</div>\n</div>\n\n\n<style>\n.open-activities {\n\tmin-height: 50px;\n\tpadding-left: 0px;\n\tpadding-bottom: 15px !important;\n}\n\n.open-activities .new-btn {\n\ttext-align: right;\n}\n\n.single-activity {\n\tmin-height: 90px;\n\tborder: 1px solid var(--border-color);\n\tpadding: 10px;\n\tborder-bottom: 0;\n\tpadding-right: 0;\n}\n\n.single-activity:last-child {\n\tborder-bottom: 1px solid var(--border-color);\n}\n\n.single-activity:hover .completion-checkbox{\n\tdisplay: block;\n}\n\n.completion-checkbox {\n\tvertical-align: middle;\n\tdisplay: none;\n}\n\n.checkbox {\n\tmin-width: 22px;\n}\n\n.open-tasks {\n\twidth: 50%;\n}\n\n.open-tasks:first-child {\n\tborder-right: 0;\n}\n\n.open-events {\n\twidth: 50%;\n}\n\n.open-section-head {\n\tbackground-color: var(--bg-color);\n\tmin-height: 30px;\n\tborder-bottom: 1px solid var(--border-color);\n\tpadding: 10px;\n\tfont-weight: bold;\n}\n\n.no-activity {\n    text-align: center;\n    padding-top: 30px;\n}\n\n.form-footer {\n\tbackground-color: var(--bg-color);\n}\n</style>`;\n", "\n\tfrappe.templates['crm_notes'] = `<div class=\"notes-section col-xs-12\">\n\t<div class=\"new-btn pb-3\">\n\t\t<button class=\"btn btn-sm small new-note-btn mr-1\">\n\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t<use href=\"#icon-add\"></use>\n\t\t\t</svg>\n\t\t\t{{ __(\"New Note\") }}\n\t\t</button>\n\t</div>\n\t<div class=\"all-notes\">\n\t\t{% if (notes.length) { %}\n\t\t\t{% for(var i=0, l=notes.length; i<l; i++) { %}\n\t\t\t\t<div class=\"comment-content p-3 row\" name=\"{{ notes[i].name }}\">\n\t\t\t\t\t<div class=\"mb-2 head col-xs-3\">\n\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t<div class=\"col-xs-2\">\n\t\t\t\t\t\t\t\t{{ frappe.avatar(notes[i].added_by) }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"col-xs-10\">\n\t\t\t\t\t\t\t\t<div class=\"mr-2 title font-weight-bold\">\n\t\t\t\t\t\t\t\t\t{{ strip_html(notes[i].added_by) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"time small text-muted\">\n\t\t\t\t\t\t\t\t\t{{ frappe.datetime.global_date_format(notes[i].added_on) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"content col-xs-8\">\n\t\t\t\t\t\t{{ notes[i].note }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"col-xs-1 text-right\">\n\t\t\t\t\t\t<span class=\"edit-note-btn btn btn-link\">\n\t\t\t\t\t\t\t<svg class=\"icon icon-sm\"><use xlink:href=\"#icon-edit\"></use></svg>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"delete-note-btn  btn btn-link pl-2\">\n\t\t\t\t\t\t\t<svg class=\"icon icon-xs\"><use xlink:href=\"#icon-delete\"></use></svg>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{% } %}\n\t\t{% } else { %}\n            <div class=\"no-activity text-muted pt-6\">\n                {{ __(\"No Notes\") }}\n            </div>\n\t\t    {% } %}\n\t</div>\n</div>\n\n<style>\n\n.comment-content {\n    border: 1px solid var(--border-color);\n\tborder-bottom: none;\n}\n\n.comment-content:last-child {\n    border-bottom: 1px solid var(--border-color);\n}\n\n.new-btn {\n\ttext-align: right;\n}\n\n.notes-section .no-activity {\n\tmin-height: 100px;\n\ttext-align: center;\n}\n\n.notes-section .btn {\n\tpadding: 0.2rem 0.2rem;\n}\n\n</style>`;\n"],
  "mappings": "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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;UCArC,OAAO,UAAU,UAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;",
  "names": []
}
